The data flow architecture of video optimized media streamer
The present invention relates to a kind of system that is used to transmit multi-medium data, particularly relate to a kind of interactive video server system that video is provided for a plurality of terminals simultaneously with the minimal buffering district.
Movie and the employed technology of TV are also quite backward at present.Main storage medium is the simulation band such as vhs video/player, and develop into televise and broadcast in the high-quality, the expensive D1VTR band that use.There are many problems in this technology.Such problem comprises: need people's frock band; Damage mechanical part, magnetic head, reach tape itself; And expense is higher.A very important tired problem of scratching the broadcasting station is that VTR can only sequentially finish a function a moment.Each tape unit will spend 70,000 5 thousand to 150,000 dollars.
TV station wants to increase its income by advertisement.This only is added to special advertisement (some lack film) in the program of standard, thereby regards each city as a market independently.But realize above-mentioned target with tape technologies, even very expensive digital D1 band system or tape automat all are difficult.
The classic method that is used for multi-medium data is sent to the final user can be divided into two kinds.A kind of is the broadcasting industry method, and another kind is the computer industry method.Broadcasting method (comprising animation, CATV (cable television), TV network and video recording industry) is generally stored with mould machine or digital video recording band.Can produce isochronal data stream when playing band, this then isochronal data fails to be convened for lack of a quorum and sends the final user to by broadcasting industry equipment.Computer approach is generally with disk or there is the auxiliary disk of tape to store, and with compressed digital format DVI for example, JPEG and MPEG come record data.Computing machine spreads non-isochronal data as requested gives the final user, and wherein hardware cache and special application code make data stream level and smooth, thereby continuous audiovisual is provided.
Because the cost issues of storage medium, think that always the video tape subsystem compares the advantage that has on the expense with computer magnetic disc subsystem.But, shortcoming such as the video tape subsystem has tape management, visit is waited for and reliability is relatively low.Along with the computer memory price reduces, and the development of real-time digital compression/de-compression technology, the shortcoming of video tape subsystem becomes increasingly conspicuous.
Though the compound price of computer subsystem/performance is improved than existing,, people generally still are not considered as it " video close friend (Video friendly) ".The terminal that computing machine is main to have interface with workstation and other and be referred to as agreement such as when non-" " joins.In order to ensure the multi-medium data of level and smooth (when waiting) is sent to the final user, computer system needs special application code and bigger buffer memory, with overcome the traditional communication method intrinsic shortcoming.In addition, computing machine does not possess the friendly characteristic of video, this show their lack with multimedia industry in handle isochronal data stream and the equipment that between data stream, switches with the high precision interface of compatibility mutually.
Along with the appearance that uses a computer video data is compressed and stores by digital format, make such as television broadcasting, interior film, begun the appearance change in by the main industries such as pay-per-view (pay-per-View) film in phone " video on demand " and the hotel at some.Compress technique has developed into and can make compression ratio reach 100 times to 180 times.Such compression ratio makes and can substitute existing magnetic tape system with random access disk technology.
Along with capable random access digital disk data and disk system have higher bandwidth, the performance of disk technology, hardware cost and expandability can satisfy the demand of system on function and performance.In the past, because the price problem of storer uses disk file store video and film to be considered to infeasible.Recently, the existing decline by a relatively large margin of price.
Because the appearance of the emerging market of many use mpeg standard compressed video datas has had some to have the method for the stored video data of the good ratio of performance to price.The present invention proposes a kind of hierarchy plan that satisfies multiple different demands, and produce a kind of can customization to satisfy the modular system method of market demand.
The invention provides the computer subsystem of a kind of " video close friend ", it can transmit isochronal data stream by interface traditional in this industry under multimedia environment.Transmit isochronal data stream according to a media streamer of the present invention (steamer) with optimum way, and data are delivered in the new computer network with Asynchronous Transfer Mode (ATM) technology.The present invention can eliminate the shortcoming of video-tape when being provided for video tape recorder (VTR) metaphor of system's control.System according to the present invention has following characteristic: the independently controlled data of 1-1000 second is spread deliver to the final user in proportion; Can transmit many isochronal data streams from a data backup; The mixed type output interface; The mixed type data rate; One simple " open system " control interface; Automatically control is supported, storage classification support and the low cost that transmits each data stream.
Media streamer according to one aspect of the invention comprises the memory node that at least one is made of massage storage, and this massage storage is used to store the digitized representations of at least one video image.This media streamer also comprises a plurality of communication nodes, and each node has at least an input port to be coupled to the output terminal of at least one memory node, to receive the digitized representations of video image on this memory node.Each of a plurality of communication nodes further comprises a plurality of output ports, and each of a plurality of output ports can both send to digitized representations the user of this digitized representations in the data stream mode.Single output port all has a related data buffer memory, is used for the partial digitized expression of buffer memory before sending digitized representations.
Each of a plurality of communication nodes further comprises a scheduler, for the individual data buffer memory sends read request at least one memory node, with next order part numeral of storage in the individual data buffer memory.The read request of the metadata cache that each is specific all is arranged at a schedule time, so that the next requested order of digitized representations part is being required to can be used for a request communication node before the relevant output port of the metadata cache that has been arranged read request sends.
Have at least a memory node to comprise that also one is used for sending to massage storage the scheduler of read request.Scheduling to this read request makes next order part of digitized representations can be used for output before at least one memory node receives the request of reading this part from described communication node.
The scheduler schedules read request of single communication node is so that at any given time, have only the read request from single communication node unsettled at least one memory node.
The present invention has also disclosed and will be used to send the technology of optimizing with the disk storage unit of receiving video data.
Fig. 1 is the block diagram according to a media streamer of the present invention,
Figure 1A is the block diagram that further describes the line adapter shown in Fig. 1;
Figure 1B is the block diagram that further describes the tape storage node details shown in Fig. 1;
Fig. 1 C is the block diagram that further describes the disk storage node details shown in Fig. 1;
Fig. 1 D is the block diagram that further describes the communication node details shown in Fig. 1;
Fig. 2 has provided video flowing output control command table and another the data management command list of carrying out with high priority of carrying out with low priority;
Fig. 3 is a block diagram of describing the communication node data stream:
Fig. 4 is a block diagram of describing disk storage node data stream;
Fig. 5 has described the control information flow that is used to finish connection;
Fig. 6 has described and has been used to the control information flow that begins to play;
Fig. 7 has described interface between media streamer and the client's control system,
Fig. 8 has described a display screen, is used for a plurality of " soft " key of display operation media streamer;
Fig. 9 describes one and packs into and select screen, when having selected the soft key of packing among Fig. 8, shows this screen;
Figure 10 describes a collection of processing selecting screen, and the batch processing key in selecting Fig. 8 shows this screen;
Figure 11 has described some client/service relations that exist between client's control system and the media streamer;
Figure 12 has described and has been used for the accessing video data and it is fed to the prior art of one or more output ports;
Figure 13 one is used for showing how a plurality of video ports visit the block diagram of the single video-frequency band that is included in a communication node high-speed cache;
Figure 14 is used for describing a plurality of video ports how directly to visit the block diagram that is included in high-speed cache one video-frequency band on the disk storage node;
Figure 15 has described a storage allocation pattern used in the present invention;
Figure 16 has described the segment logic file of video 1;
How each section that Figure 17 has described video 1 is cut apart or thread through a plurality of disc drivers;
Figure 18 has described the prior art interface between a memory node and a chiasma type breakout box;
It is how to be modified so that expand output bandwidth for memory node provides that Figure 19 has described prior art breakout box interface shown in Figure 180;
Figure 20 has described the process that is used to guarantee the constant video of output on a video output bus;
Figure 21 is used to describe the block diagram that is used for digital of digital video data is converted to a video adapter of analog video data;
Figure 22 is the block diagram that is used to represent to control with the SCSI bus order control module of video adapter shown in Figure 21.
Some terminological interpretations of Shi Yonging are as follows in the following description:
AAL-5: Asynchronous Transfer Mode adaptation layer 1 (ATM ADAPTATIONLAYER-5): it is multistage to refer to that an ATM who is fit to the data transmission serves.
ATM: Asynchronous Transfer Mode (ASYNCRONOUS TRAWSFERMODE): a kind of (or the high speed switching and the tranmission techniques that use in while two kinds of nets at LAN (Local Area Network) or wide area.It both can transmit data also can transmit video/audio.
Betacam: a kind of analog video format of professional quality.
CCIR601: a kind of standard resolution that is used for Digital Television.720 * 840 (as NTSC) or 720 * 576 (as PAL) brightness, horizontal colourity double sampling 2: 1.
CPU: CPU (central processing unit) (CENTRAL PROCESSING UNIT): in computer organization, the instigator of process computer instruction.
CRC: cyclic redundancy check (CRC) (CYCLIC REDUNDANCY CHECK).A kind of data error detection pattern.
D1: meet the digital video record form of CCIR601, record on 19mm video band.
D2: meet the digital video record form of SMPTE244M, record on 19mm video band.
D3: the digital video record form that meets SMPTE 244m.At 1/2 " record on the video band.
DASD: direct access storage device (DIRECT ACCESS STORAGEDEVICE): any addressable on line data memory device or cd-rom player can be DASD.Can use with the disc driver synonym.
DMA: direct memory access (DMA) (DIRECT MEMORY ACCESS): a kind of method that transmits data in computer organization, it does not need CPU to transmit data.
DVI: a kind of low-quality relatively compression of digital video form, the video playback that is generally used for CD-ROM is coiled is to computer screen.
E1: the European standard that is equivalent to T1.
F1F0: first in first out (FIRSTIN FIRST OUT): a kind of queue processing method of handling by the first come, first serve principle.
Genlock: refer to the process synchronous with another vision signal.Catch video so that need it when digitized processing and vision signal sweep parameter synchronised at computing machine.
I/O: I/O (INPUT/OUTPUT)
Isochronans: the information that is used to describe time-sensitive and sends incessantly, when video that sends and audio frequency all are etc. in real time.
JPEG: the expert that takes pictures unites group (JOINT PHOTOGRAPHICEXPERT GROUP): by the Working Committee that ISO (International Standards Organization) is sponsored, proposition one is used for the suggestiveness universal standard of computer system rest image digital compression.
KB: kilobyte (KILO BYTES): 1024 bytes.
LAN: LAN (Local Area Network) (LOCAL AREA NETWORK): terminal, computing machine and peripheral hardware in one mile or one mile are connected with twisted-pair feeder, concentric cable or fiber optic cables, and thereon can high-speed transferring data.
LRU: least recently used (LEAST RECENTLY USED).
MPEG: Motion Picture Experts Group (NOVING PCTURE EXPERTSGROUP): by the work group that the target criteria tissue is sponsored, the digital compression/decompression standard of definition animated video/audio frequency.MPEG-1 is initial and the standard used.MPEG-2 will be the next digitizing of supporting, flexibly and in proportion the standard that transmits of video.It will cover multiresolution, multidigit speed (bit rate) and multiple transfer mechanism.
MEPG-1, MEPG2: referring to MEPG
MRU: use at most recently (MOST RECENTLY USED).
MTNU: maximum duration (MOST TIME TO NEXTUSE before using next time.
NTSC format: national television standard tissue (NATIONALTELEVISION STRNDARDS COMMITTEE): in the U.S. and Japanese employed color TV format standard.
PAL format: phase-aoternation line system (PHASE ALTE RNATTONLINE): Europe except that France the employed color TV format standard of All Countries.
PC: personal computer (PERSONAL COMPUTER): a kind of that can in family or company, use, price low computing machine of comparing.
RAID: redundant array of inexpensive disks (REDUNDANT ARRAY OFINEXPENSIVE DISKS): a kind of storage arrangement mode, it makes several disks or CD by serial arrangement work, thereby increases bandwidth output, and redundancy backup is provided.
SCSI: small computer system interface (SMALL COMPUTERSYSTEM INTERFACE): a kind of peripheral hardware and its controller are linked industrial standard on the computing machine.
SIF: source input format (SOURCE INPUT FORMAT): 1/4th of CCIR601 resolution.
SMPTE: (the SOCIETY OFMOTION PICTUREï¹ amp of animated image and Television Engineer association; TELEVISIOW ENGINEERS).
SSA: serial storage structure (SERIAL STORAGEARCHITECTORE): a kind of standard of peripheral hardware and its controller being linked computing machine.May substitute SCSI.
T1: bit rate is 1.544 megabit per seconds and digital interface telephone network.
TCP/IP: send program (TRANSMISSIOWCONTROL PROTOCOL/INTERNET PROGRAM) between control protocol/net: by one group of agreement that is used for connecting dissimilar computing machine of U.S. Department of Defense's proposition by network.
VHS: vertical spin formula scanning (VERTICAL HELICAL SCAN): a kind of general format that is used for record analog video on tape.
VTR: video tape recorder (VIDEO TAPE RECORDER): a kind of on tape the equipment of recording of video.
VCR: videocassette recorder (VIDEO CASSETTE RECOROER): same VTR.
A. general construction
Fig. 1 has provided a video optimized streaming server system 10 (below be referred to as media streamer), and this system comprises separated components on four structures that measurability, high applicability and configuration flexibility can be provided.Its critical piece is as follows:
1) low 12: one hardware of the breakout box/microcode parts of waiting for, its basic task is to transmit data and control information between communication node 14, one or more memory node 16,17 and one or more Control Node 18.
2) 14: one hardware of communication node/microcode parts, its basic task by external definition, be generally interfaces " broadcast " such as the known NTSC of broadcast service, PAL, D1, D2 (when waiting ground send data) or " record " (reception data in ground when waiting).With include video card in a plurality of video ports 15 that the output terminal of each communication node 14 is connected, in this video card, numeral-video interface be housed.
3) memory node 16,17: one hardware/microcode parts, its basic task are that the managed storage medium is as dish and relevant selectable storer.
4) 18: one hardware/micro processing units of Control Node, its basic task are to receive and the control command of carrying out from a known external definition subsystem interface of computer industry.
A media streamer that typically has 64 nodes may comprise 31 communication nodes, 31 memory nodes with 2 with the low Control Node of waiting for that breakout box 12 interconnects mutually.A mini-system may not comprise breakout box and only comprise a hardware node of supporting communication, storage and control command.The design of media streamer 10 allows a mini-system to upgrade to a large scale system in the client installs.In all configurations, except the quantity of the multimedia of the quantity of the stream that transmits and storage hour was different, media streamer 10 can keep other function the same.
Figure 1A has further described low wait breakout box 12.The electric circuit shifter chip (not providing among the figure) that a plurality of interconnection are arranged on chiasma type breakout box card 20, these chiasma type cards 20 are by not schematically illustrated this interconnection in the surface plate interconnection network.Plane and single card 20 formations one have the low wait chiasma type breakout box of 16 node ports.Can constitute to assist and add the node port by increasing the auxilliary card 20 that adds, and if necessary, can also dispose the active redundancy node port of high-adaptability.Each port that connects device 12 to be passed such as low can become a per second 25MB full-duplex communication channel.
Information transmits by breakout box 12 by bag.Each bag comprises a head, is used for controlling the switching state of the single chiasma type transit point of each exchange chip.Control Node 18 is carried out with the required information of layer peering for other node (memory node 16,17 and communication node 14) provides by the low breakout box 12 of waiting for.
Figure 1B has described a tape storage node 17 inner structures.Can know after a while and see that tape storage node 17 provides the high capacity storage capacity for the numeral of store video images.
Described video image can comprise one or more images of showing and/or handling of being suitable for.One video image can comprise an audio-frequency unit.One or more images can be associated in logic, for example can be the sequence frames of a film, film or cartoon.Initial image can be produced jointly by video camera, digital machine or video camera and digital machine.Audio-frequency unit can with the image synchronization of continuous demonstration.The data representation of described video image can be the digitalized data form of one or more images of any suitable expression and audio frequency.Can encode to digital data and compress.
Refer again to Figure 1B, tape storage point joint 17 comprises that one can visit the tape library control unit interface 24 that is included in a plurality of magnetic recordings in the tape library 26.Another interface 28 can pass through other tape library of SCSI bus interconnect access.One built-in system storer 30 can be used for buffer memory from any one interface in interface 24 or 28 or through the video data of DMA data transfer path 32.System's storage block 30 can be one to include the part of the PC 34 of the software 36 that is used for tape library and file management facilities.One breakout box interface and cache module 38 (also being used for disc type memory node 16, communication node 14 and Control Node 18) can be used for being connected belt memory node 17 and the low breakout box 12 of waiting for.Also promptly: module 38 is responsible for data are sent to bag, and adds the head part that breakout box 12 uses when selecting route for bag to each bag.When from breakout box 12 receptions one bag, module 38 is responsible for removing head at partial cache or before handling received data.
Video data from tape library 26 can enter system storage 30 in one first action of giving.Then, in response to the inceptive direction of Control Node 18, wait for that by low breakout box 20 sends to a disk storage node 16 with video data, so that can immediate access when needed.
Fig. 1 C has represented the inside detailed structure of a disk storage node 16.Each disk storage node 16 comprises a breakout box interface and buffer module 40, it data can be transmitted from/to-RAID video high-speed cache and store interface module 42.Interface 42 sends the video data that is received to a plurality of dishes 45, with accurate RAID mode distributed data between dish.Existing memory technology in the prior art about RAID, at Acm SIGMODEConference, Chicago IL, June 1-3,1988 109-116 pages or leaves have disclosed " example of a redundant array of inexpensive disks " of Patterson
Disk storage node 16 further comprises an inner PC 44, and the software module 46 and 48 that this PC 44 comprises is respectively applied for the control store node, control of video file and dish, and provide RAID reflection for being stored in the data of dish on 45.In fact, each disk storage node 16 provides one than the suitable level of band memory node 17 more direct video datas.Each disk storage node 16 further can be in the semiconductor memory of breakout box interface and buffer module 40 buffer-stored (pressing the high-speed cache mode) video data, thereby when receiving a request, can provide available video data quickly.
In general, a memory node comprises a mass storage unit (or interface of a mass storage unit) and can partial cache reads from massage storage or to the data that wherein write.Memory node can comprise the massage storage of sequential accesss such as one or several magnetic tape station and/or disk drive, also can comprise one or more can random access mode the random access memory and/or the semiconductor memory of visit.
Fig. 1 D is the block diagram of the internal part of an expression communication node 14.Similar to above-mentioned node, communication node 14 comprises a breakout box interface and buffer module 50, and it can be communicated by letter by the low breakout box 12 of waiting for by aforementioned manner.Video data can directly transmit between breakout box interface and buffer module 50, and further delivers in stream buffer memory and the communication interface 52 to deliver to a user terminal (not expression in the drawings).PC 54 comprises software module 56 and 58, and they provide communication node control (that is: stream begins/stop action) respectively, and data stream when allowing to produce first-class subsequently.One of stream damper and communication interface 52 auxilliary add input 60 and makes output data frame synchronization.From automatic control equipment 62, receive data, and automatic control equipment 62 is subjected to the control of the system controller 64 of a whole streaming server 10 of control (referring to Fig. 1).System controller 64 produces the order that allows media streamer 10 visits one representation of video shot of being asked according to the input from user's controller top box (set topboxes) 65.System controller 64 also provides a user interface and display unit 66, and the user can be by using hardkey or soft key input command and other data whole playing process with identification video image, scheduling video image and control of video image.
PC of each Control Node 18 configuration, and comprise a breakout box interface module of joining with low wait breakout box 12.Each Control Node 18 provides information according to the communication node 14 that is input as from system controller 64 with memory node 16,17, so that produce desirable connection by the low breakout box 12 of waiting for.In addition, Control Node 18 also comprises can be to the software that carries out classification from the requested video data of one or more disk storage nodes 16, and this software can also transmit interface by a stream and send video data to user's display terminal.Control Node 18 is further by saving 16 and 17 from the low order control disk and the tape storage band of breakout box 12 waited for.
Media streamer has three structurized external interfaces as shown in Figure 1.These interfaces are:
1) control interface: one carries out ICP/IP protocol (Ethernet LAN (Local Area Network), token ring LAN (Local Area Network), serial port, the open system interface of modulator-demodular unit etc.
2) stream transmits interface: be designed for one of industry standard interface of transmitting data stream (NTSC, D1, etc.).
3) automatic control interface: one group of industrial standard control interface (as Genlock, BlackBurst.SMPTE Clock etc.) that is used to make stream output precise synchronization.
Application command is delivered to media streamer 10 by control interface.When what send is data when packing order into, and Control Node is distributed on one or more memory nodes with the data file segmentation (that is: data block) that arrives and with it.Number of users influences the layout of data on memory node 16 and 17 in the time of the density of data information and data.Increase density and/or while number of users are meaning and are using more memory node with raising capacity and bandwidth.
When sending by control interface when opening the data stream order of leading to a final user, Control Node 18 is selected and is activated a suitable communication node 14 and sends control information to it, indicates the position of data file section on memory node 16,17.Order bag and these node communications that communication node activates relevant memory node 16,17 and sends by low wait breakout box 12 are to begin to transmit data.
Data wait for that by hanging down breakout box 12 and " on time " (just in time) dispatching algorithm are in disk storage node 16 and 17 transmission.The technology of scheduling once and data flow con-trol is described below.The data stream of sending from communication node 14 by multiplex to/from disk storage node 16, so that single communication node stream only uses a part of capacity and the bandwidth of each disk storage node 16.Like this, a plurality of communication node 14 just can be with to the visit of identical or different data on the disk storage node 16 multipath conversion in addition.For example, media streamer 10 can provide 1500 controlled terminal user streams from the dynamic area of communication node 14, and each is multimedia file that is distributed on the disk node 16 of multiple access all.This ability is referred to as " single backup multithread ".
Carried out with two class unique way by the order that control interface receives.Those are used for management data and carry out by " low priority " with the order that data flow con-trol does not have a direct relation.So can influence to the terminal user once the application of new data to media streamer of packing into transmitted data stream.Those influence streams transmit the order of (that is: output) and carry out by " high priority ".
Fig. 2 has provided the control interface order.Be used for packing into and the lower-priority data administration order of management data comprises VS-CREATE at media streamer 10, VS-OPEN, VS-READ, VS-WRITE, VS-GET-POSITION, VS-SET-POSITION, VS-CLOSE, VS-RENAME, VS-DELETE, GET-ATTRIBUTES is with VS-GET-NAME.
The high priority flows control command that is used to start with management flow output comprises VS-CONNECT, VS-PLAV, VS-RECORD, VS-SEEK, VS-PAUSE, VS-STOP and VS-DISCONNECT.Control node 18 monitor flows control commands can be performed to guarantee request.When exceeding the ability of media streamer 10, " allowing control (admission the control) " parts in the Control Node 18 are rejected one and are started the request of flowing.This may appear in the following situation:
1) some component failures in system hinder when moving to greatest extent;
When 2) quantity of stream exceeds a particular value (for example specified by the parameter of VS-CREATE order) in the time of visit one data file, with;
When 3) quantity of stream exceeds a particular value when from system the time.This value can be specified by configurator is installed.
Communication node 14 can be managed by the heterogeneous group mode, and each all has potential different bandwidth (stream) ability and physical definition.VS-CONNECT order indication media streamer 10 distributes a communication node 14 and some or all of associated bandwidth to guarantee the transmission of isochronal data stream.For example media streamer 10 can be the speed broadcast packed data stream of 270 megabit per seconds with bit rate by communication node 14, plays packed data stream with lower data transfer rate (normally 1-16 megabit per second) simultaneously on other communication node 14.
Memory node 16,17 is managed by the heterogeneous group mode, and each all has potential different bandwidth (stream) ability and physical definition.VS-CREATE order indication media streamer 10 is a multimedia file and corresponding metadata allocate memory on one or more memory nodes.Current density and maximum required while number of users that the VS-CREATE order wants the while designated user to wish.
Three auxilliary adds the automatic control system that order is used for supporting broadcast service, and they are: VS-CONNECT-LIST, VS-PLAY-AT-SIGNAL and VS-RECORD-AT-SIGNAL.VS-CONNECT-LIST allows application program to specify a series of play command for subsystem in an individual command.Except between two streams during seamless delivery, when media streamer 10 will be carried out each play command, just look like it be to send by control interface.A sample sequence is as follows:
1) Control Node 18 receptions one have the VS-COWWECT-LIST order of play command, and all or part of FILE1, FILE2 and FILE3 are play in the subcommand indication in order.Control Node 18 is determined the maximum data rate and the Resources allocation of file on the communication node 14.The transmission of stream when the communication node 14 that is assigned with is received detailed playing list and startup etc.
2) when the transmission of FILE1 will finish, communication node 14 starts the transmission of FILE2, but it is not delivered to the output port of node.When FILE1 finished or signal from automatic control interface occurred, communication node 14 flowed output port from first-class changing-over to the second.This changing-over can be in 1/30 second, or finishes in the video frame time of standard.
3) communication node 14 discharges the resource relevant with FILE1.
The data that VS-PLAY-AT-SIGNAL and VS-RECORD-AT-SIGNAL allow the signal from the automatic control interface in outside will be used to play and write down are sent to a video frame boundary exactly.In last example, the VS-CONNECT-LIST that includes the PLAY-AT-SIGNAL subcommand can finish switching from FILE1 to FILE2 according to the automatic control interface signal in outside.If subcommand is VS-PLAY, have only when the FILE1 transmission is finished, just switch.
Other order of media streamer 10 has the ability of diode-capacitor storage staging hierarchy.They are: VS-DUMP, VS-RESTORE, VS-SEND, VS-RECEIVE and VS-RECEIVE-AND-PLAY.Each order can make one or more multimedia files be transmitted between the classification entity of memory node 16 and two external definitions.
1) VS-DUMP and VS-RESTORE can make data be transmitted between disk storage node 16 that Control Node 18 may have access to and tape storage node 17.Data transmit and can use application program launching by control, or are started automatically by Control Node 18.
2) VS-SEND and VS-RECEIVE provide a kind of method that a multimedia file is sent to the another one media streamer.The media streamer of being responsible for receiving can be play the file that arrives selectively immediately on a communication node of allocating in advance, and needn't wait whole file all to reach.
The architecture of media streamer is except adopting modular design and one group of function of definition, and the data stream that is used for the isochronal data transmission is optimized so that reduce expense significantly.Specifically:
1) the low bandwidth of breakout box of waiting for has exceeded the bandwidth of the node that connects; Internodal communication is similar to and is not blocked.
2) avoid data are delivered in the storer of processor, higher bandwidth is provided;
3) needn't deal with data, save expensive processing unit; With
4) transmission of data dispatching effectively, thus avoid using big data cache.
By traditional computerese, media streamer 10 is used as the adapter system of an interconnection, and it can only carry out the data transmission of equity at the same level by the low breakout box for the treatment of between adapter.Low wait for breakout box 12 accesses data memory and under the situation that does not have " main frame " to intervene, data segment is sent in the storer of another adapter from the storer of an adapter.
The differentiated control of the digital compression video data that transmits when B. being used for waiting
Media streamer 10 provides the classification storage unit.Its design proposal can be from a very little video system to a big video system.It also provides a kind of storage administration mode flexibly, broadcasts into, high-quality non-compression video storage and follows the tracks of different needs with replay to satisfy video on demand, near video on demand, advertisement.
B1. tape storage
In media streamer 10, video image is sent on the dish from high performance number tape, with requirement, play with much lower data rate by the terminal user.In this manner, have only a minimum video time to be stored in the disk subsystem.If system is one " near video on demand ", so at any one time, each film for example has only that 5 minutes part need exist on the disk.For each movie film of 2 hours normally, only need 22 sections every section 5 minutes.Because be not that all video images are kept in the disk file at any one time, the required total disk storage space of video image has just reduced like this.Only need in progress image section is placed in the disk file.
In other words, if a video image needs time T to play that they are whole, and store with the numeral that N data block arranged, about T/N cycle of each data block store video image is that part of so.The video image of last piece storage in N data block may be less than the T/N cycle.
Along with increase to the quantity that increases and flow of the requirement of system, statistics shows, except in different submicroseconds the time interval, average nearly 25% video flowing request is to same film, and the part greater than 50% that the distribution of image can make these submicroseconds require drops in one group of 15 film section.
One aspect of the present invention is to use only technology to satisfy this requirement.One random access boxlike loader (for example IBM Corporation produce) is that a kind of each band has high storage capacity, and can automation ground in each drawer pack into 100 tapes and each drawer have the numerical tape system of two tape drives at most.So just can provide effective tape library for the video on demand system.The present invention can also provide the mass memory of film with numerical tape thesaurus system cheaply, and the lower film of those program request rates is directly forwarded to the buffer memory of speeds match from tape, forwards to then on decompress(ion) and the allocated channel and play-overs.
The another one advantage that adds the storage of classification band in video system is: when disk is not worked, any film on the disk is backed up fast.General one " standby " disk that keeps in the canonical system, if a certain like this dish has been broken, film can reload from being with.This combines with the system of RAID or similar RAID usually.
B2. disk storage system
When the requirement to video flowing reached a higher level, more efficient methods was whole film is stored on the disk and can the release system be used for continuing from taking the performance cost of dish transmission video data to.Because the quantity of common film generally is 10x-100x in the tape library, greater than the quantity of arbitrary moment broadcast, so exemplary systems still keeps storage film vault on tape.When the user asked to play a particular film, each of this film section was installed into a disk storage node 16 and begins to play from that.
When many users want to see same film, preferably film is retained on the disk.These films generally are the silver screen hits in this week; And before the time is watched on the peak, they are installed on the dish from band.This can reduce the load of system in the peak period.
B3. the film of high-speed cache output.
Along with the requirement to silver screen hits is increased, media streamer 10 is according to determining crucial film advance in high-speed cache based on the MRU algorithm.This needs bigger high-speed cache, but with regard to price/active flow percentage, high-speed cache has high output to reduce the whole cost of media streamer 10.
Because the attribute of video data, and system always just knows to play which video in advance, how long need which data and use next time, so can adopt the whole bag of tricks to make the use of high-speed cache, inner buffer, magnetic disk memory, tape loader and bus performance etc. reach optimization.
The algorithm of placement and distribute data makes the transmission of isochronal data satisfy a very wide bandwidth requirement between each storage medium.Because it is 100% predictable that the transmission of isochronal data is actually, so its algorithm is different fully with the traditional algorithm that is used for other section of computer industry, wherein the user can both not predict the visit of cached data.
C. data flow architecture in the media streamer
As mentioned above, media streamer 10 can send video flowing to various output terminal such as televisor and the set-top box that link to each other with net by network (as LAN (Local Area Network), Asynchronous Transfer Mode etc.).In order to satisfy to memory capacity and the requirement of fluxion amount simultaneously, a kind of distributed frame that comprises a plurality of storages and communication node of inventor.Data storage transmits on memory node 16,17 and by communication node.One communication node 14 obtains data from suitable memory node 16,17.Control Node 18 offers the external world with an individual system image.Node links by intersecting continuous low wait breakout box 12.
For each stream, the speed of data all is predictable with data to be transmitted.The present invention utilizes a kind of data that can make full use of resource and can guarantee each stream of this predictability structure prepared data flow structure when each stage needs.
Memory node 16,17 can be set up with some different modes with the data stream between the communication node 14.
Communication node 14 generally is used to transmit a plurality of streams.It has the uncompleted request of data for each stream, and desired data may be from different memory nodes 16,17.If different memory nodes are prepared to send data to same communication node simultaneously, have only a memory node can send data so, and other memory node will be blocked.Blockade will impel these memory node retries to send data, and reduce the use of exchange, and the memory node that can not make an immediate response simultaneously sends the request of data to communication node.The situation that an input port of a communication node 14 of different memory node contentions can not occur in the present invention.
The capacity of required buffer memory can be determined with following method: communication node 14 determines to send one asks to memory node 16,17 and receives this data required averaging times.For determining this time, can will send the time of asking to memory node, receive the time of response and handle the required time addition of this request to memory node.Then memory node by will be from disk reading of data required averaging time with handle any delay of taking place when asking clearly Calais averaging time of determining to handle request mutually.This is the wait of handling in the request.Required buffer memory capacity is to cover by stream data rate to wait for required memory span.Scheme described below has to reduce under Media Stream portion environment to be waited for, thereby reduces the advantage of resource requirement being waited for specific condition.By use just in time punctual (just-in-time) dispatching algorithm to reduce wait in each level (that is: between communication node and memory node) of data with predicting request of data from previous stage.
Eliminate the contention of the input port of 16,17 pairs of communication nodes 14 of memory node by using following two criterions:
1) memory node 16,17 only just sends data to a communication node 14 when receiving a specific request.
2) communication node 14 of an appointment is with all requests orderings of preparing reading of data from memory node, and it is unsettled all having only a request that receives data from communication node 14 so at any time, and the quantity of the stream that is transmitting with communication node 14 has nothing to do.
As mentioned above, the minimizing of wait is relevant with " just in time punctual " dispatching algorithm of each grade.Cardinal rule is in each level of the data stream of a stream (stream), and when to the request comes of these data, data just can be used.This can reduce the request of sending and finish any data and transmit wait on the required time.So, when Control Node 18 when memory node 16 sends request of data to a specific stream, memory node 16 almost can be immediately to asking.This characteristic is very important for solving aforesaid contention problem.
Because under the media streamer environment, are orders to the visit of data, and first-class data rate is predictable, so memory node 16 can predict that what arrives constantly for next request of data of a specific stream.It also is known according to request what sign being data added, and memory node 16 is also known deposit data somewhere, and the request to other stream of expectation.Providing these information and handling after the expectation time that a dish is read to ask clearly, memory node 16 scheduling read operations are so that data were just in time being asked clearly before communication node 14 arrives and can used.For example, if stream data rate is 250KB/ second, memory node 16 comprises each the 4th section an of video, so, will arrive every 4 seconds the request of data of this stream.If handle the time of a read request and be 500 microseconds (be sure of that read request will finish) in 500 microseconds, so, before the request from communication node 14 of receiving prediction, this request is arranged 500 microseconds at least.
C1. the function of Control Node 18
The function of Control Node 18 is that an interface that is used to control stream is provided between the media streamer 10 and the external world.Even media streamer 10 itself becomes a distributed system, it also represents an individual system image to external world.The Control Node function can be realized by a defined Application Program Interface (API).API is provided at the function that produces video content in the media streamer 10, and such as some real-time functions such as play-/ record video datas.Control Node 18 will be play or stop to ask clearly in real time of displaying video and send communication node to.
C2. communication node 14
Communication node 14 has the following dispatch group (same process) that is used for handling a real-time video interface: one handles the dispatch group of connections/disconnections request, and a processing is play/stopped and playing and suspend/dispatch group of restarting to ask and the dispatch group of a processing transfer request (look for forward or look for backward).In addition, it also have for first-class from memory node 16 read datas the input scheduling group and data are write an output scheduling group of output port.
Fig. 3 has described a data flow architecture that is used for deal with data during playing a video on communication node 14.Data flow architecture comprises an input scheduling group 100 of obtaining data from a memory node 16.Input scheduling group 100 will receive the operation queuing from the memory node data, so that having only quarter a memory node to send data arbitrarily for the moment.Input scheduling group 100 will guarantee need deposit into row and write out when operation first-class postponing when an output scheduling group 102, and data have been housed in this buffer memory.In addition, also have one to be used for convection current and to import scheduling feature 104 with output scheduling, this function is transfused to simultaneously and output scheduling group 100 and 102 is used.
Each dispatch group is removed a request queue.The request queue 106 that is used for output scheduling group 102 comprises the request of the related cache of discerning stream and pointing out to empty, and the time-sequencing of video output interface is write in these requests on demand.When output scheduling group 102 empties a buffer memory, it is masked as sky and wakeup schedule function 104, to the request queue of the input queue 108 that is used for input scheduling group (be used for to be filled buffer memory).The formation 108 of input scheduling group 100 is also arranged the time sequencing that is filled by buffer memory.
Input scheduling group 100 also is responsible for removing and is pressed the request queue 108 that request time is arranged, and its task is to fill buffer memory from a memory node 16.For each request in the formation, input scheduling group 100 is taked following action.Input scheduling group 100 is determined to have flow data and (video stream data is divided into the memory node 16 of next section of thread on a plurality of memory nodes.Input scheduling group 100 is sent a request (using the information by breakout box 12) request flow data to this memory node of determining then, waits pending data to arrive then.
This agreement guarantees to have only at any one time a memory node 16 to send data to a particular communication node 14, has promptly eliminated a plurality of memory nodes and has sent the conflict that data were caused with asynchronous system to a communication node 14.When memory node 16 receives requested data, input scheduling group 100 special buffer memorys are masked as full and wakeup schedule program 104 is cached to output scheduling group 102 with a request (according to the data rate of stream), to empty this impact damper.
C3. memory node 16
Fig. 4 has described the data flow architecture that memory node 16 is used to support first-class broadcast.Memory node 16 has a dynamic area that comprises video data.It also has an output scheduling group 112 that is used for an input scheduling group 110 of each logical disk drive and data is write communication node 14 by breakout box.It also has one to be transfused to and output scheduling group 110,112 use scheduling features 114, dispatches various operations.It also has the dispatching message group 116 of a processing from the request of the communication node 14 of request msg.
When the communication node 14 from a request msg receives a message, under the normal condition, message accent group 116 will be found the data of being asked in buffer memory, and the formation (formation 118) of output scheduling group is delivered in this request, will ask to arrange in chronological order.Output scheduling group 112 will empty buffer memory and it will be added in the free buffer table.Each input scheduling group 110 has the request queue of oneself.For each active flow that video data is arranged, all keep a formation 120 by request time (based on data rate, the thread level) ordering of filling next buffer memory on the associated disc driver.This dispatch group is taken out first request from formation 120, the I/O request that distributes a free buffer and send data filling buffer memory in the usefulness dish.When buffer memory is full, it is joined in the fully loaded cache table.When dispatching message group 116 received the request of data of relevant stream, checking should fully loaded cache table.When receiving that from a communication node 14 data message and required buffer memory are discontented with, this situation is considered to a drain electrode limit.
C4. " just in time punctual " scheduling
A kind of " just in time punctual " dispatching technique is used on communication node 14 and the memory node 16.This technology is used following parameters:
The cache size of bc=communication node 14;
The cache size of bs=memory node 16;
R=video stream data speed;
N=comprises the Thread Count of video stream data video;
Sr=thread-data speed; With
Srï¼r/n
The algorithm that uses is as follows:
(1) sfc=on communication node to the request frequency of a stream
=r/bc; With
(2) frequency of dfc=disk read request on memory node
ï¼sr/bsã
To describe " thread " of video data in detail at the H joint.
According to the frequency that above formula is determined request is dispatched, so that before the needs data, promptly finished request.This can realize by inject data pipe with data when broadcast one video flowing begins.
Connecting sfc and the dfc that calculates constantly on the communication node 14 of play stream and the memory node 16 that comprises video data.Frequency (or its inverse, i.e. cycle) is used to scheduling from the input of memory node 16 (referring to Fig. 4) dish and the output of dispatching communication node 14 (referring to Fig. 3) port the input of memory node (and from).
Just in time the example of punctual scheduling is:
Be segmented in four video flowings of depositing on the node of mansion with 2.0 megabit per seconds (250,000 byte per second) broadcast by thread.And the buffer size on the hypothesis communication node is that 50,000 bytes, the buffer size of dish on the node are 250,000 bytes, and hypothesis is divided into thread by the section of 250,000 byte per seconds with data simultaneously.
" just in time punctual " algorithm is as follows by the value of each parameter:
Bc=250,00 byte (buffer size of communication node 14);
Bs=250,000 byte (buffer size of memory node 16);
R=250,000 byte per second (stream data rate);
N=4 (video flowing is divided into the number of thread);
Sr=r/n=6250 byte per second or 250,000/4 seconds, that is: per 4 seconds 250,000 bytes;
Sfc=r/bc=1/ second, (request frequency on the communication node 14); With
Dfc=r/bs=1 second, (request frequency on the memory node 16).
Be responsible for play stream communication node 14 by the frequency of per second 1 time or at interval the input and output request was dispatched in 1.0 seconds.Suppose that communication node 14 has two buffer memorys that are used for this stream, communication node 14 will guarantee before the beginning outputting video streams two buffer memorys to be filled.
Connecting constantly, communication node 14 will be sends to message on four memory nodes 16 that comprise a video data thread.Preceding two memory nodes can predict fills buffer memory to the request and the dispatcher's board request of first section of thread.Communication node 14 will be dispatched input request (referring to Fig. 3) preceding two sections will be read in the buffer memory, and each cache size all is 250,000 bytes.When a playing request arrives, communication node 14 will guarantee at first that these two buffer memorys are full, notify all memory nodes 16 to play and will begin then.Afterwards, it begins to play this stream.When first buffer memory has begun to export (speed by 2 megabit per seconds or 250,000 byte per seconds will need 1 second), communication node 14 requests are from the data of a memory node 16.Then, communication node 14 is in order every the data of request in 1 second from each memory node, that is: it will be every the data of request in four seconds from a particular memory node.It all asks 250,000 bytes at every turn.Communication node 14 calculates joint 16 is deposited in the communication node request from storage data frequency constantly in connection.
Storage joint joint 16 is predicted the request of stream data in the following manner.The memory node 16 (referring to the H joint) that comprises thread 3 begins can predict to the request of next 250,000 byte section and every 4 seconds in back one second in broadcast and carries out once.The memory node 16 that comprises thread 4 can prediction one be asked and carry out once every 4 seconds after broadcast begin 2 seconds.Also promptly: each memory node 16 carved from the outset with every the frequency of 4 seconds 250,000 bytes to dispatching from the input of dish.After receiving a play command and after first-class buffer memory has been output, the scheduling on memory node 16 is finished.The frequency of computation requests is carried out when receiving the connection request.
On communication node 14 and memory node 16, also can use the buffer memorys of different sizes.For example, the buffer memory of communication node 14 can be 50,000 bytes, and the buffer memory of memory node 16 is 250,000 bytes.In this case, the request frequency of communication node 14 will be (250,000/50,000) 5 times/second or every 0.2 second once, and the request frequency of memory node 16 is still 1 time/second.Communication node 14 is read preceding two buffer memorys (100,000 byte) (note: the size of section is 250,000 bytes and comprises first section memory node 16 and will connect constantly to dispatching from the input of dish) from the memory node that comprises first thread.When playing beginning, communication node 14 is notified this memory node 16 and data in its first buffer memory is exported.When buffer memory is sky, communication node 14 next input of scheduling.Buffer memory will be just empty every 0.2 second, and communication node is by the input of this frequency request from memory node 16, simultaneously also by this frequency scheduling output.
In this example, memory node 16 can predict soon 5 requests arriving at interval at 0.2 second (except first section 100, outside 000 byte has been read, after playing beginning, to arrive every first three request in 4 seconds, that is: after last four seconds of asking clearly of last sequence, next group five requests (each is 50,000 bytes) sequence will arrive).Because the cache size of memory node is 250,000 bytes, memory node 16 will be every the input (with above-mentioned example identical) of scheduling in 4 seconds from dish.
C5. the details of playback action
Follow these steps to follow the tracks of the control stream and the data stream that are used for first-class playback action.Fig. 5 has described the step that is used to start a video playback.Step is according to time sequence.
1) user sends an order, disposes the port of the particular video frequency of having packed into.This request is sent to Control Node 18.
2) dispatch group of Control Node 18 receives this request and a VS-CONNECT function.
3) dispatch group of Control Node is opened video session inlet, and sets up a memory descriptor that is used to have the video of the fileinfo that is divided into thread.
4) Control Node 18 is distributed the output port on a communication node that is used to ask 14 and this node.
5) communication node 18 sends to a message on the communication node 14 of distribution.
6) dispatch group of communication node 14 receives this message from Control Node 18.
7) the communication node dispatch group sends one to the memory node 16 that comprises the thread file and opens request.
8), 9) dispatch group that is sent out each memory node 16 of the request of opening receives this request, and opens requested thread file, distributes resource requirement, and to dispatch (if the thread file comprises the first not enough section) from the input of dish.
10) dispatch group of memory node is beamed back one to the communication node 14 with thread file identification and is replied.
11) dispatch group of communication node 14 is waited for the answer from all relevant memory nodes, and when receiving successful respond, is the flow distribution source, comprises output port is set.
12) then scheduling input of communication node 14 is to set up the video data streamline.
13) communication node 14 is beamed back one to Control Node 18 then and is replied.
14) the Control Node dispatch group is returned a traffic identifier to the user after the successful answer that receives from communication node 14, can be used for the subsequent request relevant with the stream in this example.
After a video flowing is successfully set up, take following step according to time sequence to receive playing request.Fig. 6 has described these steps.
1) user sends play command.
2) dispatch group of Control Node 18 receives this request.
3) dispatch group of Control Node 18 confirms that this request is the stream of having set up at, sends to playing request on the communication node 14 that has distributed then.
4) dispatch group of communication node 14 receives this playing request.
5) communication node 14 sends this playing request to all relevant memory nodes 16, and they just can be according to the operation of the prediction scheduling of this being flowed subsequent request oneself like this.The memory node of " relevant " is meant that those have stored the memory node of the thread of a useful video image at least.
6) dispatch group of each relevant memory point 16 receives this request and is stream request foundation scheduling on the horizon.Each relevant memory node 16 is beamed back one to communication node 14 and is replied.
7) dispatch group of communication node will guarantee that streamline is set up (prepackage video data) and permission stream is exported.
8) communication node is beamed back one to Control Node 18 then and is replied.
9) control node 18 knot users beam back first-class in progress replying.
Input continues to transmit this video image to particular port with the output scheduling group, finishes up to receiving a stop/pause order or video.
D. the interface of media streamer and user and application program
Media streamer 10 is passive-type servers, and it only just carries out the Video service operation when the control command that receives from an external control system.Fig. 7 has described the system configuration of application program of media streamer 10 and the interface that this system provides.
Media streamer 10 provides the two-stage interface for user and application program, to control its operation:
-user interface (Fig. 7 (A)); With
-application programming interfaces ((B) among Fig. 7).
The two-stage interface all is provided on client's control system, and they can be communicated by letter with Media Stream portion body 10 by a remote procedure call (RPC) mechanism.By providing interface on client's control system rather than on media streamer 10, application software is separated with media streamer.This is convenient to the upgrading and the replacing of media streamer 10, because do not need to change or replace application software on client's control system.
D1. telex network
Media streamer provides two class user interfaces:
-command line interface; With
-graphical user interface.
D1.1. command line interface
Command line interface is gone up demonstration one prompt at user console or interface (65 among Fig. 1,66).After command prompt, the user can import one with the order order that keyword begins, parameter is followed in the back.After executing order, interface shows a prompt again and waits for the input of next order.The media streamer command line interface is specially adapted to following two kinds of operations:
Batch processing control: batch processing control is used to begin to carry out a command string that comprises a series of video control commands.For example. in broadcast service, can in advance command string be ready to, comprise the program that prerecord and that be ranked that can be used in cycle long period.In the zero hour that is ranked,, begin to broadcast and need not manual intervention by this command string of one single batch of command execution.
Automatically control: control is used to carry out a command list that is produced by a program automatically, is stored in data in the media streamer 10 with renewal/broadcast.For example, a news agency may all install to Media Stream spare 10 with new data every day.A utility control program of managing these new datas can produce the media streamer order (for example: pack into, deletion, dump) of upgrading media streamer with new data.These orders can be delivered to command line interface carries out immediately.
D1.2. graphical user interface
Fig. 8 is an example of media streamer graphical user interface.This interface is simulated the control panel of a video tape recorder, and it has such as control knobs such as playing, suspend, example is with and stop.In addition, when an operation needed the user to select, it (for example also provided option board; " packing into " needs the user to select the video image of desiring to pack into).Graphical user interface is highly suitable for direct user interactions.
In graphical user interface, also comprise one " batch processing " button 130 and one " changing over to/produce " button 132.Will be described later their function.
D2. user function
Media streamer 10 provides three classes universal user function:
Change over to/produce;
The Play Control of similar VCR; With
Advanced level user's control.
D2.1 changes over to/produces
Changing/produce function over to is used to that video data is sent to media streamer 10 neutralization and sends out video data from media streamer 10.When a video is sent to when (changing over to) the media streamer 10 from client's control system, an equipment of a file or client's control system can be appointed as video data source.In media streamer 10 with the target of unique name designated data.When a video being spread out of (producing) deliver to client's control system from media streamer 10, so in media streamer with its own name as video data source, and the target of video data is appointed as an equipment of a file or client's control system.
Changing over to/producing in the class user function, media streamer 10 also provide the information that " deletion " function and that is used to remove a video is used to obtain the video of relevant storage (obtain attribute (get attributes) as name, data rate " function.
Change/produce function in order to call by graphical user interface, the user can be by " changing over to/produce " soft key 132 (Fig. 8).Can access like this that new comprising " changes over to ", " producing ", deletion ", obtain attribute " etc. the screen of button, thereby can call each function.
The Play Control of the similar VCR of D2.2
Media Stream 10 provides the Play Control of a category like VCR.Media streamer graphical user interface among Fig. 8 is expressed following operable function: pack into, eject, play, at a slow speed, suspend, stop, the example band, fast forward with noiseless.Can be by activating these functions by the respective softkeys on the graphical user interface.The media streamer command line interface provides function like the category:
Set up (setup)-be that a specific output port is set up a video.Be similar to the video band VCR that packs into.
Broadcast-startup is play a video of having set up or is broadcast a paused video again.
Time-out-time-out is play a video.
Lay down-simulate and from-VCR, eject a video band.
State-demonstration has been used port statuss such as how many reproduction times such as playing which video.
The control of D2.3 advanced level user
In order to support for example needs in the broadcast service of application-specific, the invention provides some users' controls:
Set up a plurality of videos to be played and formation thereof on playlist (play list)-at one end mouth.
The time of playout length (play length)-video that restriction will be play.
Batch operation (Batch operation)-the finish sequence of operations that is stored in the command file.
Can finish the control of playlist and playout length by " packing into " button 134 on the graphical user interface.Each " foundation " order will be specified a video that will join the playlist that is used for a particular port.This order is also specified time restriction for video to be played.Fig. 9 expresses on graphical user interface the screen that occurs by after " packing into " soft key, can be used for selecting one will join the video in the playlist and specify the time restriction of playing this video.When the user selects a filename in " file " frame 136, this document star enters " filename " frame 138.When the user presses " adding " button 140, filename in " filename " frame 138 and time restriction thereof will append in " playlist " frame 142, and show the current playlist time restriction of each video (and in the playlist).
By using one " batch processing " soft key on the graphical user interface (referring to Fig. 8), can finish batch operation.
When " batch processing " button 130 was activated, a user can select or screen (referring to Figure 10) is selected in the batch processing of input command file name with occurring.Press one " execution " button 144 that this batch processing is selected to shield, begin to carry out the order in the selected command file.Figure 10 is an example of " batch processing " and " execution " operation on the graphical user interface.For example, at first the user has set up a file " batch2 " that comprises a command string under the C:/batchcmd catalogue.The user presses " batch processing " button 130 on graphical user interface shown in Figure 8 then, batch processing occurs and selects screen.Afterwards, the user chooses " C:/batchcmd " in " catalogue " frame that batch processing is selected to shield, so just display file inventory in " file " frame 148.In " file " frame 148, choose " batch2 ", be sent in " filename " frame 150.At last, the user connects down " execution " button 144, thus order carry out be stored in batch2 " order in the file.
D3. application programming interfaces
Media streamer 10 provides above-described application programming interfaces (API), thereby makes utility control program can interact and control its operation (can again referring to Fig. 7) with media streamer 10.
API is made up of based on the process of remote procedure call (PRC) some.Utility control program activates api function by the invocation of procedure.The parameter of the invocation of procedure is used to specify the function that desire is carried out.Utility control program need not to consider the logical and physical location of media streamer 10 when calling api function.Provide the sign of a media streamer 10 of Video service both can when client's control system starts, also can when the utility control program initialization, set up.In case the sign of media streamer 10 is established, the invocation of procedure promptly is sent to correct media streamer 10 service is provided.
Except following point out, api function is handled by the method for synchronization, in case that is: a function call turns back to caller, this function has been finished and do not needed the auxilliary processing that adds in media streamer 10 so.Be set to synchronous operation by api function, just can exempt the auxilliary processing expenditure that adds that is used for text exchange, asynchronous signalling and feedback.Because to real-time strict demand, this performance is very important for video server application.
Processing to api function is by receiving request in sequence.So just can guarantee process user operation in the correct order.For example, a video should connect (foundation) earlier before being played.Another example is if follow the order of " time-out " request " broadcast " request to change a back, so, will produce diverse result concerning the user.
The VS-PLAY function starts the broadcast of video and immediately control is returned to caller (need not wait for that video playback is intact).The reasonable part of this structure is: the required time of playing a video usually all very long (a few minutes were to several hours) and unpredictable (might have suspend or cease and desist order); so by carrying out by asynchronous system; the VS-PLAY function can make it discharge resource as early as possible; can't predict that otherwise they will be taken for a long time to these resources.
When video playback was finished, media streamer 10 sent an asynchronous call to the one system/port address by the utility control program appointment, and notice utility control program video finishes.Appointing system/port address when utility control program connects video at the VS-CONNECT function that calls API.It should be noted that VS-PLAY's calls the appointment on each videl stage of retrieval system/port address.This is meaning utility control program and can freely special video finishing message and send to any reference mark.For example, a certain application program may wish to use a lot of or all client's control system processing videos of a center system/port to finish message.And in the Another Application program, may use several different system/port addresss is that client's control system processing video is finished message.
This structure of API can make media streamer 10 can support a plurality of parallel client's control system with special-shaped hardware and software platform, can handle the synchronous versus asynchronous operation effectively simultaneously, can also guarantee the correct order of operation requests simultaneously.For example, media streamer 10 can run on the IBM os/2 operation system in the PS/2 system, and the use of client's control system is the IBM AIX operating system (IBM, OS/2, PS/2, AIX and RS/6000 are the trade marks of IBM) that operates in the RS/6000 system.
D4. the communication between client/media streamer
Can pass through, for example, known remote procedure call (PRC) mechanism is carried out communicating by letter between client's control system and media streamer, and Figure 11 has provided and has been used for the PRC structure of communicating by letter between client's control system 11 and the media streamer 10.In calling the media streamer function, client's control system 11 is as PRC client, and media streamer 10 is then as the PRC server.This is expressed as (A) in Figure 11.Yet, can make media streamer 10 produce calling to client's control system 11 such as finishing of asynchronous function such as VS-PLAY.In this case, client's control system 11 is as the PRC server, and media streamer 10 is PRC clients.This is expressed as (B) in Figure 11.
D4.1 client's control system 11
In client's control system 11, the user command line interface is made up of the process (dispatch group) of three inner parallel processings.First process is carried out language analysis and is finished institute's requested operation by calling api function user command row input, wherein calls api function and can cause the PRC of media streamer 10 is called ((A) among Figure 11).This process can also be followed the tracks of the state of the video of setting up on each output port and playing.Second process contrasts the time bar of appointment periodically and checks each video reproduction time of usefulness.If a video has reached its time bar, this video will be stopped and disconnect, and begins to play next video (if any) in this output port waiting list.The 3rd process in client's control system 11 receives from the VS-PLAY asynchronous interrupt of media streamer 10 as a PRC server and notifies ((B) among Figure 11).
D4. media streamer 10
Between 10 starting periods, there are two concurrent processes (dispatch group) to be waken up at media streamer to support the RPC between client's control system 11 and the medium body stream unit 10.First process is as a PRC server ((A) among Figure 11).Being used for this first process that the api function from client's control system 11 calls receives PRC and calls and dispatch suitable process and finish the function of being asked (as VS-CONNECT, VS-PLAYVS-DISCONNECT).Second process is used to call suitable client's control system address and notifies utility control program with asynchronous End Event as a PRC client.This process is locked in oneself it on internal pipeline and waits for, this pipeline is write by other process of handling video playback.When video finishes or a non-normal termination state occurs, handle the process of video playback; In this pipeline, write a message.The process that is lockable is read this message and a PRC is called ((B) among Figure 11) deliver on the port address of suitable client's control system 11, thereby makes client's control system can upgrade its state and take corresponding action.
E. be used for the storage administration and the optimization of the media streamer of video transmission
One aspect of the present invention provides and can transmit the integration mechanism that incorporates cache management and relevant I/O operation in the environment at video.Below this respect of the present invention is described in detail.
All added the art mechanisms that is used for cache management in the file subsystem of director cache and operating system, they are applicable to general objects, but can't satisfy the needs that video transmits.
Figure 12 has described a kind of method that traditional cache management mechanism is used for the video transmission.This technology has used a video and that is divided into two disk files 160,162 (because too big for a file) to comprise the processor of a file system 164, a media stream server 168 and a video driver 170.It also describes two adapter ports 172,174 that are used for two video flowings.Figure 12 has also described a section of will coil file 160 and has read primary memory and then it is write the data stream of first video port 172, to read identical section and it is write the data stream of one second video port 174.Figure 12 is used for describing that prior art exists and problem that medium fluid spare 10 of the present invention can solve or overcome.
The description of steps A 1-A12 among Figure 12
A1. media server 168 is in harmonious proportion file system 166 section SK is read a buffer memory in the video driver 170 into.
A2. file system 166 is read a high-speed cache in the file system 166 into the part of SK.
A3. file system 166 backups to a buffer memory in the video driver 170 with high-speed cache.
Steps A 2, A3 are repeated repeatedly.
A4, file system 166 are called video driver 170 SK are write video port 1 (176).
A5. video driver 170 with the SK incremental backup in a buffer memory of video driver 170.
A6 video driver 170 is write video port 1 (176) with the content of buffer memory.
Steps A 5 and A6 repeat repeatedly.
Steps A 7-A12 effect and above similar only makes port one into port 2.When needs were used for SK a part of of port 2, it just in time existed in the high-speed cache of file system 166, then can skips steps A8.
As what it has been recognized that, video transmits the multiple data stream that relates to mass data and transmits.The pattern (at random with order) that two kinds of tradition are used to optimize high-speed cache all is not suitable for this comprehensive use pattern.If the selection random pattern, what comprise in so most of high-speed caches will be the video-frequency band data of being read recently, but before their expirations, will not have video flowing on the line and read them.If the selecting sequence pattern, the so the last high-speed cache that is used will at first be used again, and need the probability of section part very little so can find in file system cache.Just as described previously, the extremely important problem that video transmits is that ground transmits data stream when waiting, and is promptly uninterrupted, otherwise the user will raise an objection.The cache mechanism of prior art is sent to the user when as previously discussed, can not guarantee with video data stream etc.
Also narrate following problem among Figure 12:
A. disk all disposes than segment by relative with the video input/output end port, to satisfy the needs of general file system.This will be than designing the more processing time of cost by the video-frequency band size, interrogating and examining and change pin and bus expense.
B. be one not wish the expense that occurs in the required processing time of Backup Data between file system cache and the media server buffer memory and between media server buffer memory and video driver buffer memory, should eliminate it.
C. as use two video caches (promptly 172,174) to comprise the backup of same video section in the identical moment), then do not fill and part utilize primary memory.When same data both had been stored in the buffer memory of also storing also video driver in the file system cache can more waste.
E2. the management of video optimized high-speed cache
Management according to high-speed cache of the present invention mainly divides three aspects: by the high-speed cache of stream shared segment length; The high-speed cache of prediction; Synchronously to optimize high-speed cache.
E2.1 is by the high-speed cache of stream shared segment length
By fixed-size segments storage and management video.Section is numbered in order, and like this, for example section 5 is compared with section 6, the beginning part of section 5 more close videos.The size of section is selected the I/O with the optimization dish, the I/O of video, the use of bus and the use of processor.A video-frequency band has convention, and it is only relevant with the sequence number of section with video name.All I/O last to dish and video output terminals, and all cache operations all align according to segment limit.
Whether of the present invention this is supported to take two kinds of patterns with layer peering according to bottom hardware on the one hand, wherein being meant with layer peering can be in a communication node 14, directly between dish and video output card, transmit data, and need not be through the high-speed cache in the communication node.For with layer peering, be cached in the disk storage unit 16.For the hardware of not supporting with layer peering, directly data are read into by in the continuous high-speed cache of page alignment (in communication node 14), so that I/O operation and data move minimum by the piece of section size design.(distributing) referring to following video optimized stored digital.
Data are retained on the same address always, and directly write from this address, till no longer needing this video-frequency band.When video-frequency band existed in the high-speed cache, all needed the identical speed buffering of video flowing visit of output video section.So many users only use the copy of a single video-frequency band, thereby avoid using the extra I/O that is used to read same video section copy, processor and buffering storer.For with layer peering, on communication node 14, can save the I/O of half and nearly all processor and primary memory.
Figure 13 has described one embodiment of the present of invention, is used for not having the system with layer peering.Video data is divided into thread on disk storage node 16, thereby the even number section is divided on memory node as first 180, the odd number section is dispensed to (referring to the H joint) on the second disk storage node 182.
Figure 13 has also described the data stream of this configuration.As what can see, section SK is read from coiling 182, deliver in the speed buffering of communication node 186, and then it is write video-out port 1 and 2.By an I/O operation video-data fragment SK is directly read in high-speed cache 184, write into port one then.Then video-data fragment SK is write port 2 from high-speed cache 184 by the I/O operation.
As can be seen, the system described of Figure 13 can overcome the problem that traditional approach that Figure 12 describes brings fully.
Figure 14 describes one and is used to comprise the data stream of supporting the configuration of same layer peering between a disk storage node and the video output card.A pair of disk drive 190,192 comprises a video image that is divided into thread, can directly it directly not fed in a pair of video port 194,196 by the primary memory of a communication node 14 that inserts.
The data stream of this configuration is directly from coiling 192 section SK to be read port one (an I/O operation) through disk cache 198.
If then be one section SK to be read calling of port 2, so, section SK will directly be read port 2 (an I/O operation) from disk cache 198.
Read into the data of disk cache device 198 when the quilt that is used for port one and still exist when being written to port 2, use storer, the best approach of resources such as bus and processor is that video-frequency band is sent to port one and port 2.
Can will combine with layer peering and primary memory cache mechanism, for example, use a layer peering together for the video image of only on communication node 14 1 ports, playing, and the video image of playing is used the high-speed cache of communication node 14 on communication node 14 multiports.
A kind of strategy that distributes high-speed cache between disk storage node and communication node is to make the quantity of the video flowing that a given hardware configuration supports reach maximum.If the video fluxion of supporting is known, so just can determine the size and the layout of high-speed cache.
The predictable high-speed cache of E2.2.
A kind of predictable cache mechanism can satisfy the needs that video transmits.In general video figure is predictable.Normally begin to play, in a scheduled period, play, have only the latter end of arrival just to stop by a fixed rate from the beginning part.The cache policies of media streamer 10 utilizes this predictability to make at any one time, and the video-frequency band group of high-speed cache reaches optimum.
This predictability both can be used to dispatch a read operation to fill a high-speed cache, also can drive to be used for again by the algorithm of asking high-speed cache.Its expiration that is buffered in that those its memory contentss are unpredictable will be applied for again immediately that Free up Memory is to be used for higher priority before.Those its memory contentss will not applied for again at a buffer memory that uses just on line within reasonable time, even its last use is also not application again before for a long time.
More specifically say given video V1, V2 ..., with the stream S1 that plays these videos, S2 ... the schedule time that each stream sj plays a video V (sj) and writes the R-th section of V (sj) is a linear function:
t(sjï¼k)ï¼a(sj)+r(sj)kï¼
Wherein a (sj) and start time relevant with the beginning segment number, r (sj) plays one required constant period, and t (sj k) is the schedule time of the k-th section of play stream sj.
These information are used to dispatch a read operation and re-use algorithm to fill a high-speed cache and to drive high-speed cache.The example of the algorithm of some management of cache operations is as follows:
Example A
Reusing before any its broadcast is predictable buffer memory, reusing the high-speed cache of the video-frequency band that comprises unpredictable its broadcast.Satisfy after this restriction, the frequency of displaying video and segment number are used to determine to keep video-frequency band by the priority of caches.The highest reservation priority in the group is given the video-frequency band that in a frequency displaying video, occurs the earliest.
Example B.
For the speed buffering of the video-frequency band that comprises measurable its broadcast, the quantity of the stream of not playing that next reproduction time of prediction and this video are also remaining is used to determine to keep video-frequency band by the priority of high-speed cache.The standard of this definite priority can make poor between the prediction number of cache buffer I/O prediction number that the reservation top grade of a high-speed cache is set up or reuses and its reservation.
For example, if
V5 just plays on S7
V8 just plays on S2 and S3, S2 than S3 lag behind 5 seconds and
V4 is flowing S12 to S20 and go up to play, and each stream is than 30 seconds of the first-class hysteresis in back,
So:
Used by S7, the buffer memory that comprises the V5 data will at first be reused,
Then be the buffer memory that comprises the V8 data that is used by S2,
Be the buffer memory that comprises the V4 data that is used by S12 after this,
Be other buffer memory at last with minimum reservation priority.
The cache management algorithm provides different schemes for various specific example, these specific example such as join operation (can predict in a video-frequency band that will be played recently, but can not predict correct time) and shut-down operation (when previous prediction must be modified).
E2.3 makes stream synchronously to optimize high-speed cache
Wish all are asked the stream cluster of a particular video frequency section,, thereby stay more power system capacity for other video flowing so that this section is retained in the time minimum of high-speed cache.For video playback, the speed that section is play is normally fixed.Yet in some video delivery application, the speed of broadcast is variable (that is: video and audio frequency can be quickened slightly and slow down, and can not impact people).In addition, the video of transmission may not be to watch immediately for people.When the variation on the speed is permission, to play stream in front with the speed that minimum allows, and play the stream of back with the speed of maximum permission, gap between flowing with elimination and minimizing section are retained in the time in the buffer memory.
During connection and play operation, also consider to use the stream cluster of same representation of video shot.For example, VS-PLAY-AT-SIGNAL can be used to begin to play a video at synchronization on a plurality of streams.This can improve cluster, leaves the more system resource of other video flowing for and improves the useful capacity of system.More particularly, by with a flow delay a period of time so that it overlaps with one second stream in time, such cluster operation can make a backup in high-speed cache stage casing be used by two streams, thereby saves the resource of handling usefulness.
F. the distribution of video optimized number storage
Digital of digital video data has the different attribute of handling with normal data of data, and it is nonrandom, and is order, a large amount of and in time than stricter on the content.Multiple data stream must transmit by high bit rate, and all inessential expenses on the data routing are reduced to minimum.Need to adopt good buffer memory management method, so that the efficient of media streamer 10 and capacity maximum.Memory allocation, release and visit are the key factors in this processing, and incorrect use can make storer be divided into little fragment, lower efficiency, and postpone or the damage video data.
Media streamer 10 of the present invention has used a kind of storage allocation process, and it can make high-level applications is that digital of digital video data distributes and discharges non-swappable, page alignment, continuous memory paragraph (piece).This process provides simple, a high-level interface for the video delivery application program, and uses low-level operation system module and the big or small on request memory allocated piece of low sign indicating number section.These storage blocks are continuous and fixing on physical storage, can eliminate in the virtual store delay and damage that exchange or paging bring, and can eliminate the complicacy of having to use focusing/dispersion in data transmission software and bringing.
This high-level interface is also sent the various relevant addressing mode values that are requested storage block back to, thereby does not need the higher dynamic address conversion of cost to adapt to the needs of various running memory modules of while in the Media Stream environment.Process linear address and process sectional address that miscellaneous equipment driver (as a hard disk drive) can directly be visited its physical address and be used by various application programs.One release procedure can return to system with a storage block, because whole storer returns as one single, has just eliminated the storage fragmentation problem like this.
H. be used for the order of storage allocation
1. distribution physical storage:
By the big or small memory allocated piece of request, return the controll block with length of each memory module address of memory block and piece.
2. release physical storer:
Storage block is returned to operating system and discharges relevant memory pointer.
The F2 application programming interfaces
In CONFIG.SYS the definition one device driver and when system start-up automatically with its initialization.One application program is opened this device driver then, and it as a pseudo-device, and is obtained its mark, then uses interface to transmit order and parameter.The order of being supported is allocate memory and discharges storer that parameter is the address pointer of memory size and logical storage.These addresses are designated and physical address changed into logical address when the physical block of allocate memory.If distribute failure, then return null value.
Figure 15 represents one group of application program of using this process.One 32 application programs are sent request of data to buffer memory 1, are put in the buffer memory 2 after the data modification.16 application programs or a physical equipment (a for example hard disk drive) that uses sectional address can directly use this buffer memory.This allocation model predistribution is fixing by using, buffer memory physics and continuous, and each application program can be used its own first level address visit data, and does not need address translation and elimination not to distribute caused delay by dynamic memory.One video application can make in this way, by directly video data being put in the buffer memory from physical disks, directly sends it to output device then, need repeatedly not move in processing, reduces to minimum thereby data are moved.
G. the dish that is used for Video Applications drives optimization
It is very important being sent to its destination during with video flowing etc., that is: do not have the sentient image of any human eye and move discontinuous and the interruption sentient sound of people's ear.Current disk technology relates to cyclic behaviour, and for example operation can cause the measurable error analysis of delay in data access.Although most of I/O operations can be finished in 100 microseconds, the cyclic delay of 100 microseconds is common and whole 3 seconds delay may take place.
Media streamer 10 can be kept high data transfer rate effectively.If it is a disk drive that is used for the routine data storage and retrieval is not the video server application program optimization,, all effective inadequately in the use of SCSI bus and dish capacity so for the memory disk buffer memory.
According to the disk drive of one aspect of the invention can by optimization dish parameter smoothing, etc. the time ground transmit mass data.These parameters can add when manufacturing is exclusively used in the disk drive of video server, and perhaps they are can be by the variable of an order mechanism setting.
The parameter that the control cycle sexual act is set postpones or makes to postpone minimum to eliminate.Being provided with influences parameter that buffer memory uses to transmit lot of data in a single read or write.Adjust the parameter that influences speeds match between a SCSI bus and the processor bus so that data transmit both also not too slow not too soon.Magnetic disk medium itself formats so that useful capacity and bandwidth maximum by a sector-size.
In order to finish optimization:
By greatest physical sector-size format physical disks medium.This format mode can make the space minimum of being wasted in the gap between the sector, and makes the capacity and the pulse series data speed maximum of equipment, and a preferred plan is the sector of 744 bytes.
Disk can have a buffer memory that is associated.This buffer memory is used to read data from magnetic disk medium, and it is delivered to asynchronously is used on the bus that data transmit.Equally, this buffer memory also is used to preserve the data that come from bus, and it is delivered in the dish medium asynchronously.This buffer memory can be divided into some sections, and the quantity of section is controlled by a parameter.If the hop count that divides is too many, each section is too little so can't be contained in the data volume of being asked in the single transmission.When buffer memory was full, equipment must start to connect and begin and transmits, if bus/equipment is not ready for constantly at this, with circular wait.In most preferred embodiment, set this value, so that each buffer memory section is the same with data transmission size at least, that is: set 1 for.
In read operation, when a buffer memory section began to fill, dish was attempted to connect with bus again, so that data are sent to main frame.The moment that dish is attempted to connect again influences the efficient that bus is used.The relative velocity of bus and dish has been determined the best time that beginning transmits data to main frame during padding.Equally, when write operation, buffer memory will be come from the data of main frame fills, and in a certain moment of filling process, dish should be attempted to connect with bus again.Speeds match can reduce disconnection in SCSI bus/select cycle index more accurately, thereby produces higher handling capacity.
The parameter in the moment that control is attempted to connect again is referred to as " reading the full rate of buffer memory " and " writing the empty rate of buffer memory ", for video data, the preferred algorithm that is used to calculate these values is 256 * (instantaneous scsi data transfer rate-continue data in magnetic disk transfer rate)/instantaneous scsi data transfer rate.The preferred values that is used for full rate of buffer memory and the empty rate of buffer memory at present is 204.
The design of some disc drivers need vary with temperature demarcates head position periodically again.Can also further control some type disks: be at one time all magnetic heads in an assembling to be done thermal compensation, still only a magnetic head done thermal compensation constantly one.If at one time all magnetic heads are done thermal compensation, the delay of hundreds of millisecond then can appear in video data read operation process.Read data operating period can the bigger primary memory buffer memory of demand than long delay so that data stream smoothly reaches the artificial trace of eliminating in the multi-media image.With the better method of magnetic head thermal compensation control function programming is that synchronization compensates a stature.
The preservation of error log and the analysis of fault predictive all need just can finish several seconds.If do not have bigger primary memory buffer memory smoothed data, eliminate the artificial trace in the multi-media image, then video server application can't be stood this delay.Free time restricted function parameter can be used to stop error log preservation and free time function operation.Most preferred embodiment is provided with a parameter and limits these functions.
H. the data thread that is used for video data
In video application, be necessary to send a plurality of streams from identical data (for example film).This needs can change into need be with high data rate read data; This data rate equals to transmit the required data rate of stream and to visit the fluxion of identical data simultaneously.Usually can solve this problem by a plurality of backups of preserving data, but this can increase the extra cost of system.Media streamer 10 uses of the present invention are a kind of obeys more than a plurality of technology of stream simultaneously from individual data backup.This technology has been considered the data rate and the possible quantity of the stream of visit data simultaneously of a single stream.
Above-mentioned data thread relates to the notion of a logical file.The data of logical file are stored in a plurality of file parts by piecemeal, are referred to as thread.Each thread can exist on the different disk volumes, so allow logical file to stride across a plurality of physical disks.Dish both can be local, also can be long-range.
When data were written to logical file, it was broken down into logic length (that is section) and sequentially is placed in the thread.Figure 16 has described a logical file that is used for video 1, and it is divided into m section or piece, and the size of each section is a particular value, for example is 256KB.Final stage may only be filled with partial data.One data segment is placed in first thread, and next section after this data segment is placed in second thread, or the like.When all having a data segment in each thread, then next section is write in first thread.So if a file is divided into N thread, thread 1 will the section of comprising 1 so, N+1,2*N+1 will the section of comprising 2 etc., thread 2, N+2,2*N+2, etc., by that analogy.
The known similar data thread that uses in data processing RAID arranges is cut apart, wherein the purpose cut apart of thread is the integrality that guarantees data on dish during loss of data, such RAID accumulator system is specified a N parity data that data recovery storage is used in the dish.The disk storage node 16 of media streamer 10 is configured to a RAID structure, but does not need parity data (because the backup of video data can come from tape storage).
Figure 17 has described the first important aspect of this data ordering, that is: each video image is resolved into the data block that is distributed on each available disk driver or section, guaranteeing simultaneously each video image of visit from a plurality of drivers, and needn't need a plurality of backups.So the thread notion is not the reason for data globality and aspect of performance, but for concurrency and bandwidth.So media streamer 10 is divided into thread by playing section rather than block of bytes etc. with video image.
As shown in figure 17, a video data file 1 is divided into m section and 4 threads, thread 1 be one comprise video file 1 the section 1,5,9 grades file; Thread 2 be one comprise 2,6,10 sections of video file 1, etc. file; Thread 3 is that one to comprise the file of 3,7,11 sections grades of video file 1 and thread 4 be one to comprise 4,8,12 sections of video file 1, and the file that waits all is comprised in one of 4 thread files up to all m sections of video file 1.
Provide described thread segmentation strategy and CALCULATION OF PARAMETERS below, thereby the thread of each video is cut apart be able to perfect.
At first, select the size of section, to obtain a rational and effective data rate from coiling.But it can not be too big, influences tautochronism conversely.In addition, it should be enough little, so that the energy buffer memory/be cached in the storer.One preferable section size is 256KB, and when vedio data rate variation scope from 128KB/ second be constant during second to 512KB/.If video data rate is higher, preferably use bigger section.The size of section is relevant with the base unit of the I/O operation that is used to be stored in the video image district on the identical media.Used principle is to use a section that comprises the video data of about 0.5-2 second.
Then, determine Thread Count, that is: the number of the dish of the video data that distributing thereon.This value should be enough big, to keep needed total data rate.Can be respectively each video image according to a predetermined use speed and calculate this value.In addition, each dish has an associated logical volume.Each video image is resolved into some composing documents, and the composing document number equates with required Thread Count.Each composing document is stored on the different logical volumes.For example, if must transmit video data by the data rate of every stream 250KB/ second, and this video has 30 streams simultaneously, and for example every beginning in 15 seconds, can obtain one so was 7.5MB/ total data rate of second at least.If a disk drive average energy is supported 3MB/SEC, video image needs 3 threads at least so.
The effective speed of read data is subjected to the influence of read operation size from dish.For example, if press 4KB piece read data (random site on dish) from dish, effective data rate may be 1MB/ second, and as pressing 256KB piece read data, data rate will be 3MB/ second.But if by very large read data, required buffer memory also will increase, and because read operation must be finished before data are accessed, wait for and delay so can increase.So select that data transmit big or small the time exist one compromise.The size that will transmit according to the selection of configuration of the attribute of equipment and storer.Best, the size that data are transmitted equals the size of institute's selections.For one given section size, the effective data rate of equipment is determined.For example, for some disc apparatus, a size is a good equilibrium value of effectively using disk drive (effective data rate 3MB/ second) and cache size (256MB) for the section of 256KB.
If do not use thread, the restriction of the effective data rate that the maximum fluxion that can support will be coiled, for example, if effective data rate be 3MB/ second and-data rate of stream is 200KB/ second, the stream that comes from dish at most can not be above 15 so.For example 60 of same video streams if desired must be replicated in data on 4 dishes so.Yet,, only need to use 4 dishes of 1/4 capacity if use according to thread of the present invention.In 60 streams from video data one single backup altogether, can play 15 streams simultaneously from each of 4 threads, the time of starting broadcasting of the stream that staggers can be distributed evenly on the thread the request of 60 streams guaranteeing.If the time that stream starts broadcasting is close each other, can use video data in the high-speed cache to reduce needs to I/O.
For a given video, Thread Count is subjected to two factor affecting; First factor is in any maximum fluxion from video that need provide of carving for the moment, and there is total fluxion of the video on the same disc what need provide quarter for the moment arbitrarily in another factor from all as video.
Can determine the Thread Count of a video in the following manner:
Sï¼maximum(r*n/dï¼r*m/d)ï¼
Wherein:
The rating data speed that r=spreads and puts;
N=under nominal rated speed, when coming from this video image stream maximum quantity;
D=is from the effective data rate of dish;
(note: the size of the effective data rate section of being subjected to of dish influences)
M=under nominal rated speed, from the maximum quantity of all streams when comprising the dish of any part of this representation of video shot; With
The Thread Count of a video image of S=.
The dish that vedio data is cut apart by thread on it can be used as one group and manages, and it can be considered as a very big physical disks.The maximum file that the physical file system that thread can make the size of a video file exceed a system can allow in general, the required disk space of video data does not finish not identical in group on all dishes.For disk is used in equilibrium, a video is being carried out thread when cutting apart, thread is cut apart should be from there being the dish of maximum free space.
Can be with reference to such example: a video and graphic need be play with the speed of 2 megabit per seconds (250,000 byte per second), that is: r equals 250,000 byte per seconds, and hypothesis need transmit 30 streams at most simultaneously from this video, that is: n equals 30.Suppose also that in this example m also equals 30, that is: the total fluxion that transmits from all dishes is 30.In addition, also hypothesis is by 250,000 byte section sizes partition data, and is 3,000 for given section size (250,000 bytes) from the effective data rate of a dish, 000 byte per second.Then required m Thread Count n equals (250,000 * 30//3,000,000), and rounding is 3 (S=maximal value (r*n/d)).
For example,, need 250 so if be 45 from all maximum fluxions that comprise the dish of these data, 000*45/3,000,000 or 3,75 thread, rounding is 4.
Even this Video Segmentation is become 3 threads also can satisfy to send needs from 0 stream of the single backup of video, also comprise other content if comprise the dish of this video, and support is 45 from total fluxion of this video, needs 4 disk drives (thread is cut apart 4 grades) so.
In media streamer 10, use this algorithm as follows.Storer (disk drive number) is divided into disk groups.Every group has certain storage capacity and storage capacity, in order to transmit stream when giving determined number (by the every dish effective data rate based on the size of a predetermined section).The size of every group of section is constant.Can not select different section sizes (so having different effective data rates) on the same group.When a video image being carried out thread when cutting apart, at first use following criterion to select one group.
The size of section is consistent with the data rate of video, if that is: Liu data rate is 250,000 byte per seconds, the size of section should be between 125KB to 500KB.Next criterion is that the dish number in will the assurance group should be enough to support maximum fluxion simultaneously, that is: stream data rate is " r ", and fluxion is " n " in the time of maximum, and the effective data rate of a dish is the dish number in the group of " d " in the group.Supported at last will assurance dish group come from all videos the time fluxion amount summation can not surpass the capacity of dish group.If that is: " m " is the capacity of group, then " m-n " should be more than or equal to the summation of all fluxions of coming oneself to be stored in the video in the group that can be play simultaneously.
When video data is encased in media streamer 10, in Control Node 18, carry out above calculating.The simplest situation be all dishes in a single dynamic area, this dynamic area defines the total capacity of media streamer 10, that is: the fluxion that is used to store and is supported.In this example, can be from formula: calculate the dish number that is used to support a fluxion given the time the m*r/d, wherein m be a fluxion, and r is the data rate of stream, and d is general effective data rate.Notice that if the data rate difference of stream, the m*r in the then above-mentioned formula should be replaced by the maximal value of all data rate sums that flow simultaneously.
Use this technology that is used for write data that data can be read out,, and do not need a plurality of backups of video image numeral with a plurality of streams that are used for transmitting by given pace.By on a plurality of coiling, data being divided into thread, can making read operation to the other parts of the file that is used to transmit another stream is not disturbed in the read operation of the part of the file that is used to transmit a stream.
I. the data of media streamer transmit and turn over journey
I1 is used for carrying out to breakout box 8 distribution of the dynamic bandwidth of video transmission
Common video server can only satisfy in two aspects.They or use the PC technology to set up the video server of a low expense (but also low bandwidth), perhaps use super computing technique to set up the video server of a high bandwidth (also costliness).The objective of the invention is to transmit video, but do not need the so high expense of super computing technique with high bandwidth.
A kind of preferred mode with low cost acquisition high-band band is to use low breakout box (the chiasma type circuit switch matrix) 18 of waiting for low-cost interconnected one-tenth one video server of PC point (as shown in Figure 1).An importance of media streamer structure is effectively to use the available video stream bandwidth of each memory node 16 and communication node 14.Combine and make bandwidth reach maximal value with dynamic, the real-time bandwidth distribution capability of a low-cost switching technique by specific properties (once write, repeatedly read) video data.
Figure 18 has represented to connect with a kind of traditional logic between the memory node at a breakout box interface.The breakout box interface must be that full duplex (being that information can send on either direction simultaneously) so that video (and control information) promptly can be sent to memory node, also can be sent out from memory node.Because video content is once write memory node, repeatedly be read out then, so the required most of bandwidth of memory node are on the breakout box direction.In a typical breakout box interface example, the bandwidth of memory node is in low user mode, because half bandwidth that is used to write is seldom used.
Figure 19 has represented one according to breakout box interface of the present invention.What this interface dynamically and was in real time given total allocated bandwidth breakout box 18 advances direction or outgoing direction, to satisfy the current needs of node.(memory node 16 is used as an example).Communication node 14 has similar demand, but the major part of their bandwidth is on the Way out of breakout box 18.
Is a logic breakout box interface 18a by using the suitable route title that is used for breakout box 18 with two or more physics breakout box combination of interfaces, to reach the purpose of dynamic assignment.Then segmenting video data between two physical interfaces (for example, when a read operation is done).Can be by on a plurality of memory devices, data being divided into line segment, so that its easier realization by aforesaid method.Receiving node makes up video data returns into a single logic flow.
For example, the breakout box interface rate among Figure 18 is decided to be 2XMB/ full duplex second, i.e. XMB/ second on each direction.But video data only sends (arriving breakout box with memory node) usually in one direction.So, even node has the video bandwidth of double capacity (2X) to be used for transmitting data from memory node.Memory node is in low user mode.The breakout box interface of Figure 19 dynamically distributes whole 2 * MB/ bandwidth second, in order to send video from memory node to breakout box.Can increase bandwidth like this, also can reduce your usefulness of each video flowing from the bandwidth of video server from node.
The transmission of video data when J. using the waiting of communication adapter
Digital of digital video data has succession, continuity and measures characteristics such as big, strict than on the content of requirement in time simultaneously.Ground transmits video according to stream in the time of must be with higher bit rate etc., requires all unnecessary spending on the data routing are reduced to minimum.The hardware that is generally used for receiving is a video machine top box or some other suitable video data receivers.The standard serial communication agreement adds the position with data auxilliary or byte is inserted in the stream at hardware level usually, to be used for synchronously and data detection.If receiver can not be pellucidly added data and remove from auxilliary, this can damage video data stream.The overhead that is brought by these or byte can reduce effective data rate, produces video compression and transcription error.
To it has been recognized that if transmit video data by the standard traffic adapter, ground is sent to the user in order guaranteeing its grade, to need then to forbid that most standard serial communication believes the attribute of agreement.The method that reaches this purpose is relevant with employed communication adapter, but key concept once is described below.In Figure 20, the serial communication chip 200 on the communication node 14 is forbidden format and integrity information, as parity checking, beginning and stop bit, cyclic redundancy check (CRC) code and sync byte, and the generation of prevention idle character.FIFO input-buffer 202,204,206 grades are used to guarantee that video flowing can constantly be exported (when waiting) the loading data block cycle that allows bus.The FIFO buffer memory 208 of one 1000 byte can be simplified CPU and the bus logic of packing into.
If communication pio chip 200 does not allow to forbid the generation of an initial synchronisation byte, then should the value of sync byte be become first byte value (and the data block pointer is added 1 point to second byte) of each data block by program.Must use byte-aligned management True Data, because any liner position is if not the video data of actual compression, their can corrupt data stream.
Needed constant in order to reach high-quality compressed video data, an annular buffer memory or a plurality of large capacity cache (for example, 202,204,206) should or be used in high-speed serial data output.This is very important so that there is adequate time to fill an input-buffer for when one had before filled the buffer memory of data output data.Unless carry out the buffer memory packing earlier on the video data flow path, otherwise the video done state can produce a very little buffer memory, it will be output before next buffer memory transmission is finished, and will produce data payload operation like this.Three of these minimum needs big, buffer memory independently.Annular buffer memory (also can write when reading) in the dual mode storer also is a suitable embodiment.
From MPEG-1,1+ or MPEG-2 digital data compression format conversion become industrial standard TV format (NTSC or PAL) to J1 with video image or film
Just as described above, digital of digital video data can be moved on in the memory buffer from dish.In case the data in the memory buffer are enough, then they are moved on to the interface adapter of a communication node from storer.The interface that uses be SCSI 20MB/ second fast/wide interface or SSA serial scsi interface.Scsi interface can be extended to and can handle 15 addresses, and SSA structural support maximum 256.That other is suitable for is RS422, V, 35, V, 36, but is not these.
As shown in Figure 21, be sent to NTSC adapter 212 (also referring to Figure 20) from a communication node 14 through a communication bus 210 from the video data in the interface, be buffered in these data.From fetching data, a plurality of data blocks of storage in local cache are so that bus performance the best from a local cache 214 for adapter 212.The basic goal of adapter 212 be keep one from storer 212 to MPEG chips 216,218 again to the isochronal data of NTSC chip and D/H222 stream, to guarantee the uninterrupted transmission of video or/and audio frequency.
MPEG logic module 216,218 changes into numeral (compression) video data the video and the audio frequency of element level.A NTSC scrambler 220 changes into the NTSC base-band analog signal with signal.Mpeg audio decoder 216 converts DAB to parallel digital data, these data then by a digital/analog converter 222 transmit with filtering to produce an audio frequency left side and right output.
The purpose of the scheme of transmission problem is not only in order to make system's transmission bandwidth maximum, also in order to make system performance restriction minimum when producing a solution speeds match and waiting.
The Application developer usually uses such as bus structure such as SSA and SCSI control and transmission data between processor and mechanical storage equipment (for example disk element, tape element, optical storage parts etc.).If take some measures control rate and video data etc. the time transmit, these two kinds of buses comprise some attributes that are applicable to that video data hands over bandwidth to transmit.
SCSI bus allows to send data in groups with 20M byte per second speed, and this can make any vision signal minimum from the delivery time of the specific NTSC adapter of buffering storer to.Adapter 212 comprises a big buffer memory 214, and it has with high peak rate data to be sent to storer in groups and with low-down transfer rate data are sent to NTSC from buffer memory 214 from bus 210 releases in yard chip 216,218.Also it connects by software control further buffer memory 214 to be divided into less buffer memory by section, to form a plurality of buffer memorys that connect by circular pattern.
Like this, system just can be sent to the data of variable data block size respectively the order of buffer memory and control broadcast.The advantage of this method is can in officely what is the need for to want before the video data, and delivery system software also transmits block of video data with very high transfer rate.This can make media streamer 10 manage many video flowings according to dynamic output requirement.When the processor on the communication node was free, it can transmit the several big data block that will play in order.In case finish this point, this processor can freely control other stream and do not need immediately with low speed continuously, isochronal data is sent to each port.
In order further to improve the P/C ratio of encoder/decoder system, a little FIFO storer 224 is assigned between big code translator buffer memory 214 and the MPEG code translator 216,218.FIFO storer 224 can make controller 226 with less piece, and normally the data of 512 bytes are sent to the FIFO storer 224 from buffer memory 214, and then, FIFO224 becomes serial bit stream with data-switching so that be sent to MPEG code translator 216,218.Both can both obtain input audio ï¹  video coding chip 218,216 from identical serial data stream, also can decompose and decoding desired data in inside.To from the transmission of FIFO storer 224 fan-out factor certificates when waiting mode or when first-class substantially mode carry out, to guarantee continual video image is sent to the user or the consumer of video image.
K. digital video is to the transmission of scsi device
As shown in figure 22, device level software will convert scsi command and data stream to from the compressed digital video data and the command stream of memory buffer, and it is sent to a destination adapter 212 by SCSI II rapid data speed by SCSI bus 210.Then, with the storage of this data buffering and on request the content output speed it is fed to the MPEG logic so that decompress(ion) and convert analog video to and voice data.Provide and synchronization of data streams and the appropriate feedback of managing buffer memory of assurance by SCSI bus 210.
SCSI NTSC/PAL adapter 212 provides an advanced interface with SCSI bus 210, supports a subclass of standard SCSI agreement.Normal operation mode is to open adapter 212, to its write data (video and audio frequency) stream and only just close adapter 212 when finishing.In order to guarantee that its buffer memory is full, adapter 212 extracts data with fast as far as possible speed, and provides data block by communication node 14 and memory node 16, and wherein the size of data block should make bus data transmit optimum and make bus expense minimum.
If necessary, can use the selection mode order of a SCSI by controlling packet replacement system crushed grain number.Video/audio carries out in adapter 212 inside synchronously, does not need external control.By making mistake reduce to minimum with lasting audio/video output synchronously more automatically.
K1 SCSI level command specification
Use one group of direct access device that mixes and order device command and standard universal order to satisfy the functional requirement of SCSI video o adapter.All scsi commands return an effective status byte after every command execution is intact, and if return a verification state, detect in the data field error condition is housed.The standard scsi command that uses comprises: RESET, INQUIRY, REQUEST, SENSE, MODE SELECT, MOOE SENSE, READ, WRITE, RESETVE, RELEASE, TESTUNIT READ1/.
Video commands:
The video control command is user class video output control command and is the expansion of top listed standard commands.They provide the user class front end of a simple low-level operation system or scsi command, wherein direct and SCSI video o adapter 212 interfaces of scsi command.Each order realizes by using the necessary video equipment function of microcode simulation, and avoided the audio ï¹  video that caused by invalid state of a control unusual.Can use a single scsi command, START/STOP UNIT is the necessary parameter that target SCSI video o adapter is translated the video control command and transmitted with this order.This can simplify user api, also can simplify the microcode of adapter 212.Use following order:
Stop (SCSI START/STOP1-parameter=mode)
If the data-in pause of MPEG chipset (216,218), then audio frequency is noiseless, the video blank.Parameter field selects to stop mode.Normal mode makes buffer memory and position indicator pointer keep current state, can proceed on the same position of video flowing so that play.Second (wrapped film or abandon) mode is that buffer memory is provided with a pointer, and pointing to next buffer memory starting point and discharging current is buffer memory.Third Way also is to be used for the wrapped film state, ends when being delayed to the metadata cache sky but stop (noiseless and blank) always.Can use a cubic formula and some MPEG decoding instrument for one postpone stop to provide audio frequency, but be last valid frame maintenance frame when data are overflowed.In each example, video adapter 212 microcodes are determined end point, so that the output of video and audio frequency suspends on suitable border, so that pure restarting arranged.
Suspend (SCSI START/STOP2-printenv)
If the input of the data of MPEG chipset (216,218) is suspended, then audio frequency is noiseless, but video is not blank.This can make MPEG video chipset (216,218) keep a frame of a last good frame.Can avoid video to burn out kinescope like this.Cease and desist order and preferably sent by Control Node 18, receive order if still be provided with in 5 minutes, video output should become blank automatically.Adapter 212 microcodes are kept cache location and decoder state, smoothly get back to broadcast state to guarantee one.
Blank-noiseless (SCSI START/STOP3-parameter=mode)
This order makes video output blank, but does not influence audio frequency output; Or audio frequency output is noiseless, but do not influence video; Or the both is influenced.Can forbid noiseless simultaneously and blank by the order of using a band mode parameter, so just can obtain a level and smooth conversion and also can reduce the order expense.After can and converting simulating signal at decompress(ion), realizing above the operation by hardware controls on the video adapter 212, with the transfer that guarantees that a forward is level and smooth.
Slow play (SCSI START/STOP4-parameter=speed)
This order can reduce the data input rate of MPEG chipset (216,218), makes data keep frame off and on, the slow play function on the simulation VCR.Make audio frequency noiseless, to prevent the numeric error noise.The specified relative velocity of parameter field can be 0-100.Another program is to forbid releasing translating device chipset (216,218) and carrying out fault processing, will enter the broadcasting speed that the data clock speed of decoder chip group is revised or wished then.This is decided by the dirigibility of the timing topology of video adapter.
Play (SCSI START/STOP5-parameter=buffer memory)
This order starts a process to MPEG chipset (216,218) data feed, allows the output of video and audio frequency.Transmit a buffer memory sequence number of selecting, from which buffer memory begin to play with decision; If sequence number is a null value, then should use current broadcast buffer memory (typical operation).If adapter 212 is in the STOPPED pattern, then receive only nonzero value; If adapter 212 is in the PAUSED pattern, does not then consider this parameter of buffer memory sequence number, and select current buffer memory and position thereof to restart to play.
When playing, controller 226 sequentially cycles through each buffer memory and flows to keep a stable data that enters into MPEG chipset (216,218).With suitable speed data are read the MPEG bus with buffer memory, need begin from the address up to N byte run through, controller 226 forwards next buffer memory to and continues read data then.Adapter bus and microcode both can provide the bandwidth of abundance for SCSI to the rapid data transmission of adapter buffer memory 214, also can provide sufficient bandwidth for stably data being installed to output FIFO224, wherein export FIFO224 feeds of data is arrived mpeg decompression chip (216,218).
F.F. (SCSI START/STOP6-parameter=speed)
This order is used to simulate the fast-forward functionality on the VCR.Rate parameter can define two kinds of operator schemes.Video and audio frequency are all answered blankly and noiseless in the speed null representation F.F. process, and buffer memory is full of, and when a video flowing reposition forward receives data, carry out implicit a broadcast.The integer representation inlet flow of 1-10 is just in the speed of F.F..By skip several data blocks to video " sampling " to reach the mean data rate of appointment.Adapter 212 jumps forward near the part of normal speed played data, plays next part then, thus simulation action forward fast.
Rewinding (SCSI START/STOP 7-parameter=buffer memory)
This order is used to simulate the rewind functions on the VCR.Rate parameter can define two kinds of operator schemes.Video and audio frequency should be blank and noiseless in the process of fasting rewind in the speed null representation, and buffer memory is full of, and when a video flowing reposition forward receives data, carry out implicit a broadcast.Integer representation inlet flow between the individual 1-10 is just in the speed of backrush.By skip several data blocks to video " sampling " to reach the mean data rate of appointment.By some small data pieces are combined to form the rewinding data stream, wherein little data block sampling is early carried out on the position continuously at video flowing.Adapter 212 treatment conversion is smoothly play to press normal speed with synchronously, jumps to next sampling location backward with simulation rewinding scanning.
K2. the management of buffer memory
Digital video frequency server provides data for many parallel output devices, but the digital of digital video data decompress(ion) needs a constant data stream with conversion.The usage data buffer technology can be drawn the scsi data advantage of sending mode transmission in groups, also avoids data payload or buffer memory overload simultaneously, and can make media streamer 10 send the data to many streams under very little intervention situation.SCSI video adapter 212 (Figure 21,22) comprises a big buffer memory 214 that is used for video data, to utilize SCSI sending mode data transfer procedure in groups more fully.In illustrative arrangement, the size of buffer memory 214 is 768K, and a local logic is processed into circulating type annular buffer memory with it.When transmitting digital of digital video data, annular buffer memory is suitable for managing the variable length data piece, and is not suitable for management fixed length buffer memory.No matter, still consider that from storage overhead the fixed length impact damper is all effective inadequately from administration overhead.
The microcode of video adapter 212 is supported some buffer pointers, points to top data and current length and top data.So just the transmission of failure can be rewritten, perhaps under the situation of needs, the byte location of pointed current cache.(intermediate logic is alignd by long word, and position or word are specific to be even number) transmits with the valid data that guarantee coding chip group (216,218).This method can make the expense minimum of steady state operation, simultaneously can also the flexible data buffer memory.
The K2.1 buffer memory is selected and the location
Need to suppose many groups, and have a plurality of pointers to can be used for all and slow relevant operation.For example, can use one group of current location of selecting to play buffer memory and this buffer memory; Using one second group selection to write one of buffer memory and this buffer memory is used for data and is pre-loaded into operating position (normally zero).Because also support the variable length data piece, should protect the current length and the maximum length value of each data block of reception.
The K2.2 automated manner
The operation of buffer memory can be managed by the controller 226 of video adapter, and it is in zero the next available buffer memory that the data of N byte are put into start address.Whether the length of data and data are by " broadcast " in controller 226 each buffer memory of maintenance tracking.As long as enough spatial caches are arranged, this card just receives next write order and the data of DMA is delivered in the buffer memory of space.If do not have enough free spaces to receive whole data block (normally a slow play or halted state), then do not receive write order and return the full return code of a buffer memory.
The K2.3 manual mode
The order of use one " location " is selected one " current " for each cache access order (write, delete etc.) and is write buffer memory and the position in this impact damper (normally zero).The position of buffer memory is relevant with the reference position of a last data block that is successfully sent.Do the management that helps the video flowing conversion like this, and can activate automated manner soon so that the order expense minimum in the system.
The management of K2.4 mistake
Digital video is different with the random data visit according to the requirement that sends mismanage, and in the random data visit, SCSI normally is used in the data process application.It is so important that little loss of data does not send interruption.The state phase return state byte that normal SCSI error processing procedure is finished in each order.If a mistake is sent, target SCSI chip 227 can not receive an order or a test status, state byte or be in " good " (00) state then, or " hurrying " (8h) state.
The K2.5 mistake is recovered
The controller 226 of SCSI video adapter 212 is replied automatic generation one request detection order according to the test status of a pair of loading error and status information, and determines whether to carry out a rejuvenation.Normal rejuvenation is to remove error condition, removes the data of any damage and restarts as early as possible and play.Under worst case, adapter 212 restarts possibly, and before playing again, reloads data.Misregistration and report to host computer system in the SCSI of next one inquiry or request detection operation.
The automatic retry of K26
Under the full or device busy condition, maximum X time of automatic retry at buffer memory, wherein X is relevant with stream data rate.This permission was carried out this point before next metadata cache due in.At this point, if state is non-expectation (that is: buffer memory is full, but is not to be in to suspend or the slow play pattern), misregistration then, and may need to restart or removing equipment to recover and to continue displaying video.
Although described in the instructions in front and sent a video image to a user, will be recognized that, can use the two-way video adapter to connect a video image, and video image is digitized into a numeral, and data representation is sent to a communication node 14 by bus 210, be stored in the memory node or a plurality of memory node 16,17 by Control Node 18 appointments through the low breakout box 18 of waiting for then.
Will be appreciated that above stated specification is a description of the present invention.Those skilled in the art can carry out various substitutions and modifications not departing under the condition of the present invention.Therefore, the present invention will comprise that all are included in various replacements, modifications and variations in the appended claims scope.