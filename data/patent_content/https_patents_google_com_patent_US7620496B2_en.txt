RELATED APPLICATIONS
This application is a continuation-in-part of U.S. application Ser. No. 11/051,534, filed Feb. 5, 2005 now U.S. Pat. No. 7,158,878, titled “A Digital Mapping System”, which claims the benefit of U.S. Provisional Application Nos. 60/567,946, filed May 3, 2004, and 60/555,501, filed Mar. 23, 2004. In addition, this application is related to U.S. application Ser. No. 11/088,542, filed Mar. 23, 2005, titled “Generating and Serving Tiles in a Digital Mapping System”. Each of these applications is herein incorporated in its entirety by reference.
FIELD OF THE INVENTION
The invention relates to digital mapping systems, and more particularly, to techniques that provide more accurate and useful map scales.
BACKGROUND OF THE INVENTION
Computerized mapping systems have been developed to search for, identify, and discover information about geographic locations. One form of such computerized mapping systems includes travel-planning Internet websites. With an excess of 50 million unique monthly users, such map sites are a very popular offering. Examples of such sites include AOL's MapQuest, Yahoo's Telcontar-based maps, and Microsoft's MapPoint.net suite. Such sites all work along the lines of a common model, as will now be described.
When a Web user asks for a new map view (e.g., by entering a postal address, or by clicking a navigation link next to a current map view), the user's Web browser sends to a Web server a request indicating the boundaries of the new map view. The Web server in turn extracts the corresponding vector-based map data from a database, and draws a bitmap image of the map. The server then converts the bitmap to an image format supported by the user's Web browser and returns the image, sometimes embedded in HTML, to the user's Web browser so that it can be displayed. Other map Web sites, such as Britain's MultiMaps or Australia's Wherels utilize a raster-based map database instead. In these cases, it is not necessary to extract vectors and draw a map image. Rather, these functions are replaced by simply extracting the appropriate part of a larger, pre-rendered image.
Whether vector-based or raster-based, such existing map systems typically have a scale either on or next to the map image. A map scale generally indicates the relationship between a certain distance on the map and the corresponding distance on the ground, and can be used to help the user of the map approximate actual distances covered by the map. The scale is normally generated on the server side, and is embedded in the map image served to the client. In this way, the scale is updated when a new map image is loaded.
A scale is typically provided in one of two ways: a written scale or a graphic scale. A written scale gives a description of scale in words (e.g., “one inch equals one mile”). Note that such a scale would be ineffective, however, if the map is zoomed or otherwise reproduced at a size different than the original map size to which the written scale was directed. Thus, if a user attempts to measure an inch on a modified version of the map, incorrect distance information will be obtained. Moreover, users are required to provide their own device for measuring distances on the map.
A graphic scale generally solves some of the problems associated with written scales. A graphical scale is usually depicted as a horizontal line and a corresponding distance (e.g., miles, yards, feet) which that line represents on the map. The corresponding distance can be placed in the middle of the line, or at the end of the line. Some maps provide multiple lines to provide scales in more than one unit of distance, such as one line for miles and another line for kilometers. However, such conventional graphic map scales are also associated with a number of problems.
For instance, some graphical scales are not always updated with panning and zoom or resize operations performed by the user. This is of particular concern when the scale image is separate from the map image. Moreover, note that at various zoomed out levels, the scale ratio of the top portion of the shown map can be different than the scale ratio of the bottom portion of the shown map, depending on the map projection used. In addition, conventional graphical scales require a user to provide his/her own device for measuring distances on the map, and relating that device to the distances shown on the graphical scale.
What is needed, therefore, are digital mapping techniques that provide more accurate and useful map scales.
SUMMARY OF THE INVENTION
One embodiment of the present invention provides a computer implemented method for adjusting and using a graphical map scale of a digital map provided by a digital mapping system. In response to the digital map being moved or zoomed, the method includes updating the scale as necessary. In response to the scale being moved on the digital map, the method includes switching from a scale mode to a measuring tool mode. The method may further include the preliminary step of receiving information that influences the scale behavior, including information about at least one of scale position on the map and zoom level. The information that influences the scale behavior may identify a map projection used in making the digital map. The information that influences the scale behavior may include information about user preferences, including at least one of desired scale units and desired scale distance. Updating the scale as necessary may include drawing the scale so each unit is a correct number of pixels wide (e.g., based on scale units and scale distance), and adding the scale distance to the scale as text. Updating the scale as necessary may include drawing the scale so each unit is a correct distance (e.g., based on map projection used and scale location on the digital map), and adding the distance to the scale as text. Switching from scale mode to measuring tool mode may include, for example, changing a graphical look of the scale to indicate measuring tool mode is active. The digital mapping system may include, for instance, a client side that requests map data from a server side, and the method is carried out on the client side.
In the scale mode, the method may include generating a tool tip in response to a user moving a cursor over the scale, thereby communicating availability of the measuring tool mode. In scale mode, the method may include at least one of opening an information window in response to a user selecting the scale, thereby allowing the user to specify units of measure for the scale, and opening an information window in response to a user selecting the scale, thereby showing the user information describing how to use the scale as a measuring tool to measure distances on the map. In the measuring tool mode, the method may include indicating a home position for the scale on or proximate the digital map. In response to a user selecting the home position, the method may further include returning from measuring tool mode to scale mode, and returning the scale to the home position. In the measuring tool mode, the method may include displaying a distance between locations marked by endpoints of the scale, the distance in units of the scale. In measuring tool mode, the method may include opening an information window in response to a user selecting the scale, thereby allowing the user to request driving directions for travel between locations marked by endpoints of the scale. The method may further include providing the driving directions. In measuring tool mode, the method may include opening an information window in response to a user selecting the scale, thereby showing the user information about points marked by the scale (such as latitude/longitude, geocode).
Another embodiment of the present invention provides a computer implemented method for adjusting and using a graphical map scale of a digital map provided by a digital mapping system. In response to the scale being moved on the digital map, this embodiment includes switching from a scale mode to a measuring tool mode, and displaying a distance between locations marked by endpoints of the scale, the distance in units of the scale. Switching from scale mode to measuring tool mode may include changing a graphical look of the scale to indicate measuring tool mode is active. The scale includes, for example, a line between two endpoints, and in measuring tool mode, the method includes drawing the scale to reflect its movement as the endpoints are moved to locations on the digital map. In one such case, drawing the scale to reflect its movement includes changing a graphical look of at least one of the endpoints of the scale to indicate its movement, and changing the graphical look of the at least one endpoint to indicate it has been released from movement. In another case where the scale includes a line between two endpoints, and in measuring tool mode, the method includes drawing an additional endpoint each time a user drags the line between two endpoints to a location on the map, thereby providing a multisegment line. In such a case, the method may include converting the multisegment line into at least one of written and graphical driving directions.
Another embodiment of the present invention provides a computer implemented method for adjusting and using a graphical map scale of a digital map provided by a digital mapping system. In response to the scale being moved on the digital map, this embodiment includes switching from a scale mode to a measuring tool mode, and drawing the scale to reflect its movement on the digital map, the scale including a line between two endpoints. The method further includes changing the graphical look of the scale to indicate it is no longer moving, and displaying a distance between locations marked by the endpoints of the scale, the distance in units of the scale. In measuring tool mode, the method may include opening an information window in response to a user selecting the scale, thereby allowing the user to request driving directions for travel between locations marked by endpoints of the scale. The method may further include providing the driving directions. In the measuring tool mode, the method may include drawing an additional endpoint each time a user drags the line between two endpoints to a location on the map, thereby providing a multisegment line. This multisegment line can, for example, trace a desired route. The method may further include opening an information window in response to a user selecting the scale, thereby showing the user information about points marked by the scale.
The features and advantages described herein are not all-inclusive and, in particular, many additional features and advantages will be apparent to one of ordinary skill in the art in view of the figures and description. Moreover, it should be noted that the language used in the specification has been principally selected for readability and instructional purposes, and not to limit the scope of the inventive subject matter.
BRIEF DESCRIPTION OF THE DRAWINGS
FIGS. 1 a and 1 b illustrate a combined scale and measuring tool that is currently in scale mode, in accordance with one embodiment of the present invention.
FIG. 2 illustrates a combined scale and measuring tool that is currently in tool mode and measuring the distance between two user selected points, in accordance with one embodiment of the present invention.
FIGS. 3 a through 3 c illustrate a combined scale and measuring tool that is currently in tool mode and measuring the distance between three user selected points, in accordance with one embodiment of the present invention.
FIG. 4 is a block diagram of a digital mapping system that employs a combined scale and measuring tool, in accordance with one embodiment of the present invention.
FIG. 5 illustrates a method for dynamically updating, in response to map changes, a combined scale and measuring tool operating in scale mode, in accordance with one embodiment of the present invention.
FIG. 6 illustrates a method for dynamically updating, in response to user input, a combined scale and measuring tool operating in tool mode, in accordance with one embodiment of the present invention.
DETAILED DESCRIPTION OF THE INVENTION
A combined map scale and measuring tool is disclosed herein that can be used in a digital mapping system. To provide added functionality to the scale without incurring undesirable processing delay, the scale is drawn on the client side. Thus, it can be quickly updated with every pan, zoom or resize operation the user performs. The user can also manipulate the scale to, for example, set its units and use it as a distance measuring tool. However, it is possible that the same functionality could be provided from the server side, but with processing delay.
Overview
The combined map scale and measuring tool has two general modes of operation: scale mode and tool mode: In the scale mode, the scale indicates the correct scale, for instance, at the center of the map, or at the position on the map that the scale occupies. In more detail, the scale varies at different points on the map view, depending on the map projection used. Thus, a tool tip can be used to indicate where the scale shown is valid (e.g., “Scale at center of map”). The user can determine where the scale is valid, if so desired (e.g., using a “set scale” configuration parameter). In any case, the scale is updated with every pan, zoom or resize operation the user performs. At zoomed out levels (e.g., showing map image of North America), the scale of the top and bottom of the shown map can vary greatly (depending on the map projection used) and is adjusted accordingly. The scale can be drawn, for example, as a line with one or more segments of different color, with text indicating the length of each segment, be it 1 mile, 100 feet or any other measure of distance. The scale can be configurable as well. For instance, if the user clicks on or otherwise selects the scale, a dialog box appears that allows the user to specify the desired scale units.
In addition, an element (e.g. colored circle) is added to each end of the line making up the scale. A tool tip can be used to show the user that these endpoints are dragable, and that the scale can be used as a measuring tool. The tool mode is entered once the user drags one of the scale endpoints. In one particular embodiment, once the user drags the endpoints, the look of the endpoints can be converted, for instance, to have the look of location markers (e.g., such as those shown in the previously incorporated U.S. application Ser. No. 11/051,534). The line between the two endpoints of the measuring tool can be drawn at the client to look similar to the scale segments shown when in scale mode, if so desired. Alternatively, the line between the tool endpoints can be just a plain line.
The distance on the map between the two endpoints of the tool can be displayed (e.g., in a dialog box near one of the markers or in the middle of the line). The user can drag each endpoint repeatedly, to take multiple measurements between positions on the map. When the user clicks one of the tool endpoints, an info window can be opened that includes relevant information about the point (e.g., latitude/longitude, geo code) and distance information, as well as a link or button that allows the user to convert the straight line to driving directions. When the user select this option, driving directions are generated between the two endpoints. The directions can be shown, for example, instead of the measuring line.
When the combined scale and measuring tool is in tool mode, a default or home position of the scale (e.g., lower left corner of map) can be marked, for instance, using a dark or shaded outline. If the user clicks this outline, then the deployed measuring tool is returned to its home position and switched back to scale mode (including the associated look of the scale). This switch from tool mode to scale mode can also be done, for instance, if the user navigates too far from the location of the measuring tool, or after a preset time.
If the user drags a point on the line between the endpoints of the measuring tool (instead of the endpoints), then a new point can be added. For instance, assume the measuring tool currently has one straight line between two endpoints. If the user drags a point on the line between the endpoints, then a new point is added and the measuring tool now shows three points, and the two lines between them. An info window (or windows) can be used to show all distances. A new point can be added each time the user drags a point on the line instead of an endpoint of the tool. The user can then convert these multi-segment lines into driving directions, with directions through all the points. If the user drags an endpoint of the tool on top of an existing location marker, then that location marker can be highlighted (e.g., color change) to indicate that the tool endpoint is actually co-located with the location marker, without having to actually cover the marker with the endpoint. For instance, if an adjacent location marker is green, then the nearby tool endpoint is actually at the location marker position.
Scale Mode
FIGS. 1 a and 1 b illustrate a combined scale and measuring tool configured in accordance with one embodiment of the present invention. As can be seen, a user has accessed a remote server of a digital mapping system through use of a browser, and requested a digital map for a specific address by typing that address into the location request entry field 120, and then clicking search. The requested map is displayed in the user's browser, and has a number of digital map features, including directional map control objects 115, zoom control objects 110, a location marker 125 (to highlight the requested address), and a combined map scale and measuring tool 105 (which is currently in scale mode).
Functionality and implementation details associated with the combined map scale and measuring tool 105 are discussed herein. Other features and functionality of the map, such as the zoom control objects 110, directional map control objects 115, location request entry field 120, location marker 125 (and associated information windows), high resolution printing, and the satellite imagery option are discussed in detail in the previously incorporated U.S. application Ser. Nos. 11/051,534 and 11/088,542, which describe tile-based mapping systems. Note, however, a combined map scale and measuring tool 105 configured in accordance with the principles of the present invention can also be used with other mapping systems, such as vector-based and raster-based mapping systems.
In the scale mode, the combined map scale and measuring tool 105 indicates the correct scale at the center of the map. Alternatively, the combined map scale and measuring tool 105 indicates the correct scale at the position on the map that the scale occupies. In any such case, the combined map scale and measuring tool 105 is updated with every pan, zoom, or resize operation the user performs. In one embodiment, this dynamic scale updating is carried out using a function (e.g., function UpdateScale). This function takes information about the map position and zoom level, as well as other data meant to influence the scale behavior (e.g., such as projection type). The function is called every time the map is moved or zoomed. Thus, the function is responsible for updating the scale on the map. The function can be called at the end of a map operation, such as a user dragging the map. Alternatively, the function can be called every time the map moves during the dragging operation. Whether post-navigation scale updating or real-time scale updating is used depends on the performance of the client (e.g., processing speed and browser configuration).
At zoomed out levels (e.g., showing map image of a continent or world map), the scale of the top and bottom portions of the shown map can vary greatly (depending on the map projection used) and is adjusted accordingly. In more detail, all map projections attempt to fit the curved surface of the Earth onto a flat medium. As such, the shape of the flat map is a distortion of the true layout of the Earth's surface. Mercator projection exaggerates the size (and to some extent, the shape) of map areas that are distant from the equator. For example, for maps made using Mercator projection, Greenland is typically shown to be as large as Africa. In reality, however, Africa is about 13 times that of Greenland.
Other cylindrical projections, as well as forms of equal-area projection can also be used, and the present invention is not intended to be limited to handling any one type of map projections. For instance, in maps made using the equal-area Gall-Peters projection, the shape, rather than the size of map areas is distorted. In particular, areas near the equator are stretched vertically, and areas far from the equator are squashed. Such manipulation of shape still impacts scale, just as with manipulations in size performed using Mercator projection. In any such cases, the combined map scale and measuring tool 105 can be configured to adjust in accordance with its position on the map and the type of map projection used.
In one such embodiment, a function (e.g., function UpdateScale) adjusts the scale based on the scale position on the map (e.g., latitude/longitude or geocode) and the projection type. A lookup table (LUT), such as the one shown in Table 1, can be provided for each projection type supported, where each table stores entries of scale information indexed by the distance of the scale position from the equator, which can be indicated, for instance, by latitude or a geocode. Alternatively, this functionality can be achieved using a formula, as will be apparent in light of this disclosure. Generally stated, for cylindrical projections, the scale for a given latitude is the same everywhere, regardless of longitude, assuming no change in zoom.
TABLE 1 |
|
Scale Adjustment LUT for Mercator Projection |
|
|
Scale Distance |
|
Scale Position |
Multiplier |
|
|
|
Latitude_1 |
1.0 |
|
Latitude_2 |
0.9 |
|
Latitude_3 |
0.8 |
|
. . . |
. . . |
|
. . . |
. . . |
|
Latitude_N |
M |
|
|
The resolution of the table can vary from application to application, depending on desired degree of accuracy. For applications requiring high accuracy, the table can have an entry, for example, for every 100 to 500 miles from the equator (in both the northern and southern directions), while lesser demanding applications can have an entry for every 500 to 1000 miles from the equator. In the example of Table 1, assume the entries range from locations of northerly increasing latitude, beginning with latitudes proximate the equator (Latitude—1) and ending at latitudes proximate the north pole (Latitude_N). A similar set of N latitudes can be used for map areas between the equator and south pole.
For Mercator projection, the distance covered by the same scale length decreases as the distance from the equator increases (e.g., as indicated by latitude). For instance, a 100 pixel scale at Latitude —1 could represent 100 miles. That same 100 pixel scale at Latitude —3 would represent 80 miles, and at Latitude_N would represent M*100 miles (e.g., 10 miles, assuming M=0.1). Numerous scale adjustment schemes are possible, depending on factors such as the desired resolution, scale accuracy, and map projection type used, and the present invention is not intended to be limited to any one such embodiment.
For example, the scale length need not be constant, and can be calculated for each scale update, based on a desired scale distance, such as 1 mile, 2 miles, 5 miles, or other nicely rounded scale distance. In this sense, it may be more important that the scale distance be a rounded number than the scale length, which can be an arbitrary or non-rounded number (e.g., where a scale length of 1.236 inches equals a scale distance of 5.0 miles).
The position of the map can be defined by the center of the map, or at the actual position of the scale. As will be apparent in light of this disclosure, defining the position of the map at the actual position of the scale can make a significant difference in processing, such as when zoomed out, for instance, to view a world map using the Mercator projection. Also, note that each zoom level provided by the mapping system (if any) can have its own set of scale multipliers for a given range of latitudes. Alternatively, the same set of scale multipliers for a given range of latitudes can be applied to each zoom level, assuming a linear relationship between the zoom levels and the scale multipliers.
As previously stated, it may be more desirable to have a scale distance that is a rounded number. In such cases, the corresponding scale length can be a non-rounded number. In one such case, a lookup table including zoom levels and corresponding scale distances can be used, as shown in Table 2. In this example embodiment, each zoom level has two or more possible scale distances that can be used. Thus, the user can specify a preference, if so desired. A calculation can be performed to determine if a particular scale distance is appropriate for a given map, based on corresponding scale distance tolerances. Note that although the tolerances are shown as a percentage, they can be in any form (e.g., ±/−100 pixels).
TABLE 2 |
|
Scale Adjustment LUT for Scale Length Per Zoom Level |
|
Available Scale |
Scale Distance |
Zoom Level |
Distances |
Tolerance |
|
1 |
0.5 mile |
+/−10% |
(zoomed in) |
1 |
1.0 mile |
+/−10% |
2 |
1.0 mile |
+/−10% |
2 |
2.0 mile |
+/−10% |
3 |
2.0 mile |
+/−10% |
3 |
5.0 miles |
+/−5% |
3 |
10.0 miles |
+/−5% |
4 |
10.0 miles |
+/−5% |
. . . |
. . . |
. . . |
10 |
100.0 miles |
+/−2% |
(zoomed out) |
|
In the example embodiment shown in FIGS. 1 a and 1 b, the map scale and measuring tool 105 (which is in scale mode) is initially about one inch in length, where each half inch unit of the scale 105 length is 1 mile on the displayed map. In this particular embodiment, there are fifteen zoom levels, and the current scale 105 of FIG. 1 a is shown at zoom level 6. In FIG. 1 b, the zoom level has been increased to level 4, and the scale 105 is now about one and three-quarter inches in length, where each 0.875 inches represents 0.5 miles on the displayed map. Numerous scale length/distance and zoom level schemes can be used.
In addition to information such as the map position, zoom level, and projection type, the scale function (e.g., function UpdateScale) can also include user preferences, such as choice of metric or imperial units, and latitude/longitude or degrees for display (e.g., for indicating location of scale). Other example information passed to the scale function includes a table of available scale lengths (e.g., 1 mile, 2 miles, 5 miles, 10 miles), information about the width (e.g., in pixels) of the map view, and the desired length of the scale (as well as minimum and maximum allowed lengths).
Pseudo code for an example scale function, called UpdateScale, is provided herein. This example function operates at the pixel level of the map image, and receives a number of parameters, including latitude/longitude (lat/lon) of scale location, current map zoom level (zoom), user preferred scale units (units), available scale lengths (lengths( )), and minimum, maximum, and user preferred scale widths (minWidth, maxWidth, and idealWidth). Other parameters and values can be passed to the function as well (e.g., projection type).
In this particular embodiment, the flow is as follows. Receive information that influences the scale behavior, such as information about map position, zoom level, projection, and user preferences. In response to the map being moved or zoomed, update scale accordingly by calling function, which: finds the width of one pixel; finds the scale length that is closest to the ideal length and within min and max; draws the scale so each unit is the correct number of pixels wide; and add the length to the scale as text. Here is the example pseudo code:
|
function UpdateScale(lat, lon, zoom, units, lengths( ), minWidth, |
maxWidth, idealWidth) |
pixelWidth = pixelWidth( lat, lon, zoom, units) //Find the width of one |
pixel. |
selectedLength = NIL |
//Run through all lengths to find the one that is |
|
closest to the ideal length and within min and |
|
max. |
for each aLength in lengths( ) |
lengthWidth = aLength / pixelWidth |
if ( lengthWidth <= maxWidth ) and ( lengthWidth >= minWidth) |
then |
if selectedLength == NIL then |
selectedLength = aLength |
else if Difference( Length, idealWidth ) < |
Difference(selectedLength, idealWidth ) then |
selectedLength = aLength |
end if |
end if |
next |
if selectedLength == NIL then |
Return error |
else |
//Draw scale so each unit is (selectedLength / pixelWidth) pixels wide |
and add the length as text. |
... |
end if |
End function |
|
This description of scale functionality and updating can be modified and refined to suit the particulars of a given application and desired scale performance. Numerous embodiments are possible, and the present invention is not intended to be limited to any one such configuration. Conventional scale drawing techniques, or those discussed in U.S. application Ser. No. 11/051,534 can be used to draw the scale, once the scale parameters (e.g., length, units) are known.
Measuring Tool Mode
FIG. 2 illustrates a combined scale and measuring tool that is currently in tool mode and measuring the distance between two user selected points, in accordance with one embodiment of the present invention. Initially, the scale and measuring tool 205 a is in its home position scale mode the normal mode, showing in this example how long one half mile is on the current map. As previously discussed, the scale 205 a can be drawn on the map with distinct endpoints. When the user hovers over the scale or the endpoints, a tool tip appears, indicating, for instance, “Scale at map center. Drag endpoints to measure.”
A number of user interface options are available. For example, if the user clicks the scale 205 a, an info window (as described in the previously incorporated U.S. application Ser. No. 11/051,534) opens to show more detailed information, and includes links/options for changing the units of measure. If the user clicks one of the endpoints, an information window can open to show information describing how to drag the endpoints to use the combined scale and measuring tool to measure distances on the map. Various user interface and help schemes can be implemented, using information windows as described in the previously incorporated U.S. application Ser. No. 11/051,534 and/or conventional technology (e.g., tool tips, etc.).
If the user drags one or both of the endpoints as shown in FIG. 2, the drawing of the scale/measuring tool changes to reflect the change of mode from scale 205 a to the measuring tool 205 b, and to make the endpoints have an appearance that matches their function of being attached to the map at a point. For instance, and as described in the previously incorporated U.S. application Ser. No. 11/051,534, each endpoint in tool mode can be drawn as a balloon or teardrop like marker having a point at the bottom, and casting a shadow on the map.
JavaScript code in the client can be used to make these changes by, for instance, replacing the images used in the drawing of the scale 205 a with images used in the drawing of the tool 205 b, changing the value of a variable that stores the current mode (e.g., scale mode or tool mode), and if desired removing the current content on the map, whether it is an address, a search result, or driving directions. In any case, once the user drags the scale endpoints onto the map, the scale/measuring tool is now in the measuring mode.
As can be seen, once the tool 205 b is positioned on the map, the distance between the tool 205 b endpoints is displayed in the current units of scale/measuring tool, as shown by distance indicator 210 (e.g., like an information window). This information can be provided at some position near one of the tool 205 b endpoints or near or on the line between them. If the user clicks the tool 205 b endpoints or the line between them, an information window (e.g., as described in the previously incorporated U.S. application Ser. No. 11/051,534) opens to show information about the map locations marked by the tool 205 b endpoints, and the distance between them, and offers options for changing the units, returning the tool 205 b to the scale mode, or converting the line between the points to driving directions between the same points. In this embodiment, an information window 215 is shown, and includes latitude/longitude and/or geocode information. The window also provides a dialog box for the user to enter a name of the point, if so desired. The window 215 also includes a link for driving directions, which could also be implemented as an icon, button, or other such user interface.
If the user clicks or otherwise selects the option of converting the tool 205 b line to driving directions, then a request for driving directions between the two points is sent to the backend of the mapping system, which returns the driving directions (e.g., as described in the previously incorporated U.S. application Ser. No. 11/051,534). When the driving directions are displayed, the scale/measuring tool can be returned to the scale mode and position 205 a.
Note that a homing function can also be included in the scale/measuring tool. For instance, the home position for scale 205 a can be marked by a shadow or outline of the normal look of the scale/measuring tool in the scale mode, as shown in the lower left corner of FIG. 2. In such an embodiment, once the user has gotten the distance information from the tool 205 b, clicking the outline or shadow of the scale 205 a will return the tool 205 b to scale mode in the home position.
FIGS. 3 a through 3 c illustrate a combined scale and measuring tool that is currently in tool mode and measuring the distance between three user selected points, in accordance with one embodiment of the present invention. In this example case, the user has already dragged the endpoints of tool 305 b onto the map. Then, the user drags an arbitrary point (as shown in FIG. 3 a) on the line between the two endpoints of the tool 305 b to a position on the map.
In response, the tool 305 b adds a third point, so there are now two line segments, as shown in FIG. 3 b. Distance indicators 310 are displayed for each line. When the user clicks on the lines or endpoints of tool 305 b, an information window 315 opens to show the combined lengths (e.g., Total Dist. 2.5 miles). The information window 310 shown in this example embodiment also includes latitude/longitude and/or geocode information, and provides a dialog box for the user to enter a name of the point. Other information can be provided as well in the window 315, such as the length of each of the two lines and the positions of the points. The user can repeat this line dragging operation, creating an arbitrarily long line between the points created, and can also drag the individual points to new positions on the map. In one particular embodiment, when there are more than two points, an info window that opens when the user clicks tool 305 b also has an icon, button, link or other interface allowing the user to remove a point on the line.
At the end, the user can convert the multiple segments to driving directions between the points created, and/or return the tool 305 b to scale mode 305 b, as previously described. FIG. 3 c illustrates one embodiment where the user has chosen to convert the multiple segments to written driving directions (shown to the right of the map). As previously explained, the directions could also be graphically displayed (overlaid on map), in place of the measuring tool's 305 b line. In another such embodiment, the driving directions can be provided in information windows, for example, that replace a portion of the measuring tool's 305 b line. A button or link can also be included in the interface, for providing return driving directions using similar techniques, as will be apparent in light of this disclosure.
Drawing the scale/measuring tool in the scale mode can be accomplished similarly to the way the map controls are generated by combining bitmaps, except that some parts will be scaled horizontally (and for displaying degrees even vertically) to show the exact length of, for instance, one mile. In measuring tool mode, the scale/measuring tool endpoints can be similar to the location markers used to display and interact with map locations, as previously described and discussed in U.S. application Ser. No. 11/051,534. The line can be drawn, for example, using vector libraries supported by the browser, such as VML, SVG, or Canvas, or using plug-ins such as Flash. Other options for drawing lines would be to depend on a server side program that can deliver bitmaps with lines specified by the request, or the line can be marked by bitmaps in various ways that indicate the line's position.
In one embodiment, when dragging an endpoint of the scale/measuring tool, a JavaScript initiates the drag when the user clicks and drags the mouse beyond a pre-determined threshold, and illustrates the dragging by moving the marker with the user's movement of the input device (e.g., mouse/pointer). To illustrate that the endpoint of the scale/measuring tool is no longer attached to the map as it is dragged, the marker's image can be, for instance, moved up, and the shadow moved up and to the left, while the map location that the tool endpoint is over can be marked in various ways such as by an X or a small circle. When the user releases the mouse button, the marker drops down onto the marked position, the shadow moves back down and to the right, and the marking of the point (X or circle) is removed. While the drag goes on, the JavaScript can be configured to continually sort the layering of the markers and tool endpoints on the map, according to the latitude of their positions.
Instead of removing the existing data on the map (when in measuring tool mode), such as search results or driving directions, the client could be controlled to allow such data to co-exist, and even be replaced without affecting the mode of the scale/measuring tool. In such an embodiment, dragging an endpoint of the scale/measuring tool (in tool mode) on top of an existing location marker would highlight that location marker as long as the drag is on top of it. If the user drops the tool endpoint while a location marker is highlighted, the endpoint will be at the exact location of the highlighted marker, and retain its title and address if one is available.
In addition, a marker can be dragged onto the line of the scale/measuring tool, adding the location to the measuring, just as if the line had been dragged to the marker. Note that such a drag and drop marker could also be used on its own, to highlight specific points on a map. For instance, a user can drag the marker (e.g., which is normally stowed at some home position on or near the map, such as near the combined scale and measuring tool) onto a user selected location on the displayed map. The marker presents via an information window information about that location, such as geo code, latitude/longitude, and name. The name and/or other information can be entered (e.g., via a dialog box) by the user. User can then email the “marked-up” map, for instance, to a friend to show the marked location of a proposed meeting place.
Numerous applications are possible with a combined scale and measuring tool configured in accordance with an embodiment of the present invention. For instance, the user can drag an endpoint of the scale/measuring tool onto a position on the map, where the user lives. Then the user types in the address of the user's workplace, and performs a search for the address (e.g., as described in U.S. application Ser. No. 11/051,534). When the address is shown on the map, the user drags the second endpoint onto the marker at the work address. Now the scale/measuring tool is showing the distance between the user's home and work place. The user then pans the map so that it is centered on a point on the line, and searches, for instance, for coffee shops. When the search results show up as location markers on the map (e.g., as described in U.S. application Ser. No. 11/051,534), the user can drag from the line of the scale/measuring tool onto the marker for the preferred coffee shop, so there is three points in the scale/measuring tool (e.g., as shown in FIG. 3 b). The user can then click on the tool to open an information window, and convert the lines to driving directions. The system then shows directions from the user's home to work going by the coffee shop of choice.
Digital Mapping System
FIG. 4 is a block diagram of a digital mapping system that employs a combined scale and measuring tool, in accordance with one embodiment of the present invention. As can be seen, the system includes a local cache 405, a web browser 410, a map server 415, and a map data database 420. This embodiment is based on the digital mapping systems described in the previously incorporated U.S. application Ser. Nos. 11/051,534 and 11/088,542. However, other mapping systems such as vector-based and raster-based mapping systems can also benefit from a combined scale and measuring tool as described herein.
In reference to FIG. 4, when a user requests a map or a new map view, the web browser 410 sends HTTP requests to map server 415 for map tiles needed in conjunction with the tiles already present in the web browser 410 (or in the web browser's cache 405) to produce the new map view. The map server 415 issues the corresponding map tile requests to map data 420 (e.g., which can be a database or file server). The requested map tiles from map data 420 are then returned to the web browser 410, via map server 415. The format of the tile requests can be structured in a manner that encourages the web browser 410 to cache the tiles on its local cache 405. By executing scripts as previously described in U.S. application Ser. Nos. 11/051,534 and 11/088,542, the web browser 410 then assembles the combined set of tiles into the requested map view for presentation to the user.
In addition to the scripts that assemble the map tiles to form the requested map view, the web browser 410 also executes scripts and function calls to enable and carryout the combined scale and measuring tool functionality, as described herein. Both scale mode and measuring tool mode can be implemented, for example, using JavaScript code and function calls as described herein. Other browser side programming tools can also be used as well to carry out the combined scale and measuring tool functionality.
Methodology
FIG. 5 illustrates a method for dynamically updating, in response to map changes, a combined scale and measuring tool operating in scale mode, in accordance with one embodiment of the present invention. The method can be carried out, for example, in a digital mapping system that includes a client side that requests map data from a server side (e.g., such as the one shown in FIG. 4). In one particular such case, the method is carried out on the client side. Further note that the method can be encoded as a set of instructions on one or more processor readable mediums (e.g., server, hard disk, or other memory), and carried out by a computer or other processing environment capable of executing those instructions.
The method begins with receiving 505 information that influences the scale behavior, including information about at least one of scale position on the map and zoom level. The information that influences the scale behavior may also identify a map projection (e.g., Mercator) used in making the digital map, and/or information about user preferences, including at least one of desired scale units and desired scale distance. The method continues with determining 510 the width of one pixel of the map. In one such embodiment, the pixel width is determined using a pixelWidth function, based on latitude, longitude, zoom level, and scale units. For example, assume a scale of fixed length (e.g., 200 pixels), and convert the pixel at each end of the scale to a latitude/longitude, using the current map position, and zoom level (e.g., as described in the previously incorporated U.S. application Ser. No. 11/051,534). Each of these is then converted to radians (deg*pi/180). Then, calculate the angular distance between the points: 2*asin(sqrt((sin((lat1−lat2)/2))^+cos(lat1)*cos(lat2)*(sin(lon1−lon2)/2))^2)). This result is then converted to an actual arc length by multiplying it with the radius of the earth in meters (e.g., 6378137*angular distance, where “6378137” is used as an approximation of the earth's radius). The result can then be scaled back to get meters (or other suitable units) per pixel.
The method continues with drawing 515 the scale so each unit is a correct number of pixels wide, based on scale information (e.g., desired scale units and scale distance), and drawing 520 the scale so each unit is a correct distance, based on map projection used and scale location on the digital map (e.g., which could be at the of center of the map by default). Conventional digital map drawing techniques can be used. The method further includes adding 525 the scale distance to the scale as text, and allowing 530 a user to specify units (e.g., metric or imperial) of measure for the scale. The method continues with providing 535 the user with information regarding measuring tool mode (e.g., tool tips and use instructions), where the scale can be used to measure distances on the map.
FIG. 6 illustrates a method for dynamically updating, in response to user input, a combined scale and measuring tool operating in tool mode, in accordance with one embodiment of the present invention. Just as with the method of FIG. 5, this method can be carried out, for example, on the client side of a digital mapping system, and can be encoded as a set of instructions on a processor readable medium, and carried out by a processing environment (e.g., browser enabled computer) capable of executing those instructions.
In response to the scale being moved on the digital map, the method begins with switching 605 from a scale mode to a measuring tool mode, and changing 610 the graphical look of the scale to indicate measuring tool mode is active. As previously discussed, this may include, for example, changing the look of the endpoints from circles to teardrop shaped location markers.
The method continues with drawing 615 the scale to reflect its movement as the endpoints are moved to locations on the digital map. The method continues with drawing 620 an additional endpoint each time user drags line between two endpoints to a location on the map, thereby providing a multisegment line, and displaying 625 the distance between locations marked by endpoints of scale, the distance in units of scale. The drawing can be carried out, for example, using conventional drawing techniques (e.g., using JavaScript code), and the display can be provided in an information window, as described in U.S. application Ser. No. 11/051,534.
The method continues with allowing 630 the user to request driving directions for travel between locations marked by endpoints of scale (whether a single line or a multisegment line), and providing 635 the driving directions. In response to a user selecting the scale, the method further includes showing 640 user information about points marked by scale (e.g., using an information window, as described in U.S. application Ser. No. 11/051,534).
The foregoing description of the embodiments of the invention has been presented for the purposes of illustration and description. It is not intended to be exhaustive or to limit the invention to the precise form disclosed. Many modifications and variations are possible in light of this disclosure. It is intended that the scope of the invention be limited not by this detailed description, but rather by the claims appended hereto.