Embodiment
The explanation of thinking to realize best mode of the present invention below should not be taken as a kind of restriction, only is the explanation of making in order to describe General Principle of the present invention.Protection scope of the present invention should be determined by claim.
Advantageously, the present invention has set forth top needs and other needs by the radio multimedium processor platform is provided, described radio multimedium processor platform comprises: a plurality of processor cores, a plurality of peripheral hardwares, with the embedded processor communication module, this embedded processor communication module is carried out direct memory access function able to programme to be used for selecting data transmission between the storer of a plurality of processor cores and each peripheral hardware of being connected thereto able to programmely.And, processor platform comprise the feature of the size that makes processor platform and power consumption minimum and allow video buffer from main processor memory to support LCD display the feature of the ability of other device access main processor memorys without limits.
Multimedia processor platform summary
At first referring to Fig. 1, show the high-level block diagram of radio multimedium processor platform, have three nuclears: digital signal processor (DSP), primary processor and be positioned at the risc processor nuclear of embedded processor communication module (IPCM), wherein, the embedded processor communication module is carried out direct memory memory function able to programme.Shown in the figure is multimedia processor platform 100, it comprises digital signal processor 102 (being also referred to as DSP 102), random access storage device 104 (is also referred to as RAM, DSP storer or DSP RAM), primary processor 106 (being also referred to as main frame 106 or Mcore), embedded dynamic RAM 108 (being also referred to as eDRAM 108 or main processor memory), USB (universal serial bus) 110 (being also referred to as USB 110), have preference pattern to support the universal asynchronous receiver/transmitter 112 (being also referred to as UART/IrDA 112) of IrDA standard, multimedia card 114 (being also referred to as MMC 114) and embedded processor communication module 116 (being also referred to as IPCM 116).
The multimedia processor platform 100 that constitutes with the form of single integrated circuit or chip, it is also referred to as processor platform 100 or is called processor 100 simply, have three processor core: DSP 102, primary processor 106 and the risc processor that is positioned within the IPCM 116 are examined.Processor 100 representative " SOC (system on a chip) " designs (being also referred to as " SOC ").In the application of wireless handheld multimedia devices, advantageously the assembly of processor 100 all appears on the single chip.This is that this will cause the mismatch of chip to the chip line because the restriction of the size in the hand-held appliation device also must link together by hardwired because of the discrete processor on separate chip.Yet, be important to note that to the invention is not restricted in the system on a chip design, therefore, if in other application, need, can on discrete chip, realize three processor cores, just the risc processor of DSP 102, primary processor 106 and IPCM 116 nuclear.
Be in operation, IPCM 116 is with three all parts, be that DSP part (just DSP 102 and RAM 104), primary processor part (just primary processor 106 and eDRAM108) and peripheral hardware (just USB 110, UART/IrDA 112 and MMC 114) are coupled together.Advantageously, IPCM 116 provides direct memory visit (DMA) data channel able to programme to allow carrying out following direct memory visit data transmission: (1) is set to DSPRAM 104 or eDRAM 108 outside specific, (2) from DSP RAM 104 or eDRAM 108 to specific peripheral hardware, (3) are between DSP RAM 104 or eDRAM 108.These DMA data transmission can be (event coordinated) (occurring according to request or instruction) of number of times synchronous (time coordinated) (occurring with pre-determined number) or event synchronization.IPCM has a Reduced Instruction Set Computer (RISC) processor core, and it allows by select the DMA data channel to carry out direct memory visit (DMA) data transmission able to programmely.For example, IPCM116 replaces a large amount of hardware dma controllers to create (for example) 32 programmable data channels, and wherein each data channel can be programmed with one of any transmission data in three above-mentioned directions.Hardware DMA of equal value needing usually to realize the individual single DMA data hardware control of 2*n* (c+1), 2 data channels of representing on the both direction wherein, n representative data channel number, the c representative can be used the processor number of IPCM116, c+1 represent data paths number like this.In the illustrated embodiment, n=32, c=2 (just DSP 102 and primary processor 106), c+1=3 (the number of data routing just like this, for example, be set to storer outward, storer is to peripheral hardware, and memory to memory), this obtains 192 single hardware dma controllers of IPCM 116 replacements.Disadvantageously, a large amount of like this dma controller numbers is uneconomical on cost, and will occupy the free space of processor.Therefore, IPCM provides a large amount of DMA data channel or data routing, and each in them can be configured or be able to programme so that different nodes is linked together.Like this, node is RAM 104 normally, and eDRAM 108, perhaps one of them peripheral hardware.Therefore, can programme so that the direct memory visit data transmission from USB 110 to eDRAM 108 to be provided to single DMA data channel, then, can after time in to identical data channel reprogrammed or reshuffle to provide from the transmission of the direct memory visit data of DSP RAM 104 to MMC 114.
This is from non-programmable, the transmission (departure) of hardware dma controller of unidirectional cable data channel from a node to another node are provided, and these dma controllers can not reconfigure in later time as two different nodes.Advantageously, in radio multimedium is used, very important and when requiring a lot of dma controllers to carry out the direct memory visit when the physical size of chip or processor 100 by a large amount of peripheral hardware, IPCM 116 provides a kind of programmable DMA function, in this function, the data channel of formation can change as required.Therefore, do not need a lot of dma controllers, and if the size of the whole dimension of processor 100 when realizing a lot of hardware dma controllers.
The function of IPCM 116 advantageously with primary processor 106 and DSP 104 from freeing in order to carry out the situation that data transmission has to stop to execute the task.IPCM 116 carries out these transmission to offer DSP 102 and primary processor 106 the most effective operations.In other words, allow DSP102 and primary processor 106 speed operation, and under the situation that does not reduce their execution simple data transport, carry out and formulate the vital task of giving them with their optimum.
Next referring to Fig. 2, show the more detailed block diagram of an embodiment of the radio multimedium processor platform of Fig. 1.There is shown multimedia processor platform 100, comprise: digital signal processor 102 (DSP 102), DSP RAM 104, DSP Peripheral Interface 202, primary processor 106 (being also referred to as call processing device 106), embedded DRAM 108 (eDRAM 108) comprises the lcd controller 204 (being also referred to as display controller usually) of image processor 206 and configuration register 208 and main Peripheral Interface 210.Processor platform 100 also comprises following peripheral hardware 230:USB 110, and UART/IrDA 112, synchronous serial interface 212 (being also referred to as SSI212), MMC 114 and blue tooth interface 214.In addition, also comprise IPCM 116, event timing device 216, data routing is selected 218 (being also referred to as data routing selected cell 218), eDRAM refresh controller 220 (being also referred to as refresh controller 220) and bus interface 222.
Processor platform further comprises following bus: the clock bus 224 (being also referred to as " c " bus 224) that is coupled to refresh controller 220; DSP 102, DSP RAM 104 and DSP peripheral hardware 202 are coupled to the dsp system bus 226 (being also referred to as " d " bus) of IPCM 116; Peripheral hardware 230 is coupled to the event bus 228 (being also referred to as " e " bus 228) of event timing device 216 and IPCM 116; Primary processor is coupled to the main system bus 232 (being also referred to as " h " bus 232) of peripheral hardware 230 and 210, lcd controller 204, bus interface 222, data routing selection 218, refresh controller 220 and IPCM 116; IPCM 116 is coupled to the IPCM bus 234 (being also referred to as " i " bus 234) of peripheral hardware 230; Data routing selection 218 is coupled to the memory bus 236 (being also referred to as " m " bus 236) of eDRAM 108; Image processor 206 is coupled to data routing selects 218 LCD bus 238 (being also referred to as " p " bus 238); Refresh controller 220 is coupled to data routing selects 218 refresh bus 240 (being also referred to as " r " bus 240); Bus interface is coupled to the external system bus 242 (being also referred to as " s " bus 242) of (for example) external memory storage 244; With the transfer bus 246 (being also referred to as " t " bus 246) that IPCM 116 is coupled to data routing selection 218.
Also show the following aspect of a part that is not processor platform 100 among Fig. 2: the radio hardware 248 that is coupled to DSP Peripheral Interface 202, be coupled to the LCD panel 250 of image processor 206, the clock input 252 of being coupled to the external memory storage 244 of bus interface 222 and being coupled to refresh controller 220.
Processor platform comprises three processor core: DSP 102, and primary processor 106 and the RISC processor that is embedded among the IPCM 116 are examined.Advantageously, in this embodiment, realize processor platform 100 with the SOC (system on a chip) form, although a lot of feature of the present invention is not limited to the Integration System Design on chip.Be briefly introducing below to several assemblies of processor platform 100.
Just as known in the art, DSP 102 is connected with system storage (for example DSP RAM 104 and DSP Peripheral Interface 202) through dsp system bus 226.DSP RAM 104 comprises that DSP program and data storage areas use DSP Peripheral Interface 202 that DSP nuclear (being modulator-demodular unit) is connected to radio hardware 248 to carry out cellular radio Communication.These assemblies are known in the art, and can see in cell phone usually.
As known in the art, primary processor 106 is general Reduced Instruction Set Computer (RISC) processor or complex instruction set computer (CISC) (CISC) processors.Lcd controller 204 is modules that comprise Digital Logic, and this module is configured the binary picture of (for example, eDRAM 108 storage arrays) in the storer is presented on the external LCD panel 250.Main Peripheral Interface 210 comprises one or more digital logic module, and it is configured as the peripheral hardware by primary processor 106 operations.Such Peripheral Interface comprises keyboard interface, general purpose timer and general purpose I/O port.
Primary processor also comprises multimedia peripheral 230.USB 110 is logical blocks, and it is configured as the peripheral hardware of carrying out the multimedia visit layer function of known open standard in USB (universal serial bus).This block configuration has 2 interface ports: the port that is connected to primary processor 106 through h bus 232, to be used for configuration management and control, and be connected to the FPDP of IPCM 116 through i bus 226, be used for data are dealt into external serial interface and send data from external serial interface.
IrDA/UART 112 is logical blocks of the peripheral hardware of a necessary function of the execution that is configured to know in this area, as the universal asynchronous receiver/transmitter with preference pattern, to support the IrDA standard.IrDA/UART 112 disposes 2 interface ports: the port that is connected to primary processor 106 through h bus 232, be used for configuration management, and be connected to the FPDP of IPCM116 through I bus 236, be used for data are dealt into external serial interface and send data from external serial interface.
SSI 212 is logical blocks that are configured to the necessary function of execution in the art, as synchronous serial interface.This block configuration has 2 interface ports: the port that is connected to primary processor 106 through h bus 232, be used for configuration management, and be connected to the FPDP of IPCM116 through i bus 236, be used for data are dealt into external serial interface and send data from external serial interface.
MMC 114 is designated digital interfaces that are used to be connected to and work with multimedia card (MULTIMEDIACARD).MMC 114 disposes 2 interface ports: the port that is connected to primary processor 106 through h bus 232, be used for configuration management, and be connected to the FPDP of IPCM 116 through i bus 236, be used for data are dealt into outside MULTIMEDIACARD and send data from outside MULTIMEDIACARD.
Blue tooth interface 214 is to comprise to be designed for the digital interface of supporting the BLUETOOTH open standard.Blue tooth interface 214 disposes 2 interface ports: the port that is connected to primary processor 106 through h bus 232, be used for configuration management, and be connected to the FPDP of IPCM 116 through i bus 236, be used for data are dealt into the compatible radio-circuit of outside bluetooth and send data from the compatible radio-circuit of bluetooth of outside.
Event timing device 216 is binary counters that are coupled to IPCM 116 through e bus 228, and has " n " individual state, these states are connected to and can detect the Compare Logic of being scheduled to different states, are used for producing when pointing out particular state a signal.This counter is by an accurate clock source timing.In one embodiment, event timing device 216 can be handled 32 incidents in the given time.In certain embodiments, can use event timing device 216 incident or the transmission of direct memory visit data of programming to be sent to IPCM 116 with the time interval of (for example) rule.
Serial i/O that design IPCM 116 carries out embedded processor and employing DSP 102 processors communicates by letter, and such as the I/O peripheral hardware 230 of USB 110, IRDA/UART 112, blue tooth interface 214 and MMC114.Have strategy ground that IPCM 116 is placed in the structure so that to/visiting (DMA) data transmission from direct memory able to programme can carry out with primary processor 106 or DSP102.In addition, IPCM 116 is supported in the data transmission between DSP and the main frame itself.Therefore, advantageously, IPCM 116 can be used as a DMA able to programme with data transmission to storer, and need not to relate to DSP 102 or primary processor 106 carries out data transmission.
Be RISC nuclear able to programme within IPCM 116, it is programmed to carry out the DMA function.At length introduce the internal work of IPCM 116 with reference to Fig. 3.Than the scheme of non-programmable (for example based on hardware), this measure provides several advantages.The DMA function able to programme of ICPM 116 has a lot of benefits.At first, allow RISC nuclear is programmed to carry out the dynamic routing of various tasks.Under control able to programme, in one embodiment, IPCM 116 configuration can be had the DMA data channel of 32 whiles, each DMA data channel can be configured in three above-mentioned directions one of any.By route DMA data transmission on each channel in these 32 DMA data channels.For example, can dispose each data channel as the DMA data channel to carry out the DMA data transmission between following: (1) peripheral hardware 230 is to storer (for example DSP RAM 104 or eDRAM108), (2) storer (for example DSP RAM 104 or eDRAM 108) is to peripheral hardware 230, and (3) storer (for example DSP RAM 104 or eDRAM 108) is to storer (for example eDRAM or 108DSP RAM 104).Advantageously, can be in the back in these 32 the programmable DMA data channels each be carried out reprogrammed to allow to carry out the DMA data transmission between two different nodes.
And, the greater functionality that IPCM 116 allows with littler footprint (footprint) realization.This is because IPCM 116 has replaced between the different nodes, just a plurality of discrete wired dma controller between DSP RAM 104, eDRAM 108 and the different I/O peripheral hardware 230.This has saved needed door or transistor on tube core significantly, and this is very important for the processor size that reduces the hand-hold multimedia application.Usually, the door number of dma channel is approximately every channel 3k door.In this embodiment, when requiring more than 6 hardware dma channels, IPCM 116 has space-saving advantage.Advantageously, in this embodiment, IPCM 116 can be used as 192 discrete dma channels (as mentioned above) within the footprint of the hardware dma channel of about 6 reality.
In addition, IPCM 116 is very flexible, and scalable (scalable).This notion makes and can improve himself in next-generation.The data routing capabilities makes it possible to append to such as on the basic structure based on hardware accelerator flexibly.The enhancing of the RISC of IPCM 116 nuclear comprises increases register and new instruction is satisfied needs in the future to allow this notion.
Equally, the risc processor nuclear able to programme of IPCM 116 provides the common application interface that will define (API), because RISC able to programme nuclear uses the virtual controlling register that is mapped to primary memory (just eDRAM 108).When the next generation has strengthened IPCM 116, API can completely keep.These characteristics have increased the weighed usability of software.
Another characteristics are that intelligent power management is offered IPCM 116, make it enter sleep pattern at duration of work not.This is for being very important in the handheld applications of life-span as significant consideration with battery.
Another characteristics of IPCM 116 are, as being known in the art, can use little-Endian form or big-Endian form that the DMA data transmission (is for example delivered to storer, DSP RAM 104 or eDRAM 108) and from storer (for example, DSP RAM104 or eDRAM 108) transmission DMA data transmission.This makes IPCM 116 to communicate with the dissimilar processor according to arbitrary format configuration.For example, be configured to littleEndian form or big Endian form DSP can with IPCM 116 interfaces.
Another assembly of processor platform 100 is, because total system realizes on core, the RAM of primary processor 106 is arrays on the sheet that is made of as known in the art DRAM type bit unit, and is called as embedded DRAM or eDRAM 108.This array is configured to 65536 words (64k word), and each word is 128, amounts to 67,108,846 bit locations (64M position).Must refresh eDRAM 108 periodically, this function is finished by refresh controller 220.128 bit widths of eDRAM 108 are optimized for lcd controller, and this will introduce below further.Therefore, eDRAM 108 is as main processor memory be used for video buffer on the sheet of LCD panel 250.Advantageously, the width of eDRAM has reduced number access cycle that lcd controller 204 consumes, thereby has increased number access cycle that can be used for primary processor 106 and IPCM 116.
Bus interface 222 is to comprise the module that is configured as the Digital Logic of Memory Controller well known in the art.This module support is connected to the external memory storage 244 of processor platform 100 through bus 242.External memory storage 244 comprises such as SRAM, EPROM, a plurality of discrete memory devices of FRASH and DRAM.External memory storage 244 can directly be visited by primary processor 106, is perhaps visited indirectly through IPCM 116 by DSP 102.This is favourable, because this makes primary processor 106 and/or DSP 102 load and run application that this application program is too big so that can't be stored in the respective memory of these processors.For example, DSP 102 can load and move the speech recognition program that is stored in the external memory storage 244.And bus interface 222 allows to handle simultaneously the operation between primary processor 106, IPCM 116 and DSP 102; Therefore, a plurality of instruction streams of execution, a plurality of data stream (MIMD just) have realized (for example) mediaphone on single integrated circuit.
Note, because the bus that eDRAM 108 has oneself is m bus 236 just, rather than as the part of main system bus or h bus 232, primary processor 106 can pass through bus interface 22 access external memory 244, simultaneously IPCM 116 visit eDRAM 108.
Data routing is selected 218 data multiplexers that comprise arbitrated logic and pre-programmed, and the data multiplexer of this pre-programmed is designed to data routing with eDRAM 108 and is connected in 4 entities that may require accessed array one.4 entities can visiting eDRAM 108 are the primary processors 106 with 32 access widths, IPCM116 with 32 access widths, have the lcd controller 204 of 128 access widths and be used to resemble the 16 millisecond periods encapsulation that is implemented as 4096 row known in the art and refresh (stealing refresh).In the illustrated embodiment, each requestor has unique path highway width, and for example p bus 238 has 128 width, and i bus 246 and h bus 232 have 32 width.Data routing selects 218 equipment according to the visit of obtaining the authorization automatically to dispose the suitable data path.Like this, data routing selection 218 changes the array of 128 bit widths to support for example 32 the risc processors nuclears commonly used within IPCM 116.In all cases, in order from array, to quote correct data element, consider the storage address that provides by the requestor.The highway width and the access module that are used for each requestor are shown in following table 1.
Table 1: data routing configuration
The requestor |
Highway width |
Read/write |
Access module |
Main frame nuclear |
X32 |
R/W |
X8，X16，X32 |
IPCM |
X32 |
R/W |
X8，X16，X32 |
Lcd controller |
X128 |
Read-only |
X128 |
Refresh controller |
|
0 |
The special refresh cycle |
Ask 4096 bit locations |
And, in one embodiment, data routing select 218 always be to use the big-Endian form come to from eDRAM 108 storages with obtain data.Yet, because IPCM is configured to work in little-Endian form or big-Endian form, if IPCM comes work according to the little-Endian form, data routing selects 218 according to little-Endian IPCM to be changed back and forth, and to change eDRAM back and forth be the big-Endian form.Like this, IPCM must the notification data routing it be configured to that form.
The storage request that refresh controller 220 produces eDRAM108 is so that refresh the bit location that is arranged in the eDRAM array periodically.Yet, in a preferred embodiment of the invention, carry out the method that refreshes eDRAM 108 in such a way, this is irrespective minimizing power dissipation in known refresh technique.Introduce several specific refresh technique that is designed for the saving power consumption with reference to figure 7-9.
Be introduction below to various bus interface.Clock bus 224 (" c " bus) is a clock incoming line, is used for refresh controller 220 is carried out program design and timing.Dsp system bus 226 (" d " bus) comprises address and data routing separately, and has the control signal that transmits read-write operation to selected equipment.In addition, also comprised bus request and bus acknowledge signal, used the dsp system bus to allow IPCM 116 requests.Event bus 228 (" e " bus) is the one group of signal that is driven by peripheral hardware 230, and its incoming event checkout equipment that is sent to IPCM 116 (see figure 3)s is to be used for the activation data transfer operation.Main system bus 232 (" h " bus) comprises address and data routing separately, and has the control signal that transmits read-write operation to selected equipment.H bus 232 can be independent of other all bus work.In addition, bus request and bus acknowledge signal also collaborative work use h bus 232 to allow the IPCM request.IPCM bus 234 (" i " bus) is to comprise the address separately and the IPCM system bus of data routing, and has the control signal that transmits read-write operation to selected peripheral hardware 230.Memory bus 236 (" m " bus 236) is a bidirectional bus, and is used to eDRAM108 and data routing are selected 218 module interconnects.Memory bus 236 has 128 highway width.LCD bus 238 (" p " bus 238) is the unidirectional bus with width of 128, is used for the display image sample value is sent to lcd controller 204 to show on LCD panel 250.Refresh bus 240 (" r " bus) is so a kind of bus, when effective, is included in the address of the next line that will be refreshed in the eDRAM108 array.External system bus 242 (" s " bus) comprises address and data routing separately, and this data routing has the control signal that the selected external memory storage 244 of transmission carries out the read and write operation.External system bus 242 can be conducted interviews by primary processor 106 or IPCM 116.Transfer bus 246 (" t " bus) is sent to eDRAM 08 array with request of access from IPCM 116.Transfer bus is two-way, and has 32 bit datapath and 32 bit address paths.
Another feature of eDRAM 108 is, it provides video buffer on the sheet, and it is reserved as the RAM of primary processor 106 simultaneously.Advantageously, in order to adapt to lcd controller 204, eDRAM 108 is 128 bit widths.If eDRAM is 32 for width, it will get used to supporting general risc processor nuclear and primary processor, and eDRAM makes other equipment that use eDRAM have to and lcd controller 204 competitions the request domination of origin self-supporting lcd controller 204.Therefore, lcd controller 204 becomes the main users of eDRAM and IPCM 116 in fact, and primary processor 106 becomes Secondary Users.By the very wide impact damper with LCD bus 238 same widths is provided, lcd controller 204 is only visited eDRAM108 briefly, allows IPCM 116 and primary processor 106 to become the main users of eDRAM 108.Therefore, with 128, bit width configuration eDRAM, lcd controller only uses the eDRAM ability of 2-3%, advantageously leaves other equipment that use eDRAM for 97%.Notice that data routing is selected the bus access eDARM 108 of 218 permission different in width.
In fact, eDARM 108 double as system storages and video buffer have further reduced the space on processor platform 100.If adopt special-purpose discrete video buffer, carry out as routine, this discrete video buffer will take the exceptional space on the processor platform, perhaps become the discrete IC that is connected to lcd controller 204, it will occupy many more spaces, and cause the loss in the distribution.Different with the discrete video buffer of routine, the eDARM 108 of processor platform 100 realizes system storage and video buffer with compact package.
Introduce the feature of the others of IPCM 116 below.
Because IPCM allows to carry out data transmission from the outer DSP of being set to RAM 104 or the eDRAM 108 that is mapped to IPCM bus 236, this IPCM allows to use peripheral hardware 230 by DSP 102 and/or primary processor 106.For example, can visit DSP 102 or primary processor 106 such as the data storage device of MMC 114.Therefore, the data of MP3 format can flow to DSP 102 to influence the internet audio player from MMC 114.Other application comprises by primary processor 106 uses IPCM to come write or read to be arranged in the data file of MMC 114.And, IPCM can be configured to the DAB sample value to/from mobile DSP RAM 104, and move to a pair of USB synchronous port; Therefore, realized a speaker-phone.In addition, IPCM 116 supports a plurality of data stream that come from and/or end at eDRAM 108 or DSP RAM 104.Can transmit independently of each other from each the data stream among eDRAM 108 and the DSP RAM 104.
In addition, because IPCM 116 comprises risc processor nuclear (details are referring to the introduction with reference to figure 3), but it is intelligence programming.Therefore, can programmed tasks be unloaded from primary processor 106 through DMA data transmission from eDRAM.For example, IPCM 116 can carry out " bit-blit " task of being carried out by primary processor 106 usually.As known in the computer graphics techniques field, " bit-blit " task relates to the background demonstration that changes visual display or causes image " to fly " to cross visual display.IPCM 116 can download necessary programs carrying out this generic task from primary processor 116, rather than is carried out by primary processor 106, makes primary processor 106 liberation to carry out other task.
Another application with primary processor 106 or DSP 102 from carrying out such as freeing in the packet oriented protocol frame function that is used in " PPP " or " LAP layer " function the IrDA standard.At this moment, advantageously, primary processor 106 and DSP 102 do not need to carry out these functions.
In one embodiment, by under the control of primary processor 106 and management grouping being sent to demoder, IPCM 116 supports to be coupled to the mpeg decoder of SSI 212 or UART/IrDA 112.IPCM 116 obtains decoded pixel data again from outside mpeg decoder, and pixel data is stored in the video buffer zone that is distributed among the eDRAM 108.Like this, " image on desktop window (picture-in-desktop-window) " offered LCD panel 250.
IPCM utilizes event timing device 216, makes to activate programmable DMA data transmission according to event timing device 216, except can being activated by the incident that separately peripheral hardware and/or DSP 102 and/or primary processor 106 trigger.Therefore, predetermined times will automatically appear in the DMA data transmission of pre-programmed.
And, in order to make the power consumption minimum, IPCM is designed to enter low-power consumption mode (sleep pattern just) when not having incident.Therefore, IPCM 116 consume battery life between the DMA data transmission necessarily.
Embedded processor communication module (IPCM)
Next referring to Fig. 3, show the block scheme of embedded processor communication module (IPCM) of the radio multimedium processor platform 100 of Fig. 1 and 2.The IPCM 116 that illustrates (being also referred to as " direct memory access modules able to programme ") comprising: risc processor nuclear (more generally being also referred to as the RISC nuclear of processor 302), event scheduler 304 (is also referred to as event detection unit 304, task dispatcher 304 or task dispatcher able to programme 304), static RAM (SRAM) 306 (being also referred to as SRAM 306), ROM (read-only memory) (being also referred to as ROM 308), DSP direct memory addressed location 310 (being also referred to as DSP DMA unit 310), main direct memory addressed location 312 (being also referred to as main DMA unit 312), DSP control register 314 (being also referred to as DSP control module 314) and main control register 316 (being also referred to as main control unit 316).Also show dsp system bus 226 (" d " bus 226) among the figure.Main system bus 232 (" h " bus 232), IPCM bus 234 (" i " bus 234) and comprise the peripheral hardware 230 of USB 110, IrDA/UART112, SSI 212 and MMC 114.Also show input 318 of event timing device and peripheral hardware/DMA incident input 320 among the figure, it enters event scheduler 304 through event bus 228 (" e " bus 228).
Through bus interface DSP control register 314 and DSP DMA unit 310 are coupled to d bus 226.Through bus interface main control register 316 and main DMA unit 312 are coupled to h bus 226.IPCM 116 also comprises the i bus 234 that is coupled to various peripheral hardwares 230.Within IPCM 116, risc processor nuclear 302, SRAM 306, ROM 308, DSP control register 314, DSP DMA unit 310, main control register 316 and main DMA unit 312 all are coupled to i bus 234.DSP DMA unit 310 and main DMA unit 312 comprise the bus transceiver part of conventional dma controller separately.Event scheduler 304 is coupled to processor 302.Input to event scheduler 304 is event timing device 318 and peripheral hardware/DMA incident 320.
Be in operation, IPCM 116 provides embedded processor and serial i/O data transmission, and they adopt direct memory visit (DMA) technology, do not realize special-purpose separately hardware dma channel and be actually all different possible data transfer paths.Advantageously, carry out these DMA data transmission by IPCM 116 is provided, from then on primary processor and DSP free in the generic task, and can carry out more importantly task.Advantageously, opposite with traditional dma circuit (being also referred to as dma controller), IPCM 116 is programmable dma modules, it provides DMA data channel able to programme, this DMA data channel able to programme can be programmed one of data transmission of carrying out three types: (1) is one of any from 230 to two storeies of selectable peripheral hardware (for example DSP RAM 104 or eDRAM 108), (2) one of any from two storeies (for example DSP RAM 104 or eDRAM 108) to selectable peripheral hardware 230, between (3) two storeies.Therefore, IPCM 116 has disposed (for example) 32 DMA data channels able to programme, and each can be arranged in six kinds of data transmission one.Advantageously, the physics footprint of approximate 6 conventional hardware dma controllers of knowing in the art, in one embodiment, IPCM 116 substitutes 192 independently dma controllers in the arbitrarily given time, and to have be 32 abilities that are configured outside 192 possible DMA data channels.Then, each in the DMA data channel of these 32 programmings is used for carrying out the DMA data transmission.And afterwards or as required, these 32 data channels can be changed to 32 different channels in 192 possible DMA data channels configurations by reprovision.This for example confirms it is very valuable and flexibly in the handheld device in the application of space preciousness.
In one embodiment, in 32 dma channels of reservation is as the control channel from primary processor 106 to IPCM 116.Therefore, IPCM 116 can dispose 31 DMA outside 186 possible DMA data routing configurations.Conveniently be, this control channel allows primary processor to transmit control message to IPCM, so that one or more in the DMA data routing groups of 31 oneself configurations are reconfigured as 186 another ones in the possible DMA data routings configuration.Even do not have control channel, also the DMA data routing group of whole 32 oneself configurations can be removed and reconfigured by primary processor.
In order to finish the function of this DMA data transmission able to programme, IPCM 116 has comprised risc processor nuclear 302 and ROM 308 and SRAM 306.In certain embodiments, risc processor nuclear is made of little risc processor nuclear.Risc processor nuclear 302 is used for the short command or the instruction (being stored in SRAM 306) of complete DMA data transmission.A specific examples that customizes risc processor nuclear and instruction set thereof has more detailed description in this paper back.Also include a pair of DMA unit, DSP DMA unit 310 and main DMA unit 312, they and risc processor are examined 302 interfaces, and regulation, special register are used in transmission to all DMA.Therefore, DSP DMA unit 310 and main DMA unit 312 comprise the part of the general line transceiver of traditional dma controller.The tradition dma controller, for example, address register, the data register sum counter is risc processor nuclear 302 inner realizations.Like this, DSP DMA unit 310 is represented respectively with risc processor with main DMA unit 312 and is examined data path and the corresponding bus that 302 lines are connected, as d general line 226 and h general line 232.
ROM 308 starts scripts (being guidance code) and by other application program that resides in the script reference among the SRAM 306.The example of having the ROM script among the appendix B.SRAM 306 is divided into processor content space district and is used for the code space district of memory channel script.By using main DMA unit 312, the channel script is downloaded to from eDRAM or from external memory storage among the SRAM 306 by IPCM116.By being provided, the order and the pointer request that provide by primary processor download.Each programmable or " virtual " DMA data routing can be configured based on " required " under the control of primary processor independently.This allows the function of a wide region when using possible storage inside encapsulation footprint.Micro code program can be stored in the external memory storage, for example in the high capacity short-access storage, and when needed with its download.
Task dispatcher 304 is programmable scheduler, and it receives request to carry out the DMA data transmission from peripheral hardware 230, primary processor 106 and DSP RAM 102.The form of these requests is detected on e bus 228 " incidents ".Incident is the condition that operation that the specific DMA data letter able to programme of control arrives occurs.For example, an incident is carried out one the indication of peripheral hardware, main frame or DSP (for example peripheral hardware/DMA incident input 320) in the DMA data transmission from hope.Incident can be the signal from primary processor, the specific DMA data channel of warning IPCM reprogramming.Incident also can be the timing indication that the DMA data transmission will take place from event timing device (event timing device input just 318).For example, detect incident according to which line on e bus 228, task dispatcher 304 can point out who is in request or point out to wish to carry out the DMA transmission.304 pairs of requests of task dispatcher are divided right of priority and are managed.Task dispatcher 304 monitors and detects the external event that is used for the DMA data transmission, and incident (for example, pointing out to carry out the signal of DMA data transmission) is mapped to specific DMA data channel.Incident is by being mapped to the DMA data transmission that is positioned at specific DMA data channel according to right of priority, makes the data transmission of higher-priority occur in before the DMA data transmission than low priority.And task dispatcher 304 can be carried out " seizing right of priority ", wherein, interrupts (time-out) specific DMA data transmission by the current execution of IPCM, makes and can carry out higher-priority DMA data transmission.In case finish the DMA data transmission of higher-priority, then recover interrupted DMA data transmission, unless asked other higher-priority DMA data transmission.Usually, processor is known and is seized right of priority; Yet conventional dma controller is based on (just non-programmable) of hardware, therefore, can not carry out this type of and try to be the first.Advantageously, this embodiment provides the right of priority of seizing in DMA able to programme system.
Be brief description below to the data stream in the dissimilar DMA data transmission of supporting by IPCM able to programme.
1. be set to storer outward
Usually, various peripheral hardwares 230 are responsible for the data that collection will be input to processor platform.When data have arrived specific peripheral hardware, for example, arrived MMC 114, peripheral hardware sends to incident through event bus 228 task dispatcher 304 of IPCM 116.Task dispatcher 304 can handled 32 incidents in preset time arbitrarily.Compose to the incident right of priority by task dispatcher 304, and be mapped to specific DMA data channel.In case the execution incident, risc processor nuclear 302 is with the form operating software of the script that is arranged in SRAM 306.Software is exclusively used in specific DMA data channel, and disposes specific DMA data channel.Software instructs risc processor nuclear 302 to be set to the DMA data transmission of storer destination (for example, Edram or DSP RAM) with influence effectively outside specific.The DMA data transmission is carried out by the software in risc processor nuclear 302, makes data in peripheral hardware through i bus 234 and DMA unit separately, for example the storer that sends to separately of DSP DMA unit 310 or main DMA unit 312.
Advantageously, the carrying out of DMA data transmission do not relate to DSP or primary processor.And, comprising risc processor nuclear 302 and single hardware dma circuit by use, a lot of different DMA data routings can be set up by single hard-wired DMA unit in for example main DMA unit 312.In these data routings each is called as DMA data channel able to programme or " virtual " DMA data channel.For example, have DMA data channel or path, and from another DMA data channel or path of SSI 212 to DSP RAM 104, the two all passes through 310 transmission of DSP DMA unit from USB 110 to DSP RAM 104.Advantageously, arbitrary DMA data channel can be configured to different DMA data channels afterwards, for example from MMC 114 to DSP RAM 104.Therefore, utilize in DSP DMA unit 310 or the main DMA unit any, be coupled to IPCM 116 but can be chosen as able to programmely from any one peripheral hardware to each peripheral hardware of storer DMA data channel.
2. storer is to peripheral hardware
Such DMA transmission is with first type difference: transmission is for example to be to the peripheral hardware 230 one of DSP RAM or main processing memory (for example eDRAM) from one of them storer of the processor core of processor platform.DSP sends to task dispatcher 304 through DSP control register 314 with " incident " (data transmission), and task dispatcher is composed to the incident right of priority, and it is mapped to the DMA data channel, and sends signals to risc processor nuclear 302 with the execution data transmission.The information that is provided by DSP shows the position of data storage among the DSP RAM and will send how many data.Then, risc processor is with the form operating software of the script that is arranged in SRAM306.This software is exclusively used in specific DMA data channel.This software instructs risc processor nuclear 302 with the DMA data transmission of influence from DSP RAM 104 to specific peripheral hardware 230 effectively.This transmission is carried out by the software in risc processor nuclear 302, makes to copy data to be positioned at the DSP ram cell register from DSP RAM, and data are transferred to peripheral hardware through i bus 234 then.
3. memory to memory
The DMA data transmission of the third type is a memory to memory.For example, be transferred under the situation of main processor memory (for example, eDRAM 108) from DSP storer (for example, DSP RAM 104) in data, DSP gives an event report task dispatcher 304 of IPCM 116.Task dispatcher 304 these incidents of identification are given its allocation priority, cause risc processor nuclear 302 then and from DSP RAM to risc processor examine 302 DMA data transmission own with influence through DSP ram cell 310 from SRAM 306 Download Scripts.For example, data are put into the register that is positioned at risc processor nuclear 302 temporarily.Then, between risc processor nuclear 302 and main processor memory (for example, eDRAM 108), carry out the DMA data transmission through main DMA unit 312.This is effective " back-to-back " DAM data transmission.IPCM116 has solved the difference of memory size.For example, if DSP RAM is 16 bit widths, and main processor memory is 32 bit widths, and IPCM will collect 16 words and they are encapsulated 32 words in position, then 32 words will be transferred to main processing memory.
In case finish " back-to-back " DMA data transmission from DSP RAM to primary processor through risc processor nuclear 302, IPCM 116 will signal with the notice primary processor to primary processor: data storage is arranged in storer.In other words, risc processor nuclear 302 sends to primary processor through main control register 316 with control signal, be given to the position indicator pointer of an address to primary processor, this address points out in main processor memory where data start from, have how many words to be placed in the main processor memory that starts from described address.At that point, primary processor at the convenient time regains data.Notice that the length that most of DMA data transmission are a lot of bytes (for example 1000 bytes) required to repeat many times before event signal is finished in the transmission transmission.This significant process also is same as the outer transmission that is set to storer, and just risc processor nuclear 302 is notified each processor core, for example DSP or primary processor: data are hung up in storer.
This is opposite with data transmission is carried out in known permission in the art between two processors processor bridge.For example, if primary processor is wanted data are moved on to DSP from main frame, main frame must interrupt DSP, and DSP is ready to swap data by the time, hangs up a moment (briefmoment) then, and main processing will be controlled the DSP storer, with the influence transmission.This supspends DSP and primary processor unfriendly during data transmission.Therefore, main processor memory stops simultaneously with the DSP storer and communicates by letter.
On the contrary, IPCM 116 allows not need to interrupt the direct memory visit data transmission that DSP carries out nuclear 302 from the primary memory to the risc processor.The activity of unique requirement of primary processor 106 is that transmission one control signal is to send to an incident IPCM to carry out the DMA data transmission of the data of nuclear 302 from the primary memory to the risc processor.Next, carry out from the DMA data transmission of risc processor nuclear 302 to DSP storeies.Then, DSP regains data from DSP RAM.In the case, DSP or primary processor do not need to stop to transmit for the other side.
Next referring to Fig. 4, the figure that illustrates has illustrated that by Fig. 1 the direct memory of selecting that 2 and 3 IPCM 116 provides is visited (DMA) data channel able to programmely.There is shown IPCM116, DSP ram cell 310, main DMA unit 312, risc processor nuclear 302, i bus 234, d bus 226 and h bus 232.DSP ram cell 310 comprises that DSPRAM data connect 402 and are connected 404 with the 2nd DSP DMA data.Main DMA unit 312 comprises that the first main DAM data connect 406 and are connected 418 with the second main DMA data.
IPCM 116 comprises DSP DMA unit 310 and main DMA unit 312.Each DMA unit 310 and 312 comprises the bus transceiver part of conventional dma controller, and form 2 hard-wired DMA data connect (by this connect DMA data channel able to programme can set up be used for the DMA data transmission), one is connected risc processor nuclear 302 on the direction of storer, another at storer on the direction of risc processor nuclear 302.These 4 DMA data connect and can be programmed by the risc processor nuclear 302 of IPCM, just look like that they are with risc processor to examine 302 a integral body, have 192 (if one of them DMA data channel is control channel then is 186) actual hardware dma controller.On the contrary, Chang Gui dma controller only allows to use the DMA data to connect the dma channel of setting up a special use.
Just in broad terms, risc processor serves as the switching between equipment and the various wired DMA data connection.Therefore, the first main dma channel can be connected 406 configurations or be programmed for many different DMA data channels able to programme, for example from the DMA data channel of USB 110 to eDRAM 108, from the DMA data channel of SSI 212 to eDRAM 108 with from the DMA data channel of MMC 114 to Edarm 108.These use the different DMA data channels of the first main DMA data connection 406 can be called as " virtual " DMA data channel, because they provide effectively than more DMA data channel in hardware.Therefore, the first main DMA data believe that 406 is to select able to programmely, make it can support any one from several peripheral hardwares or connect 404 origination node DMA data transmission from the 2nd DSP DMA data to the storer (for example, eDRAM 108) that connects 406 destination in the first main DMA data.Therefore, risc processor nuclear 302 and single DMA unit, for example main DMA unit 312 replaces the conventional dma controller of much discrete wired connection.
Equally, the second main DMA data connect 408 in can being chosen as from origination node or node (for example, eDRAM 108) to several peripheral hardwares with being programmed any one or connect " virtual " DMA data channel of 402 destination node to DSP DMA data.In these virtual dma data channels each utilizes the second main DMA data to connect 408.And, can connect 408 by the second main DMA data and be connected 402 with DSP DMA data and influence " back-to-back " DMA data channels through risc processor nuclear 302.
Risc processor nuclear/the IPCM of customization
Notice that risc processor is endorsed being that the standard risc processor is the same as known in the art.Yet, risc processor that can design customization, it can improve the performance among the IPCM 116.Be to explanation below as the specific embodiment of the risc processor nuclear of the customization of the IPCM of Fig. 1-4 and IPCM.
The risc processor nuclear 302 of customization is 32 bit register structures with 16 bit instructions.Such just as known in the art, 8 32 general bit registers are arranged, 4 signs (T, LM, SF, and DF) and PCU register (PC, RPC, SPC, and EPC).Risc processor nuclear 302 is two level production lines, and comprises ROM 308 and SRAM 306.ROM308 is 1K byte (being configured to 256 x 32), and SRAM 306 is 8K byte (being configured to 2048 x 32).
The risc processor nuclear 302 of customization (becoming risc processor nuclear 302 afterwards simply) is used to a SRO of complete DMA data transmission.Instruction set (being stored among the SRAM 306) is by the one-cycle instruction except load (Load/Store), CRS, DMA and will spend the branch instruction that two or more carry out in cycles and constitute.In being affixed to this subordinate list A, provide preferred instruction set.I bus 234 is supported 32 bit datapath and 16 bit address buses.A pair of DMA unit, promptly DSP DMA unit 310 is connected with risc processor nuclear 302 with main DMA unit 312, and is that specific, special-purpose register is used in all DMA transmission.
ROM 308 comprises and starts script (being guidance code) and by other application program that resides in the script reference among the SRAM 306.SRAM 306 is divided into the processor content regions and is used for the code area of store path script.By using main DMA unit 312, the path script is downloaded to from eDRAM or from external memory storage among the SRAM 306 by IPCM 116.By using the order and the pointer that provide by primary processor to start download.Each programmable or " virtual " DMA data routing can be configured based on " required " under the control of primary processor independently.This allows the function of a wide region when the minimum storage inside footprint that may use.Micro code program can be stored in the external memory storage, for example in the high capacity short-access storage, and when needed with its download.
Task dispatcher 304 is responsible for monitoring and detecting external event, incident is mapped to DMA data channel (also being called channel simply), and each channel is mapped to pre-configured right of priority.At any time, task dispatcher will ask the highest right of priority channel of service to offer IPCM 116.Use the instruction of a specific I PCM nuclear to come " producing conditionally " to be used to carry out the current channel of the qualified channel of asking service.And if only if, and qualified channel is in when hanging up (pending), and the channel of current execution is preset sky (pre-empted).The instruction of two " generations " is arranged, and it differently determines qualified channel: in first kind, qualified channel is the hang-up channel with higher-priority that strictness is higher than current channel right of priority; In second kind (" producing (yieldge) "), qualified channel is the hang-up channel that has more than or equal to the right of priority of current right of priority.Task dispatcher 304 detects the equipment (for example, channel) that needs service by 32 incoming event ports (input 318 of event timing device and peripheral hardware/DMA incident 320).Detect after the incident, and and if only if its when being mapped to channel, channel event is latched in " channel is hung up (EP) " register.The right of priority of the channel of all hang-up combines with the control bit that is provided with by primary processor and DSP, and by continuous assessment to upgrade the highest hang-up right of priority.When finishing the channel services program, by channel script software removing each in channel hang-up register.
Main control module (just main control register 316) comprises the several little RAM piece that is organized as array, and this several RAM block is used to control (channel mapping just) 32 independent channels.Channel just can register be maximum array ram (32 x 32), is used for incident is mapped to specific channel (one or several).Second array is that right of priority RAM is used for giving programmable 1 to 7 (1-of-7) level right of priority with channel allocation.
32 incidents that are connected to task dispatcher through e bus 228 are imported from different sources, and are similar to interrupt request singal.The receiving register of finding in UART and USB port incident full and the transmission register sky is the typical signal that is connected to the incident port on the IPCM.Some incident inputs derive from the timer (for example, the event timing device 304) of layer 1.Be based on comparison/the catch register of square in the timer of layer 1, it can be used to send the momentary status of unique incident, layer 1 timer.Can use these incidents to trigger specific I PCM channel or channel.This feature can be used to be implemented in " (just-in-time) in real time " exchanges data between two processors (for example DSP and primary processor), to loosen the requirement of satisfying the crucial time limit.
The inward nature of IPCM requires at the sheet debugging capability guaranteeing product quality and reliability, and realizes all properties ability of described nuclear.The compatible debug port of OnCE comprises supports to be provided with breakpoint, single step and tracking and register removing ability (dump capability).In addition, from the addressable all memory locations of debug port.
IPCM 116 has two storage space: one is used for instruction, and another is used for data; Identical resources (ROM and RAM equipment) are shared in two spaces, and the system bus management is when IPCM visits when being used to read instruction and reading or writing the same asset of data possible conflict.
The instruction of 16 bit wides is stored in the equipment of 32 bit wides, and also image data equally can be visited.Be Big Endian accordingly: the most significant part (bit [31:16]) in even number instruction address (with " 0 " ending) visit 32 bit data, and the minimum live part (bit [15:0]) of odd number instruction address (with " I " ending) visit 32 bit data.
Can from IPCM and RAM, obtain instruction.Can visit ROM, RAM, peripheral hardware (USB, UART1, UART3, MMC and VSAP) and memory map registers as visit data.
Task dispatcher 304 is based on the design of hardware, as coordinating timely 32 programmable selection DMA data channels (virtual dma channel) of carrying out by IPCM according to channel status and right of priority.Function below task dispatcher is carried out: (1) monitors, detects and deposit one of any appearance in 32 incidents inputs that provided; (2) the particular event input is linked to (channel mapping) in particular channel or the channel group; (3) ignore incident in the channel (one or several) that is not mapped to configured in advance; (4) keep the tabulation of all channels of request service; (5) priority level (1 to 7) of pre-programmed is distributed to each channel that request is served; (6) detect and mark the excess of stroke/underload (overrun/underrun) condition.
DMA data channel able to programme or virtual dma data channel (hereinafter referred is a channel) management is by the data stream of IPCM 116.Streams data is normally unidirectional, but can reshuffle or reprogrammable.IPCM can have 32 channels of working simultaneously, is labeled as 0 to 31.Channel 0 is exclusively used in primary processor 106 with control IPCM 116.Other all channels can be distributed by main processor software.
Incident be can control channel the condition of appearance of operation.Incident can cause by outside (just outside IPCM) controlled condition (for example, UART receives FIFO and arrives a threshold value) or by starting timer internal (for example, event timing device).IPCM will carry out maximum 32 incidents, and they occur each other each other randomly.Therefore, incident is designed to arrive randomly task dispatcher, and task dispatcher can at any time be handled 32 incidents simultaneously.
Task dispatcher 304 is mapped to incident in the channel, and composes and give the incident right of priority.Channel can stop (stall) and serve on the incident.An incident can be waken a not only channel (for example, L1 timer) up.The mapping of the channel from incident to its influence is under the programmed control.For in 32 incidents each register is arranged all, it comprises a bitmap.There is one to be used for determining which channel is incident waken up for each channel.For in 32 channels each register is arranged also, it comprises channel will be operated in for which priority level.
The hardware scheduling module is carried out like this a dispatching algorithm, when instruction that script executing allows to reschedule, and the highest priority script that operation is had the hang-up incident.
Can move a plurality of channels in any given time.Task dispatcher 304 (firmware hardwired logic) is selected the channel operation of highest priority when current channel is abdicated.The channel that withdraws from can block external event or hang up interference by primary processor 106 or signal generator 102.Only working as following conditions is that true time can move I channel:
(HE(i))|HO[i[)&?DDE[i]|DO[i])&(EP[i]|EO[i])
The main enable bit HE[i that is used for each channel] can be by primary processor setting or removing.It can be removed by script.
The master who is used for each channel surmounts (override) enable bit HO[i] can be by primary processor setting or removing.It can be removed by script.By setting this position, primary processor 106 can allow channel not need to relate to it, as the communication between DSP 102 and peripheral hardware 230.
Dsp enable bit DE[i] be provided with or remove by DSP.It can be removed by script.
DSP surmounts enable bit DO[i] can be by primary processor setting or removing.By setting this position, primary processor 106 can prevent that DSP from hanging up channel.This is the situation when Channel Transmission does not relate to DSP.
Events pending position EP[i] be the output of task dispatcher.It can be removed by script.It also can be by the main frame setting to surmount incident/channel connection matrix.
Incident surmounts an EO[i] by primary processor setting or removing.By this position is set, primary processor can prevent that channel from stopping the peripheral hardware incident of hanging up.This is not handle the i/o incident, the situation when for example primary processor is to DSP DMA data transmission when channel.
When resetting, with all HE[i], HO[i], DO[i], ER[i] and EO[i] be set to 0.
IPCM116 can remove HE[i by means of execution command (done instruction) or notification instruction], DE[i] and EP[i] position.The instruction of carrying out causes that one reschedules, and notification instruction does not then have.Execution and notification instruction can be removed down (and having only) in the rheme:
HE[i], DE[i], or EP[i]
When several channels with equal priority when all being qualified, the selection tree of hardware wiring will be automatically comes selective channel with maximum number: just, if having the channel 7 of right of priority 4 and channel 24 all in hang-up, channel 24 will be the channel of next operation.
Under the situation of " generation " instruction (if just produce more than or equal to), and the channel with right of priority identical with current channel is as described above the same when hanging up, and drives the behavior (behavior) by hardware cloth line options tree.For example, given three channels (that is, 7,23 and 29) have identical highest priority.
Channel 7 is effectively, and moves one " generation "; It can be tried to be the first by channel 29; For a moment, channel 29 operations " generation ", then, it is tried to be the first by channel 23, and channel 23 is selecteed channels as channel 29, does not belong to selectable channels, because it is current channel.Afterwards, channel 23 moves one " generation ", and is tried to be the first by channel 29.In each " generation " afterwards, channel 23 and 29 will continue to switch a termination in them.It is qualified only to become at this moment channel 7.In this example, suppose not have other qualified channels hanging up.
Next referring to Fig. 5, the description shown in the figure has illustrated the function of the specific embodiment of employed task dispatcher in the customization risc processor among Fig. 3 according to an embodiment of the invention.Shown in the figure is rim detection and latch units 502, multiplexer 504, counter 506, channel enables RAM 508, channel is hung up register 510 (produce events pending position EP[i] EP), OR-gate 512, AND gate 514, channel errors register 516, the instigator can register 518 (produce main enable bit HE[i] HE), the main enable register 520 (produce the main enable bit HO[i that covers] HO) that surmounts, DSP enable register 522 (produce DSP enable bit DE[i] DE), DSP surmounts register 524 (produce a main DO[i that surmounts] DO), incident surmounts register 526 (the generation incident surmounts an EO[i] EO), decision tree 528, priority register 534, the highest hang-up priority register 530 (HPPR), the current channel register 532 of the highest hang-up (HPCR).
Task dispatcher 304 comprises 3 level production lines, is used for processing events input and attached its right of priority of giving.The first order scan event of streamline is imported, and detected incident is mapped to the channel (one or more) of activation.The tabulation (channel hang-up register) of the channel of request service is kept in the second level of streamline, and from right of priority RAM 534 with the channel of priority allocation to all hang-up, and the third level identifies top right of priority and relevant channel.
The right of priority output of task dispatcher is applied to the risc processor nuclear of IPCM, and compares with the current right of priority of being carried out by the RSIC processor core.This nuclear is kept at current right of priority in the program status word (PSW) (PSW).When running into the generation instruction, if the task dispatcher right of priority greater than current right of priority, will be seized right of priority.
Following content is the explanation to the streamline of task dispatcher.
32 edges that the first order of streamline (level 1) comprises the front end that is placed on 32X1 digital multiplexer 504 (being called mux or M1) detect and latch units 502.Mould 32 counters 506 drive mux504 by 32 incident inputs and select input and mux504 sequence.For each the corresponding logical one that is scanned, logical one is applied to 32 x 32 and enters channel and enable RAM 508; Therefore an incident is mapped in the channel.The edge corresponding with the incident that scans detects and is latched in the next clock period and removed automatically.One just detection in the incident input allows read output signal to be added to channel with one and enables RAM 508.An incident can take 32 clocks with detected.In case detect, incident can enable RAM 508 by channel and blaze abroad from mux 504 in a clock period.
In the second level, channel enables RAM 508 by identical 32 digit counters, 506 addressing, and is one and has side (the 32 X 32) array that offers the single-bit of each incident by each channel.If allow channel and detect events corresponding, the channel from data-out port enables RAM 508 generation logical one outputs.This signal is latched to and is positioned at the relevant position that channel is hung up register 510.Detected incident enables RAM 508 from channel and propagates into channel hang-up register 510 in 2 clock period.Channel hang up register 510 (EP) be one have its everybody corresponding to each 32 bit registers in 32 channels.Note, on the given arbitrarily clock period, be judged to be (assert to) channel and hang up that the channel number of register 510 determined by the number that is made as " 1 " in 32 bitmasks corresponding to the selected address of 5 digit counters.Use OR-gate 512 that " current state feedback " offered trap (trap), and remain on the detected incident in the channel hang-up register 510.Equally, note, provide one " bit clear " input to allow the certain bits of IPCM nuclear removing in channel hang-up register 510.When having served corresponding channel, carry out this operation by software instruction by IPCM nuclear.
Afterwards, use one group of 32 AND gate 514 to detect the opinion again that does not have serviced incident.In other words, be to hang up if sent an incident and channel, then corresponding bit representation and the excess of stroke/underload condition are latched in the channel error register 516.Then, inform any mistake in the primary processor task dispatcher.
The third level at streamline, the front end channel is hung up the output of register 510 and the output of EO register 526, HE register 518, HO register 520, DE register 522 and DO register 524, and priority register 534 (its storage current right of priority) is used for determining which channel enables, and sorts by decision tree 528.
This right of priority tree is based on an and then circulation of circulation, distribute the channel that enables with highest priority (if (EP[i] | EO[i]) ﹠amp; (HE[i] | HO[i]) ﹠amp; (DE[i] | DO[i]) be set as 1, be used for this specific channel, then channel " i " allows).
In that a plurality of permission channels with equal priority are arranged is under the qualified situation, and will selecting first, detected (detection starts from channel 31, and carries out downwards; If just channel 13 and channel 24 all are qualified, selective channel 24).
" tree construction " allow to on-the-fly modify (EP[i] | EO[i]) ﹠amp; (HE[i] | HO[i]) ﹠amp; (DE[i] | DO[i], also allow to on-the-fly modify right of priority.
Travel-time is a clock hanging up register 510 to FIFO from channel.
Be the concise and to the point general introduction of step of the task dispatcher of Fig. 5 below, referring to the part of the mark among Fig. 5 corresponding to execution in step among the figure.
In step 1, digital mux 502 scan event input.All inputs all be edge sensitive and be latched up to being scanned.They are automatically removed after scanning.In step 2, when the corresponding position mapping in incident and channel enable register 508 produce positive as a result the time, " settings " channel hang up in the register 510.In step 3, channel is hung up register 510 (EP) and is lumped together the decision tree 528 of feeding together with its priority groups with position from EO, DE, DO, HE and HO register continuously.In step 4, the value risc processor nuclear in the highest hang-up priority register 530 (HPPR) provides the highest priority of current hang-up service.In step 5, channel error register 516 is caught when channel and is in the opportunity of hanging up and detect another incident subsequently on this channel.In step 6, when serving this channel, IPCM nuclear is removed the single position in channel hang-up register 510.In case remove, when detecting another incident, can advocate this channel again.
When carrying out an execution command (done instruction), procedure control unit will jump to content and switch subroutine (B-that sees attached list is used for the ROM script example of the risc processor nuclear of IPCM), and current content is poured out storer.After current content has been poured out storer, take place when carrying out the test hang-up and switching (TstPendingAndSwitch) instruction " actual content switching ", here CRR (current channel register) (not shown among Fig. 5, the risc processor that still is positioned at IPCM is examined) becomes PPCR 532 (the highest hang-up channel register).
Content changeover program (B sees attached list) can be divided into 6 parts: (1) loads the spin base address of current content; (2) the current content of register is poured out storer; (3) test is hung up channel and is done suitably reaction (TstpendingALnd Switch); (4) load the base address of new content; (5) download new content; (6) copy shadow register.
When carrying out the TstPPendingAndSwitch instruction, if no longer include HPPR 530 (the highest hang-up priority register) for empty, owing to revise (HE[i] | HO[i]) ﹠amp; (EP[i] | EO[i] ﹠amp; DE[i] | DO[i] or revise right of priority), (IDLE) pattern that RISC nuclear will enter the free time, otherwise will carry out the second half parts that content is switched script, and will download the content of the channel of selection.
Under the situation that enters the IDLE pattern (just finish content poured out storer after, HPCR/HPPR is under the situation of sky), when a new incident, we will continue the script of the second half parts, and the content of the download channel relevant with new incident.
In case select, state of current channel register (CCR) and current channel right of priority (CPRi) just can not change, even relevant (HE[i] | HO[i]) ﹠amp; (EP[i] | EO[i] ﹠amp; DE[i] | DO[i] conditional transfer to zero or associated right of priority oneself on-the-fly modified by main frame.
Pouring out the parton program, and HPCR/HPPR under the situation after empty, withdraws from (yield) and (dene_000) will handle in a different manner.In particular cases this, we will continue script and download back the content of just pouring out storer.
Several functional units of IPCM116 are described below.
In one embodiment, customization IPCM comprises cyclic redundancy check (CRC) code (CRC) the unit (not shown) that links to each other with risc processor.It can carry out the CRC calculating of the degree of depth from 8 to 32 for one group of polynomial expression that provides.The CRC unit comprises two 32 bit registers: be used to choose polynomial CRC algorithm CA and the each CRC check and CS of cumulative data afterwards of handling.
All be loaded with after selecting polynomial expression and initialization calculating at two registers, a byte just can have been handled in each loop cycle in the CRC unit.
DSP DMA unit 310 receives instruction from risc processor nuclear 302.It can be by DMA visit to DSP memory write or read data and allow to carry out 32 and 1 transmission to quartzy DMA therefrom.
DSP DMA unit 310 receives instruction from risc processor nuclear 302.It can by DMA visit from/to DSP memory read or write data, and allow to carry out 32 and 16 transmission to quartzy DMA.
DSP DMA unit 310 employed main registers have two kinds: comprise to the address register (DA) of quartzy memory read or write data address and comprise the data register (DD) of data itself.
Because looking ahead and quick ability of it, DSP DMA310 can conduct interviews and not make the stall of risc processor nuclear quartzy storer, can carry out other instruction when DSP DMA310 reads or writes in hang-up when order is finished like this.
Main DMA unit 312 receives instruction from RSIC processor core 302 (being also referred to as IPCM nuclear).It can through DMA visit from/to embedded DRAM 108 or external memory storage 244 read and write data, and it allows 32,16 and 8 transmission.External memory storage 244 visits are finished by MCORE local bus (MLB) switching.
Main DMA312 uses two kinds of main registers: address register (MA) comprises data address to read or write quartzy storer, and data register (MD) comprises data itself.
Because looking ahead and quick ability of it, main DMA 310 can conduct interviews and not make risc processor examine 302 stall (stall) primary processor (for example MCORE) storer (just eDRAM 108), so as to make its main DMA 310 hang up to finish read or write order the time can carry out other instruction.Notice that MCORE is main frame or the call processing device that oneself knows.
The IPCM bus is switched the EIM module accesses external memory storage that allows by the MCORE that is attached to the MCORE local bus.It also allows miscellaneous equipment (such as MCORE test module, NEXUS module or GEM module) control MLB.
And, two power mode: RUN of IPCM 116 inner managements and IDLE.Under the RUN pattern, all modules of IPCM 116 receive the IPCM clock of 100MHz.When channel activated, IPCM 116 was in the RUN pattern.
Under the IDLE pattern, served all channels, and do not had channel to be in hang-up; This is the pattern after resetting.The great majority of IPCM module: RICS processor core, functional unit and bus arbitration logic no longer receive the 100MHz clock.Task dispatcher 304 works on when it receives the sample value incoming event, and when decision begins to receive new channel at this.The main control module 316 of the control register of maintenance IPCM 116 and the clock that DSP control module 314 still receives 100MHz are because they can be by primary processor 106 or DSP 102 visits when IPCM is in the IDLE pattern.The IDLE pattern has been saved power, and this is important for the environment that operates with batteries.
For primary processor, also may stop IPCM 116 fully by clock controller.In the case, do not have clock to be received by IPCM 116, IPCM 116 may not restart its clock at all.Primary processor can recover the IPCM clock.When the data transmission that do not require by IPCM116, this functional mode is useful.
After resetting (from reseting module receive or by the software reset of primary processor requirement), IPCM 116 is in the IDLE pattern; In case have channel to activate, it will begin to be positioned at the guidance code at 0 place, address.Can activate channel afterwards in the channels bits of programming positive right of priority and be arranged in the EVTPEND register by primary processor.
Importantly be noted that when IPCM 116 is in the IDLE pattern, can not carry out the OnCE debugging that needs to carry out the instruction on nuclear; Must wake IPCM up by activating channel in advance.A kind of may be to carry out the debugging request by OnCE, activates channel arbitrarily then, and this channel will start the IPCM clock, and described nuclear will need not any instruction and enter debugging mode immediately.Detailed explanation illustrates chapters and sections referring to OnCE.Another kind may be to use the JTAG module to cut off IPCM clock gating, and this makes it possible to make an immediate response, and does not require the channel with activation; Under this pattern, no matter the IPCM pattern how, always clock moves.
Introduce the software interface of the DMA data channel able to programme be used for operating IPCM 116 below.
Next referring to Fig. 6, be positioned at the pointer and the storage buffer of IPCM and main processing memory shown in the figure, it is used to each channel in the direct memory visit data channel.IPCM shown in the figure comprises table 602, and table 602 comprises that pointer register 604, channel enable register 606, DSP surmount register 608 and incident surmounts register 610.Also show the RAM of system 601 among the figure, it comprises table 612, and table 612 comprises channel index 613.System RAM601 also comprises table 614, and table 614 also comprises buffer pointer 616, count area 619 and pattern field 620.System RAM also comprises impact damper 618.
This part introduction is used for the buffer management scheme between IPCM 116 and primary processor 106 (being also referred to as main MCU) or the DSP 102.IPCM depends on the one or more impact dampers with the minimum that is used to activate each channel.These channel buffer must lay respectively among the system RAM 601 (for example, eDRAM 108) of MCU and DSP (for example, DSP RAM 104).Introduce and manage impact damper by using the virtual controlling register of realizing as the list of link in system RAM 601 zones that are arranged in MCU and DSP.Introduce the control structure that is used for main MCU port below.
Table 602 is one group of hardware register that are positioned at IPCM 116.Pointer register 604 is can be by 32 read/write register of main nuclear visit, and it comprises the pointer of sensing 612, and it has the structure of pointer 613. Pointer 613 and 604 can be quoted any memory location that is positioned at the RAM of system 601.
Should notifying program person, when table 612 and table 614 are positioned at main system 601 (for example, the eDRAM 108 under the situation of smart phone), realize best performance.
Table 612 is the fixed sturctures with 32 inlets.Each inlet is represented in 32 IPCM DMA data channels, and comprises one 32 bit pointer.Pointer in the IPCM116 use table 602 finds table 612.When even if 32 channels of all DE all do not use, also must provide whole (the entirety even) of table 612.The channel that IPCM 116 can not be used for pointer inlet not to be allowed to (for example, be arranged in the channel enable register 606 position).
Wish to keep " static " during pointer (one or several) value in table 602 and 612 is for the IPCM operating sessions.
Table 614 comprises operational order and status register, buffer sizes designator (for example, count area 619) and to the pointer 616 of physical buffers 618 itself.Special-purpose table 614 must be provided for each in 32 channels, and realizes with the list of link structure.This technology allows one or more impact dampers 618 are assigned to single dma channel, thereby allows various implementations, such as impact damper exchange and daisy chaining.
In operation, IPCM 116 will read out in the command register element of first impact damper of describing in the tabulation, and increase impact damper 618, be filled capacity or will be closed by some incidents up to it.IPCM 116 will turn back to list of link, and if stated next impact damper, just open it.When IPCM 116 arrived tabulate terminal, all impact dampers 618 had been filled or have cut out, and will close the specific I PCM channel of barren (arid) that quoted by table 614.By upgrade the content of the table 614 be used for each channel by MCU, claim that then the channel enable register 606 suitable channel enable bit that are arranged in IPCM can reset this channel.
The pattern that use provides has various operational circumstances.Alternatively, the daisy chain that impact damper 618 exchanges, or in template pattern, operate.By the suitable control bit of configuration in mode register, when being full of or close specific impact damper, can produce interruption to main MCU or DSP.
Pattern field 620 within the structure of table 614 comprises the control bit that is used as marker and is called " D " position.When buffer zone is set is when being had by IPCM, and counting, pointer, state and control field must not be changed by MCU.Work as D=0, MCU has specific impact damper, and IPCM can not attempt to write any control field or buffer space.
Note, be similar to the channel interface of main MCU to the channel interface of quartzy DSP.
The primary processor programming model
Primary processor 106 (abbreviating main frame as) is by means of several interface register control IPCM116.Except requiring suspended state 1 and channel RAM (CHANNEL RAM), a command register (ONCE_CMD) also requires the suspended state 1.The all available waiting statuss 0 of these registers (wait-state) visit on the ip bus interface, and they all provide clock signal (this means that when main frame is wanted to visit any register it must guarantee that the IPCM clock moves) by the IPCM clock.
About the read and write size that allows: no matter the size (byte number of just ignoring permission) that any read operation will be read 32 of input register contents on bus all; Any write operation size is as requested upgraded the content (just the byte number of Yun Xuing is used to allow corresponding byte is write register from bus) of register, except when when writing CHANNEL RAM, CHANNEL RAM always is written to the word of the actual size on the bus (32) among the RAM large or small.
Be the register that is used to control the primary processor of IPCM 116 according to an embodiment of the invention below.
C0PTR (channel 0 pointer).This register is included in 32 bit address of the channel controll block array that starts from channel 0 (control channel) in the primary processor.Main frame has read, and IPCM has read-only access.When resetting, this register all is 0.Before this register allows channel (for example, channel 0), should be by main frame to its initialization.
The INTR-channel interruption.This register comprises 32 HI[i] position.If be provided with any one, will cause an interruption to main frame.This register be one to the main frame register of " once writing (write-ones) ".When main frame is provided with one in this register, remove corresponding HI[i] position.When separately interruption of service, interrupt service routine will be removed channels bits separately, and the words that not have to remove will cause the continuation interruption.Finish when execution command accordingly when having moved, IPCM is responsible for being provided with the HI[i corresponding to current channel] position.
The STOP/SRAT-channel stops/channel status.This register of 32 has one that is used for each channel.This register be one to the main frame register of " once writing (write-ones) ".When main frame writes the position i of this register with I, remove HE[i] and START[i] position.Read this register and produce HE[i] current state of position.
The SRART-channel begins.This register has one that is used for each channel.This register be one to the main frame register of " once writing (write-ones) ".When removing corresponding HE[i] during the position, also START[i can not be set].When main frame is attempted by writing 1 START[i to be set] when position, if corresponding HE[i] removes, at SRATR[i] position in the register will keep removing, and HE[i is set].If be provided with corresponding HE[i] position, SRART[i will be set] position.The IPCM channel is attempted to remove HE[i by means of (done) instruction of carrying out next time] during the position, at START[i] position in the register will be eliminated, and HE[i] will obtain START[i] old value.Read this register and produced START[i] position current state.This mechanism allows each channel of main frame to carry two START orders.
The EVTOVR-channel event surmounts.This register comprises 32 EO[i] position.One that is provided with in this register causes IPCM to ignore incident when the corresponding channel of scheduling.Writing in this register rewrites previous value.
DSPOVR-channel DSP surmounts.This register comprises 32 DO[i] position.Be provided with in this register one causes IPCM to ignore DSP when the corresponding channel of scheduling enabling.
HOSTOVR-channel main frame surmounts.This register comprises 32 HO[i] position.Be provided with in this register one causes IPCM to ignore main frame when the corresponding channel of scheduling enabling.
The EVTPEND-channel event is hung up.This register comprises 32 EP[i] position.Reading this register allows main frame to determine which channel has the incident of hang-up.One that is provided with in this register causes the scheduling of IPCM reevaluating, and the peripheral hardware incident (this is " once a writing " mechanism: write " 0 " and can not remove corresponding position) of this channel has taken place to be assigned to seemingly.This is useful for starting channel, makes to carry out initialization before first incident of hang-up.Task dispatcher also can be arranged on the position in the EVTPEND register according to the incident of reception.When operation channel I script, can remove EP[i by execution command] position.
DSPENMBL-channel DSP enables.This register comprises 32 DE[i] position (from DSP control module or control register).This register makes main frame can determine which channel DSP has allowed.
The RESET-reseting register.This register comprises two control bits: (1) position (RESET[0]) that resets when being set up, causes that IPCM is held in the software reset.Discharging before this resets, it must be kept several cycles.In fact, use a counter that this software reset (soft_rstB is low) is remained valid in these circulations.When the position that resets is set up, drives the soft_rstB signal and make it low.Remove the position that resets by IPCM.(2) resched position (REST[i]) when being set up, forces IPCM to reschedule.Script has moved an execution command seemingly.This allows main frame by removing its HE[i through stopping register] position is from the script recovery out of control on channel, and then, the RESCHED position of process RESET register is forced and is rescheduled.When the beginning content exchange, remove the resched position by IPCM.
EVTERR-incident error register.When the incident that inserts is detected and it triggers to be in and hangs up or during serviced channel, use this register to heat main frame by IPCM.This points out that probably for this channel data having taken place overflows.This is one and is used for scheduler and " once writes " register; It only can be provided with sign; When the main frame read register or at the IPCM reseting period, remove this sign.
When receiving the incident that has triggered channel i, and be provided with EP[i by the incident input pin] during the position, EVTERR[i arbitrarily is set] position; If main frame attempts to be provided with EP[i], and EP[i] position be set up, do not influence EVTERR[i].
This register is different from DSP EVTERR: when main frame was read and removed it, identical information was still available in the DSP register.
INTRMASK-channel interruption Shield Flag.This register comprises that 32 interrupt producing mask bit.Whenever if an INTMASK[i is set], HI[i] position is set up, and, when the incident mistake is detected on channel i (just, EVTERR[i] be set up), interruption is sent to main frame.
PSW-scheduler state.This is 16 bit registers with following status information: [4:0] register (current channel register); [7:5] CCP (current channel right of priority); [12:8] NCR (next channel register); [15:13] NCP (next channel right of priority).
The incident error register that EVTERRDBG-is used to debug.This register is identical with EVTERR, does not change its content (just, not knowing it) when reading; This address is used in the debugging mode: MCU OnCE can check this register value and not revise it.
ONCE_ENB-OnCE enables.This bit register is selected the OnCE Controlling Source; When being eliminated (0), JTAG controls OnCE; When being set up (1), main frame is controlled OnCE by the register of introducing below.After resetting, remove OnCE enable bit (JTAG control).
ONCE_CMD-OnCE command register (1 suspended state).Writing this register will cause OnCE to carry out write order; When needs, before this register write command, ONCE_DATA and ONCE_INSTR register should be loaded correct value.
CSWADDR-content exchange address.One 15 bit register, its content interchange address (position 13-0) and enable bit (14); When described enable bit is set, suppose that the content exchange program starts from comprising the address among the 13-0 on the throne.For described enable bit, the reset values of this register is 0, for the content exchange address, is the decimal system 32.
ILLINSTADDR-disable instruction trap address.The position 13-0 of this register comprises the address that IPCM jumps to when carrying out disable instruction; When resetting, it is 0x0001.
CHN0ADDR-channel 0 address.Use this 13 bit register by preamble code or IPCM: after resetting, it points to the standard boot (channel 0 program) in ROM; By changing this address, the user has the ability to carry out boot sequence with his program.First instruction of preamble code is obtained the content (it also is mapped to the space of IPCM storer) of this register and is jumped to given address.Reset values is 0x0050 (decimal system is 80).
The CHNENBL-channel enables RAM.The main control module comprises 32 channels of 32 x and enables RAM.This channel enables RAM and comprises incident/channel correspondence mappings.According to the content of RAM, any one occurrence can trigger any of channel and may make up.
CHNPRI-channel priority register.32 registers of this group comprise the right of priority of each channel; Priority number is between 1 to 7.0 is a retention, and when made to be used for detecting by IPCM hardware does not have channel to hang up.
The dsp program module
Than primary processor 106 (main frame just), DSP 102 controls IPCM 116 and is subjected to some restrictions through connecing an interface register.Each register takies two 16 words to adapt to all 32 channels.All registers are worked in the same manner, as the homologue (counterpart) of primary processor.In dsp interface, do not realize CEVTOVR and CDSPOVR register.
All addresses such as COPTR all are made up of 32 words, and these 32 words can addressing be positioned at any position of quartzy storage space (4G byte).
All registers and IPCM clock synchronization (this means that when DSP visits these registers main frame must be guaranteed the operation of IPCM clock).
The size that allows about read and write: any read operation is put into 32 contents of register on the bus, no matter and the size of data of reading (just, do not consider allow byte); Any write operation size of data is as requested upgraded the content (just, using the byte that allows that corresponding byte is write register from bus) of register.
Be the register that is used to control the DSP of IPCM 116 according to an embodiment of the invention below.
C0PRT-channel 0 pointer.This register comprises 32 bit address of the array of channel controll block in the DSP storer, described channel controll block begins with the CCB that is used for channel 0 (control channel).DSP has read, and IPCM has read-only access.When resetting, this register will be 0 entirely.Before allowing any channel, should be by this register of DSP initialization.
The INTR-channel interruption.This register comprises 32 DI[i] position.If be provided with any position, will cause main frame that an interruption takes place.This register " is once write " register to main frame.When main frame is arranged on when position in this register, remove corresponding D I[i] position.When having served interrupt service routine, they should remove channels bits separately.Do not do like this, will cause interrupting continuing to take place.When the corresponding execution command of operation, IPCM is responsible for being provided with the DI[i corresponding to current channel] position.
The STOP/STAT-channel stops/channel status.This 32 bit register has one that is used for each channel.This register " is once write " register to DSP.When DSP writes the position I of this register with 1, remove corresponding D E[i] and START[i] position.Read this register and will produce DE[i] position current state.
The START-channel begins.This 32 bit register has one that is used for each channel.This register " is once write " register to DSP.When removing corresponding D E[i] during the position, START[i can not be set] position.When DSP attempts by writing 1 START[i to be set] when position, if corresponding D E[i] position empties, then at START[i] position in the register will keep removing, and DE[i is set].If be provided with corresponding D E[i] position, START[i will be set] position.Attempt to remove DE[i at IPCM channel I next time by means of executing instruction] during the position, will remove at START[i] position in the register, and DE[i] position will replace START[i] old value.Read this register and will produce START[i] position current state.This mechanism allows each channel of DSP to carry two START orders.
EVTERR-incident error register.When detecting access events, use this register to heat DSP by IPCM, and this register triggering has been hung up or serviced channel.This may mean that this channel data has taken place overflowed.This is " the once writing " register that is used for scheduler.It only can be provided with sign; When reading this register by DSP or at the IPCM reseting period, these signs are eliminated.
When receiving the incident that triggers channel I by the incident input pin and being provided with EP[i] during the position, any EVTERR[i is set] position; If main frame attempts to be provided with EP[i] position, and EP[i] position be set up, then do not influence EVTERR[i] position.
This register is different from main frame EVTERR.When DSP carried out read operation and removes it, information identical in master register was still available.
INTRMASK-channel interruption Shield Flag.This register comprises that 32 interrupt taking place mask bit.If be provided with an INTRMASK[i], DE[i then is set] position, and no matter when on channel I, detect incident mistake (just, EVTERR[i is set]), interruption is sent to DSP.
PSW-scheduler state.This is 16 bit registers that have following status information: [4:0] CCR (current channel register); [7:5] CCR (current channel right of priority); [12:8] NCR (next channel register); [15:13] NCP (next channel right of priority).
The incident error register that EVTERRDBG-is used to debug.This register is identical with EVTERR, does not change its content (just, not removing it) when carrying out read operation; This address is used to debugging mode.DSP OnCE can check this register and not revise it.
The IPCM programming model
Each DMA data channel able to programme has 8 32 general bit registers that used by script.General-purpose register 0 has the special function that is used for the loop instruction, but can be used for other purpose.
The functional unit state.Each channel content has some states as the part of functional unit.The specific distribution of this state is the part of this functional unit definition.This state must be preserved in content exchange/recover.
Program count register (PC).This PC is 14.Because instruction is 16 bit widths, and all storeies in IPCM are 32 bit widths, the lowest order of PC selects to comprise half of 32 words of present instruction.Have that 0 lowest order selects this word the highest effectively half is (just, Big-Endian).
Sign.Each channel has 4 signs: T reflects the position state of some computings and test instruction.When the result of addition or subtraction is 0 this sign is set, other situation is then removed it.It also is duplicating the test position.At last, when counter of the loop (Greg0) is 0, also this sign can be set; When the final injunction of hardware loop is in the time of can revising the operation of T sign, not consider the influence to T, and replaced by the Greg0 state.
Two position SF and the DR error condition that is used to point out respectively to come from the loading data source and stores the destination in addition.Access errors will be provided with these positions, and successful affairs are then removed them.Also can remove these two by specific instruction (CLRF and LOOP).Upgrade SF (source mistake) by loading LD and LDF; Upgrade DF (destination mistake) by storage ST and STF.
Cause access errors by several conditions: write ROM, write read-only mapping and fall the storer of register.When peripheral hardware conducted interviews, it received the non-mapping address of access technique (accessingart unmapped address) or any error of transmission.
SF and DF sign produces main influence to the performance of hardware loop: if SF or DF are set up when the beginning hardware loop, and SF or DF shield by the loop instruction, can not carry out this loop body; Now, in loop body inside, if load or storage are provided with corresponding SF or DF sign, then circulation is withdrawed from immediately.Test at the state (also measuring SF and DF) of the T of the end of loop sign whether point out because withdrawing from of any expection prevents that thus Greg0 from arriving 0 value and being provided with the T sign and causing circulating and withdraw from singularly.If mistake occurs in last instruction place of round-robin, this also is effective.
Last sign is circulation pattern sign LM, and it points out when processor is operated in circulation pattern.This sign is by the recursion instruction setting, and is eliminated after the last instruction of round-robin on carrying out.
Return information counter (RPC).RPC is 4.By jumping to subroutine instruction setting, and by returning use from subroutine instruction.Provide instruction come to/from its content of general-purpose register transmission.
Loop pattern start program counter (SPC).SPC is 14.By the loop instruction it is set to the position of closelying follow thereafter.
Loop pattern termination routine counter (EPC).EPC is 14.By the loop instruction it is set to the position of the next instruction after circulation.
Content exchange.Each channel has the content of the isolation of being made up of the additional content of the state of 8 general-purpose registers and the described functional unit of representative.The register and the functional unit that activate comprise the content that activates channel.The content stores that does not activate channel is in the IPCM RAM as part or IPCM address space.Content exchange stores the content area of old channel the storer of activation into, and loads new content from the content area of new channel.This just in time requires 47 IPCM to circulate to finish.
May define the content exchange program of a customization.As possible, the user must be stored among the RAM, and must its address be write in the CSWADDR control register through MCORE.Use this option, can not obtain (just as the similar cycle count of embedded program, 47 circulations), because 2 circulations of all loadings and memory requirement are finished rather than are required 1 circulation in the ROM program (load is carried out in 1 circulation, next instruction is obtained in another circulation: RAM is all used in two visits, this means that they can not be carried out concurrently).
Memory map registers.IPCM can visit several registers by system bus.
Main channel 0 pointer (MC0PTR).In the MCU storage space, it comprises the address of initial IPCM content and script, loads described initial IPCM content and script by the IPCM boot script that operates on the channel 0.This is a read-only register.
DSP channel 0 pointer (DC0PTR).In the DSP storage space, it comprises the address of initial IPCM content and script, loads described initial IPCM content and script by the IPCM boot script that operates on the channel 0.This is a read-only register.
Current channel register (CCR).It comprises 5 right of priority of the channel that channel content is installed.This is a read-only register.
Current channel right of priority (CCPR).It comprises 3 right of priority of the channel that content has been installed.This is a read-only register.
The highest hang-up channel register (HPCR).Comprise 32 bit channels of having encoded number of channel, described channel is selected to move by task dispatcher next time.In the position of selecting or channel be made as " 1 " (class as, if HPCR comprises value 0x04000000, channel 26 is the next channels of device selection of being scheduled) with one.This is a read-only register.
The highest hang-up right of priority (HDPR).It comprises 3 right of priority of channel, and described channel is selected to move by task dispatcher next time.This is a read-only register.
Current channel index (CCPTR).It comprises the start address of the content-data that is used for current channel: its value is CONTEXT_BASE+20*CCR (CONTEXT_BASE=0x0800); This is a read-only register.
CHN0ADDR。It comprises the address by channel 0 program of MCORE programming; Beginning each time to guide and IPCM when jumping to the address that it comprises, it is loaded into general-purpose register.Under the default situation, it points to the standard boot among the ROM.
Address space.IPCM has and connects an internal bus: be used for the instruction bus of from storer sense order; With with the data bus that visits the storer identical with visual storer on instruction bus, add some memory map registers (scheduler state and OnCE register) and 5 peripheral hardware registers (USB, UART1, UART3, MMC and video SAP).
The instruction core image.It is based on 14 bit address buses and 16 bit data (instruction) bus; From program ROM or program RAM, obtain instruction.The IPCM script can reprogramming RAM content, described program RAM also can see from data bus.
Top two locations of instruction (at 0 and 1 place) are special.Position 0 is that the PC part is set when resetting.Position 1 is that the PC part is set when carrying out disable instruction.Wish that these two positions all comprise a jmp with handling procedure.
The datarams map.Addressable all data of IPCM script occupy (make tip) data memory space or IPCM.This address space has several sections: ROM, RAM, peripheral hardware register and schedule register (CCR, HPCR and CCPTR) and OnCE register.The IPCM script can read and write content RAM, data RAM and peripheral hardware register.
Address realm is 16, and data width is 32; Yet as visit peripheral hardware register (USB, or the like), data width can be different; In the case, peripheral hardware is ignored the not use part of 32 bit data that will write; In read operation, the lost part in the 32 place readings certificate is replaced by " 0 ".
The IPCM initialization
After hardware reset, IPCM 116, program RAM, content RAM and data RAM have uncertain content.Effectively the register setting is assigned to channel 0, and PC is initialized to complete 0.Yet, because the channel enable register is 0 all, do not have effective channel, and end IPCM.
In order to start IPCM, primary processor 106 (being main frame) at first is being used for the several channel controll blocks of control channel (channel 0) establishment, then channel 0 pointer register is initialized as the address of first controll block.Be arranged on position 0 (corresponding to the channel 0) in the channel enable register then.
When permitted, IPCM 116 begin to carry out at the script program ROM that is used for channel 0, that be positioned at 0 place, address.These ROM 308 scripts are with read channel 0 pointer register, and use address with which begins to obtain (using DMA) first channel controll block.If this piece comprises effective order, it is explained this order (it is normally used for downloading some data track IPCM storeies from main frame) and continues and carries out this order and move to next controll block.This will continue, and up to arriving an invalid channel command, will end script when arriving invalid command, wait main frame to allow this channel once more.
Also there are two kinds of methods that IPCM is guided on user-defined script.At first, by the next any code that is loaded in down among the IPCM RAM of use OnCE (the Jtag interface of its MCORE interface of process), and force IPCM to guide this code; Secondly, by using the CHN0ADDR register in the main programming model, the IPCM guidance code obtains the content of this register and jumps to given address.
The instruction of forming script and the data content of working are depended in the execution of IPCM script thereon.Before allowing to carry out script, the two all must initialization.In 32 channels each has the data content of an isolation, but can be shared in script and position in the data RAM.
Space in Host Administration program RAM and the data RAM.It is the distribution of managing I PCM channel also, and these channels are assigned to the device driver that requires them.Use channel 0 to download the script of any requirement and data value and channel initialization content by main frame and come Initial Channel Assignment.Described content comprises all initialization values of register, comprises PC.Then, main frame 106 activates this channel, and this channel programming is effective, begins to obtain from its script and execute instruction.
Referring to the annex A of exercise question for " instruction set that is used for the risc processor of IPCM ", it has introduced preferred instruction complete set according to an embodiment of the invention, as to be used for IPCM 116.
Below further introduce DSP DMA unit and primary processor DMA unit corresponding to the embodiment of the instruction set that adopts subordinate list A functional unit.
This functional unit instruction causes 8 codes (can find in the least-significant byte of instruction) to appear on (asserted) functional unit control bus.Use in these some to select in several functional units one.In order to set up the programmed agreement, suppose that the position of selecting is some positions in 8 highest significant positions in the code.And, set up the action type that will carry out by some of given functional unit decoding least significant bit (LSB).
For main DMA unit 312, DMA instruction control dma state machine, and can cause that a DMA on relevant memory bus circulates.There are three registers relevant: address register (MA), data buffer (MD) and state machine register (MS) with main DMA unit.
Address register (MA) comprises the pointer that points to the dma memory relevant with next data transmission.It has the byte interval size.Read this register (read operation just) with the 1df instruction and do not have negative effect.Writing address register has negative effect.If a write data value is arranged in impact damper, and address modification, this write data will be refreshed (that is, send a DMA and write circulation).If be provided with the position of looking ahead, and do not have effective write data, send DMA with new address and read circulation.
When data are transferred to data buffer or when data buffer transfers out, the number that byte number/address that address register is increased transmission increases by 32 word boundarys will refresh any effective write data in impact damper.
In data buffer (MD), the DMA circulation is always not relevant with the stf instruction that loads write buffer, this instruction can just be loaded into buffer register with the subelement that transmits, the byte because buffer register adds up, and this byte is used in the memory transfer of actual size afterwards.The DMA unit keeps the effective state of byte, and correctly is shifted and inserts letter data.The instruction that loads write buffer can cause refreshing results buffer conditionally, causes that a DMA writes circulation, even without filling up this impact damper fully.
If also do not take data away, the 1df of read data instruction can causing DMA circulation.If all bytes in impact damper are transmitted, each is read transmission and can cause conditionally and look ahead.
The read and write of data buffer can cause purpose or source mistake respectively.Because MLB does not support 24 visits, when request 3 byte-accessed on MLB, main DMA triggers mistake.When request refreshes or obtain, do not have that this thing happens; Short of external reference will be carried out, and inner MD register can at any time have the data of 3 bytes.EDRAM supports the visit of 3 bytes.
A kind of special circumstances that refresh are arranged: use byte-accessed MD, may obtain 3 effective bytes, and request refreshes; 3 effective bytes in MD will correctly be write eDRAM; But if carry out write operation on MLB, this visit will cause mistake.
Status register (MS) comprises dma state-machine value.Do not wish that the user visits it under normal mode.In fact, owing to when DMA is in any state content exchange can take place, need to preserve this state, this preservation is finished by the content exchange program.
Look ahead and refresh management and allow when carrying out the DMA visit, to continue IPCM RISC mechanism.When the requirement of RISC nuclear is looked ahead (p=1) to main DMA or refreshed (f=0) automatically, before DMA finishes external reference, RISC nuclear will receive an acknowledge immediately; This allows RISC nuclear to carry out other thing of other DMA mechanism of similar visit.
Yet the user must be noted that the inherent limitations that this is machine-processed: as long as DMA does not have the FIFO stack to come memory command, look ahead/automatic refresh command if sent, and DMA does not finish its a last visit, will postpone acknowledge, goes in preceding visit up to described.
Mismanage on the other hand: when DMA sends an acknowledgement to RISC nuclear immediately, suppose there is not wrong generation (if being under an embargo) except detecting the visit that resembles 24 visits of MLB.If mistake has taken place, will make a mark (error of transmission affirmation) is to be used for the DMA visit of back.
If used DMA rightly, then this does not become problem.Look ahead/refresh feature automatically to be used in the hardware loop, and should not carry out last visit or compulsory the refreshing (f=1) of look ahead (p=0) after hardware loop: this visit will be collected any remaining mistake (mistake itself and from the previous mistake of looking ahead or refreshing visit automatically).
Be same as main DMA unit 312 on DSP DMA unit 310 functions, but some small restrictions are arranged.It allows quartzy DMA to carry out 32 and 16 transmission.
DMA instruction control dma state machine, and can on relevant memory bus, cause the DMA circulation.Have three with the relevant register in main DMA unit: address register (DA), data buffer (DD) and state machine register (DS).
Address register (DA) comprises the pointer that points to the dma memory relevant with next data transmission.It has the byte interval size.Read this register with the 1df instruction and do not have negative effect.Writing address register has negative effect.If a write data value is arranged in impact damper, and address modification, this write data will be refreshed (that is, send a DMA and write circulation).If be provided with the position of looking ahead, and do not have effective write data, send DMA with new address and read circulation.
When data are transferred to data buffer or when data buffer transfers out, the number that byte number/address that address register is increased transmission increases by 32 word boundarys will refresh any effective write data in impact damper.
In data buffer (DD), the DMA circulation is always not relevant with the DMA instruction that loads write buffer, this instruction can just be loaded into buffer register with the subelement that transmits, the byte because buffer register adds up, and this byte is used in the memory transfer of actual size afterwards.Dma state keeps the effective state of byte, and correctly is shifted and inserts new data.The instruction that loads write buffer can cause refreshing results buffer conditionally, causes that a DMA writes circulation, even without filling up this impact damper fully.
If also do not take data away, the DMA of read data instruction can causing DMA circulation.If all bytes in impact damper are transmitted, each is read transmission and can cause conditionally and look ahead.
The read and write of data buffer can cause purpose or source mistake respectively.Because quartzy DMA does not support byte-accessed, DSP DMA detects any undelegated access size and therefore triggers mistake.Undelegated size is 1 byte and 3 bytes.When request refreshed or obtain, just this thing happens.Short of external reference will be carried out, and inner DD register can at any time have the data of I-byte or 3-byte.
Status register (DS) comprises 00110000 32 read operations that do not have negative effect.
Look ahead and refresh management and allow when carrying out the DMA visit, to continue IPCM RISC mechanism.When the requirement of RISC nuclear is looked ahead (p=1) to main DMA or refreshed (f=0) automatically, before DMA finishes external reference, RISC nuclear will receive an acknowledge immediately; This allows RISC nuclear to carry out other thing of other DMA mechanism of similar visit.
Yet the user must be noted that the inherent limitations that this is machine-processed: as long as DMA does not have the FIFO stack to come memory command, look ahead/automatic refresh command if sent, and DMA does not finish its a last visit, will postpone acknowledge, goes in preceding visit up to described.
Mismanage on the other hand: when DMA sends an acknowledgement to RISC nuclear immediately, suppose there is not wrong generation (if being under an embargo) except detecting the visit that resembles 24 visits of MLB.If mistake has taken place, will make a mark (error of transmission affirmation) is to be used for the DMA visit of back.
If used DMA rightly, then this does not become problem.Look ahead/refresh feature automatically to be used in the hardware loop, and should not carry out last visit or compulsory the refreshing (f=1) of look ahead (p=0) after hardware loop: this visit will be collected any remaining mistake (mistake itself and from the previous mistake of looking ahead or refreshing visit automatically).
Programming convention
Most procedural models of seeing in main frame or DSP are not the hardware configuration trustships (mandate) by IPCM, but by the script trustship that on IPCM, moves.Some scripts make the agreement that they provide be difficult to change in ROM.
Primary processor one side, 32 channel controll blocks (CCG), the base address of pointing out this array in C0PTR are arranged in an array.Each controll block is made up of 4 32 words.First word comprises current undefined state.Second word comprises the pointer of plot of the array of directed at buffer descriptor (Bd).The 3rd word comprises the pointer that points to current BD.The 4th the current use of word.
Only when channel does not move, can change the content of channel controll block by main frame.
Main buffer descriptor (referring to Fig. 6) forms the array of programmable size, and last buffer descriptor is by such mark.The array of buffer descriptor is taken as a ring (ring), and some continuous in logic parts are had by main frame, and remainder is had by IPCM.Mode bit is pointed out the sovereignty of each buffer descriptor.
When buffer descriptor with sovereignty when main frame changes to IPCM, count area is pointed out the data that what will transmit or the size of reception buffer.When sovereignty were returned to main frame, counting was pointed out transmission or has been received how many data.
Believe 0 order.The command field of buffer descriptor comprises the 8 order of the bit codes that are used for communicating by letter between main frame and the IPCM.At present, believe that 0 script only discerns following order: the IPCM address that (1) will use in order subsequently is made as the value that is included in the buffer address field; (2) copy to the IPCM storer from primary memory at buffer address; (3) from the IPCM memory copy to primary memory at buffer address; (4) copy to the channel content of the channel number high 5 from primary memory; (5) channel content from the channel number high 5 copies to primary memory.
DSP one side, 32 channel controll blocks (CCB) are arranged in an array, point out in C0-TR the base address of described array.There is not to be used for the CCB of channel 0.Each believe controll block by 8 16 words form/first two words comprise current undefined state.Second two word comprises the pointer of the plot of directed at buffer descriptor (Bd).The 3rd two words comprise the pointer that points to current BD.The 4th the current use of two words.
The dynamic memory refresh method
Recall Fig. 2 now briefly, the processor platform that illustrates comprises and is used to refresh the dynamic RAM refresh controller of eDRAM just.Refresh controller 220 is through r bus 240, select 218 to be coupled to eDRAM 108 by data routing, and it carries out multiplexed from the visit to eDRAM such as the competition equipment of IPCM 116, primary processor 106 and lcd controller 204.
Such just as known in the art, requiring provides the DC power supply and periodically it is refreshed the feasible data that keep being stored in the storer to dynamic storage (DRAM or eDRAM).On the contrary, as long as being supplied with static memory, constant power supply (for example, SRAM), do not need to refresh static memory.The refresh controller 220 of an embodiment of designing treatment applicator platform 100 comes conserver power source as much as possible, this extending battery life advantageously for handheld applications.
Refresh controller 220 has two basic operational modes: effective model and keeping data mode.Effective model was called in the normal operating period of eDRAM 108.Whenever the terminal user operates the product that has comprised processor platform 100, then uses this effective model.Effective model uses " circulation encapsulation (cycle stealing) " distributed refresh method of knowing in discrete DRAM realization field.
When the product that has comprised processor platform 100 does not have work and wishes to keep the content of eDRAM108, call keeping data mode.This keeping data mode has three kinds of mode of operations: (1) distributed refresh method, (2) " selection refreshes " method and (3) " temperature compensation " method for refreshing.
The identical point of the distributed refresh method of knowing in this area and the effective model of work is: storer is refreshed periodically, and select to refresh with temperature compensation refreshing can be used alone or can be used together, require to be used to keep the quantity of power of data to reduce in the eDRAM memory array, perhaps can be made together and be used for obtaining further to reduce fully the power that keeps data and consume, this causes battery life longer, and battery life is important especially for handheld applications.
Although effective model and distributed refresh technology are known in the art, although in other practical work example, can use the clock that other are known in this area, advantageously, refresh controller 220 uses the low-frequency clock source, and this clock source comes from the Hitachi's clock module that works in 32kHz.Accordingly, in a preferred embodiment, the clock input 252 to refresh controller 220 is Hitachi's clocks that requirement has been used for comprising the product of processor platform 100.
This 32kHz clock input 252 is doubled (x2) in refresh controller 252, and is used to activate refresh cycle.As known in the art, provide a counter in the refresh controller 220 with " n " individual state, " n " equals the row sum in array here.Counter is to increase progressively mould " n " with each clock saltus step.As known in the art, " sensor amplifier (Sense amplifiers) " carries out the actual of bit location of the selection in each row refreshed.
Advantageously, refresh controller 220 uses existing time-of-day clock to import as clock; Therefore, eliminated the needs that move refresh controller 220 with the special clock that separates, and this is conventional needed.Adopt the special clock that separates to be used for the power that refresh controller 220 has further increased system consumption when outage.
Next referring to Fig. 7, select method for refreshing advantageously to reduce the line number that will refresh in the storer (for example, eDRAM 108), for the storer number that will keep with minimizing is that the band valency reduces power consumption.For example, if storer (for example, DRAM) can be divided into a plurality of parts, one or more in a plurality of parts in the refreshable memory and need not to refresh all parts.Especially, a plurality of parts can be the multirows of the storer in the array.Therefore, the content of the multirow of the storer that preservation is refreshed, and the content that is not refreshed in the row of storer will be lost.For example, (for example, disconnect) when by user's closing device, primary processor 106 determines which row of (for example, eDRAM 108) needs to preserve in storer, and which part (for example, OK) does not need to keep (step 702).Next, primary processor 106 sends to refresh controller 220 with control signal, and notice wishes to preserve which row or the part (step 704) in the main processor memory.Refresh controller 220 is configured to row or the part that only refreshes in the sign between turnoff time, in storer.Then, the row (step 706) of refresh controller 220 visit main processor memorys (for example, selecting 218 visit eDRAM 108) and refresh configuration by data routing.Therefore, the power that consumes in refresh memory is very little, because only there is the part of storer to be refreshed, rather than refreshes whole storer.In this embodiment, this quite saves power consumption, because eDRAM 108 is very big, this power consumption is used to preserve the power consumption of whole eDRAM 108 less than needs usually.
Introduce the selection method for refreshing that refresh controller 220 is carried out below.Supposing has n capable in memory array (for example eDRAM 108), j is defined as the total line number in the memory array that will refresh, and j is between numeral 0 and n like this.Then this algorithm becomes:
i＝0
Refresh Row
i
I=i+1 mould j
In other words, refresh controller 220 moulds " n " counter is reduced to mould " (n-a) " counter, and wherein " a " is abridged line number in refreshing.
Next referring to Fig. 8, flow process 800 shows the step of refresh controller 220 of Fig. 2 of the temperature compensation that execute store refreshes.The temperature compensation of memory refress refreshes the cycle of behavior according to the environment temperature adjustment of product.Normal temperature and below in, this can save considerable power, this battery life for the battery that is increased in handheld device work is very important.
Usually, temperature is high more, requires to refresh given storer more continually (for example, eDRAM).The situation of the method basis " worst case " of prior art designs the refresh rate of refresh unit, and under these situations, the product that has comprised DRAM is under the very high default temperature.Like this, in most of times, storer is actually " cross and refresh ".Yet, in the application of paying attention to very much size and power consumption, in the use such as the processor platform 100 in being used as the multi-media radio handheld device of wishing to make the power consumption minimum, this " cross and refresh " can cause because the power consumption that unnecessary multioperation refresh controller excessively produces.
Therefore, different with the refresh controller of routine, the default temperature of supposing to be used for refresh controller 220 is very low, makes default refresh rate very low (just, the time between refreshing is longer) to cause having saved power usually.Yet, the temperature of this product can be in this low temperature or under, but other the time product environment temperature be higher than this low refresh rate temperature.Unless refresh rate has compensated higher temperature, the data that keep in DRAM will be lost between refresh cycle.Whether the environment temperature of the temperature compensation measurement products that therefore, refreshes needs to increase with definite refresh rate or can not maintain lower refresh cycle with saving power.When the environment temperature height of product, the time between the refresh cycle is reduced.
Particularly, introduce temperature compensation refreshing method below.At first, suppose a digital timer circuit by accurate 1/-100/1000000ths clock timings, and have at least 0.1 second resolution.This timer should use suitable clock signal to come Measuring Time, and through after the time of pre-programmed, sends " incident ".This timer should have one and be set as integer-valued register, and is used to represent the time of wanting measured pre-programmed values to pass.Also suppose the electronic digit temperature circuit, its point out precision be+/ scope of x to 7 degree of " j " degree, and further suppose a translation table, this table by the nonvolatile memory array with " n " individual element (for example, the ROM of pre-programmed) form, each element is included in this integer that is called " counting ".Determined the boundary (that is, element number) of array: n=y-x by following formula, n is the number of array element in the formula, and x and y are the bound temperature range.
The absolute value of " counting " and scope must with the absolute value and the scope fit of " counting " register of in digital clock, supporting.Each " counting " inlet is assigned to occupy an element in the array.With " counting " in linear ascending order arranged array inlet, (that is, x), and the last element in the array corresponding to the temperature of the highest measurement (that is, y) corresponding to minimum measurement temperature to make first element in array.
Obtain distributing to the value of each counting inlet from experimental data, described experimental data is to obtain from the actual sample value of the DRAM memory devices of the reality that will use.As an alternative, can be identified for the value of " counting " by the computer emulation method of transistorized leakage characteristics, described transistorized leakage characteristics is used in the function that changes as environment temperature in the memory array.In both cases, the value of " counting " is represented minimum refresh rate, needs this refresh rate to be positioned at the data integrity of x under the specified temp of the scope of y degree to maintain.Each element in array is represented the change that increases progressively of environment temperature, and environment temperature starts from temperature x, and is increased to temperature y.The necessary minimum refresh rate of data integrity is kept in the content representative of each element.Must given additional error change with the unit-unit that adapts to digital temperature precision " j " and memory operation voltage error and expectation.Hope comes the element of arranged array with the linear mode with respect to temperature, and " counting " value can be represented indicial response.
Begin temperature compensation refreshing method working routine (step 802) by all row in the refreshes memory array.Note, can make refreshing of in step 802, carrying out be less than refreshing by " selection method for refreshing " management of introducing with respect to Fig. 7 in the above all row (part) in the storer of memory array to refreshing of row.Next, use digital thermometer measures ambient temperature (step 804).Then, use a look-up table to convert ambient temperature measurement value to a count value (step 806).Look-up table is represented the various refresh rates at the different temperatures place that determines by emulation and experimental data.If the temperature of measuring exceeds the border of look-up table, then should select first element, or should select last element above under the situation on the highest border " y " above under the situation on minimum border " x ".Count value is applied to digital clock circuit (step 808).In case stopped timer " incident ", just the digital clock circuit stops (step 810), refreshes all row; Therefore, repeating step 802 is to step 810.Ad infinitum repeat all steps, up to power on to product (turned on) (step 812); Therefore, reenter effective refresh mode (step 814).
Therefore, by adopting the temperature compensation refreshing method of memory refress, especially or be lower than working and room temperature environment following time, compare with standard refresh operation (for example, the distributed refresh method), saved power.
Advantageously, can operate " temperature compensation pattern " and " selection refresh mode " simultaneously, keep power to consume the minimum data of possibility.Before product is closed, through sending signal to h bus 232 publicly, by the operational mode of primary processor configuration refresh controller.When primary processor 106 reentered effective status and is energized, refresh controller 220 automatically was returned to the refresh mode (for example, distributed refresh) of " normally " operation.Can carry out seamlessly that data keep and normal running (effective model) between conversion, need not to require any interference from primary processor 106.
###
Next referring to Fig. 9, block scheme shows the selection refresh technique of use Fig. 7 and 8 and the memory updating system 900 of temperature compensation refreshing technology.There is shown time-of-day clock 902, binary counter 904 and 906, comparer 908 and 910, register 912 is refreshed in the part, primary processor 914 (main frame MCU 914), counter register 916, memory array 918, digital measurement of temperature 920, temperature sensor 922 refreshes and enables trigger 924, clear signal 926, signalization 928 refreshes enable signal 930 and refreshed rows and enables 932.
Consistent with the relevant introduction of Fig. 7 and 8, digital temperature sensor 922 measures ambient temperature.As above described with reference to Fig. 8, this measured temperature 920 is sent to memory array 918, and is become count value according to the look-up table conversion that is stored in the memory array.This count value is corresponding to the time measured value between the refresh cycle that is used for various running temperatures.This count value is copied in the counter register 916.Then, compare by the value of the comparer that connects between them this count value and binary counter 906.Binary counter 906 is coupled to time-of-day clock 902, makes it count according to the real time.
When the value in the binary counter 906 equals value in the counter register 916, signalization 928 of comparer 910 output refreshes with setting and enables trigger 924 and activate a refresh cycle, just refresh and enable one of trigger 924 output and refresh enable signal 930 (for example, refresh enable signal 930 and become high level or " 1 ").At this moment, determined after the regular hour amount refresh memory according to temperature.Equally, signalization 928 by defeated get back to binary counter 906 (with its be reset to 0 or another with reference to starting point) and deliver to digital measurement of temperature 920, this digital measurement of temperature is re-loaded to memory array 918 and thinks that next refresh cycle determines next variable time quantum.If it is identical that temperature keeps, the time between the refresh cycle keeps identical.When temperature change, the time between the refresh cycle will change.For example, if temperature reduces, the time between the refresh cycle of then extending, this has advantageously saved power, because refresh cycle does not take place continually.
In addition, primary processor is coupled to the part and refreshes register 912, makes primary processor 914 that a value is loaded into the part and refreshes in the register 912, points out to want which part of updating system storer, for example, which refresh, and does not refresh which row.Then, by the comparer 908 that connects between them value of register 912 is refreshed in the part and the value of binary counter 904 compares.Binary counter 904 also is connected to time-of-day clock 902, but binary counter 904 does not begin counting, and up to signalization 928 of comparer 910 outputs, this signalization also is passed to binary counter 904.Therefore, in case refresh the signalization 928 activation refresh cycle (exported and refreshed enable signal) that enable trigger 924 by entering, then binary counter 904 begins counting.
Refresh value in the register 912 in case the value in the binary counter 904 equals the part, comparer is passed to a clear signal 926 to refresh and enables trigger 924, and the defeated binary counter 904 of getting back to.This clear signal binary counter 904 that resets, and cause to refresh and enable trigger and forbid refreshing enable signal 930 (for example, refresh enable signal 930 step-downs or be " 0 ").This has stopped refresh process effectively, the feasible not entire portion of refresh memory (determining) because primary processor was arranged before outage, and this has advantageously saved power.Notice that in this embodiment, binary counter also to counting corresponding to the number of the refresh bank address in the storer (DRAM), just count by refresh bank address signal 932.
Advantageously, all use memory updating system shown in Figure 9 selection refresh technique and temperature compensation refreshing technology reduce the power consumption during refreshing DRAM jointly.The assembly that uses is known in the art.According to this embodiment, most of assemblies can be the parts of the refresh controller 220 of Fig. 2.For example, in one embodiment, temperature sensor 922, temperature survey 920 and memory array 918 are positioned on the independent chip, and primary processor is positioned on the identical processor platform.Register 912 is refreshed in the part, comparer 908 and 910, binary counter 904 and 906, counter register 916 and refresh and enable the part that trigger 924 all is a refresh controller 220.
Although introduced invention disclosed herein by means of certain embodiments and application, under the situation that does not deviate from the invention scope of setting forth in claims, those of ordinary skills can carry out various modifications and variations.