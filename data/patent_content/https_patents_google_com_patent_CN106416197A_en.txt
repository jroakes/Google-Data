CN106416197A - Method and system for load balancing anycast data traffic - Google Patents
Method and system for load balancing anycast data traffic Download PDFInfo
- Publication number
- CN106416197A CN106416197A CN201580025002.9A CN201580025002A CN106416197A CN 106416197 A CN106416197 A CN 106416197A CN 201580025002 A CN201580025002 A CN 201580025002A CN 106416197 A CN106416197 A CN 106416197A
- Authority
- CN
- China
- Prior art keywords
- equipment
- data structure
- packet
- application example
- received
- Prior art date
- Legal status (The legal status is an assumption and is not a legal conclusion. Google has not performed a legal analysis and makes no representation as to the accuracy of the status listed.)
- Granted
Links
Classifications
-
- H—ELECTRICITY
- H04—ELECTRIC COMMUNICATION TECHNIQUE
- H04L—TRANSMISSION OF DIGITAL INFORMATION, e.g. TELEGRAPHIC COMMUNICATION
- H04L67/00—Network arrangements or protocols for supporting network services or applications
- H04L67/01—Protocols
- H04L67/10—Protocols in which an application is distributed across nodes in the network
- H04L67/1001—Protocols in which an application is distributed across nodes in the network for accessing one among a plurality of replicated servers
-
- H—ELECTRICITY
- H04—ELECTRIC COMMUNICATION TECHNIQUE
- H04L—TRANSMISSION OF DIGITAL INFORMATION, e.g. TELEGRAPHIC COMMUNICATION
- H04L67/00—Network arrangements or protocols for supporting network services or applications
- H04L67/01—Protocols
- H04L67/10—Protocols in which an application is distributed across nodes in the network
- H04L67/1001—Protocols in which an application is distributed across nodes in the network for accessing one among a plurality of replicated servers
- H04L67/1004—Server selection for load balancing
- H04L67/1023—Server selection for load balancing based on a hash applied to IP addresses or costs
-
- H—ELECTRICITY
- H04—ELECTRIC COMMUNICATION TECHNIQUE
- H04L—TRANSMISSION OF DIGITAL INFORMATION, e.g. TELEGRAPHIC COMMUNICATION
- H04L67/00—Network arrangements or protocols for supporting network services or applications
- H04L67/01—Protocols
- H04L67/10—Protocols in which an application is distributed across nodes in the network
- H04L67/1001—Protocols in which an application is distributed across nodes in the network for accessing one among a plurality of replicated servers
- H04L67/1004—Server selection for load balancing
- H04L67/1008—Server selection for load balancing based on parameters of servers, e.g. available memory or workload
-
- H—ELECTRICITY
- H04—ELECTRIC COMMUNICATION TECHNIQUE
- H04L—TRANSMISSION OF DIGITAL INFORMATION, e.g. TELEGRAPHIC COMMUNICATION
- H04L45/00—Routing or path finding of packets in data switching networks
- H04L45/38—Flow based routing
-
- H—ELECTRICITY
- H04—ELECTRIC COMMUNICATION TECHNIQUE
- H04L—TRANSMISSION OF DIGITAL INFORMATION, e.g. TELEGRAPHIC COMMUNICATION
- H04L45/00—Routing or path finding of packets in data switching networks
- H04L45/74—Address processing for routing
- H04L45/745—Address table lookup; Address filtering
- H04L45/7453—Address table lookup; Address filtering using hashing
-
- H—ELECTRICITY
- H04—ELECTRIC COMMUNICATION TECHNIQUE
- H04L—TRANSMISSION OF DIGITAL INFORMATION, e.g. TELEGRAPHIC COMMUNICATION
- H04L67/00—Network arrangements or protocols for supporting network services or applications
- H04L67/01—Protocols
- H04L67/10—Protocols in which an application is distributed across nodes in the network
- H04L67/1001—Protocols in which an application is distributed across nodes in the network for accessing one among a plurality of replicated servers
- H04L67/1004—Server selection for load balancing
- H04L67/1025—Dynamic adaptation of the criteria on which the server selection is based
-
- H—ELECTRICITY
- H04—ELECTRIC COMMUNICATION TECHNIQUE
- H04L—TRANSMISSION OF DIGITAL INFORMATION, e.g. TELEGRAPHIC COMMUNICATION
- H04L67/00—Network arrangements or protocols for supporting network services or applications
- H04L67/01—Protocols
- H04L67/10—Protocols in which an application is distributed across nodes in the network
- H04L67/1001—Protocols in which an application is distributed across nodes in the network for accessing one among a plurality of replicated servers
- H04L67/1027—Persistence of sessions during load balancing
-
- H—ELECTRICITY
- H04—ELECTRIC COMMUNICATION TECHNIQUE
- H04L—TRANSMISSION OF DIGITAL INFORMATION, e.g. TELEGRAPHIC COMMUNICATION
- H04L67/00—Network arrangements or protocols for supporting network services or applications
- H04L67/01—Protocols
- H04L67/10—Protocols in which an application is distributed across nodes in the network
- H04L67/1001—Protocols in which an application is distributed across nodes in the network for accessing one among a plurality of replicated servers
- H04L67/1029—Protocols in which an application is distributed across nodes in the network for accessing one among a plurality of replicated servers using data related to the state of servers by a load balancer
Abstract
In some implementations, a system and corresponding method for load balancing data traffic addressed to an anycast address include maintaining, by each of a plurality of load balancing (LB) devices a data structure including entries associated with application instances in a group of application instances served by the LB device. The frequency with which each served application instance is included in the data structure is indicative of a weight value associated with a capacity of the corresponding served application instance. Upon receiving a data packet, originally addressed to an anycast address, the LB device uses one or more header fields of the received data packet to identify a virtual Internet protocol (IP) address of one of the served application instances in the data structure maintained by the LB device. The LB device then forwards the data packet to the identified application instance.
Description
Cross-Reference to Related Applications
This application claims entitled " the METHOD AND SYSTEM FOR LOAD of September in 2014 submission on the 24th
BALANCING ANYCAST DATA TRAFFIC's (for Anycast data service is carried out with the method and system of load balancing) "
U.S. Patent application No.14/495,683 priority, it is equally entitled that this patent requirements on May 13rd, 2014 submits to
The U.S. Provisional Patent Application of " METHOD AND SYSTEM FOR LOAD BALANCING ANYCAST DATA TRAFFIC "
No.61/992,623 priority, above disclosure is by quoting all overall integrating with herein.
Technical field
Present disclose relates generally to loads of data traffic equilibrium field.
Background technology
A lot of contents in internet accessible content are provided by hosted server in large-scale data center in the world.
Such data center generally across multiple location distribution, and in global service end user.Typical data center accommodates
Thousands of servers, multiple examples of the software application that its trustship is associated from the different services being provided to end user.When
End user for for example with website, social media service, streaming content project, game services or any other is online
When the associated internet content of service makes request, this request is sent to and is associated with the service hosted by data center
Application example, to service the request of this end user.
Content of the invention
According to an aspect of this disclosure, a kind of for load balancing is carried out to the data service being addressed to anycast address
Method includes：First data structure is maintained by each the LB equipment in the first set of load balancing (LB) equipment, this first number
Include being associated with the application example in the group of the application example of the LB device service of the first set by LB equipment according to structure
Entry.The frequency instruction that the application example that each is serviced is included in described first data structure is serviced with corresponding
The weighted value that the capacity of application example is associated.LB equipment in the first set of LB equipment receives initially addressed taking office
After broadcasting the packet of address, the first set of the header fields that LB equipment is grouped based on received data is scattered to generate first
Train value.Then, the LB of first set uses this first data structure, identifies based on the first hashed value being generated to be serviced and answers
With virtual IP (IP) address of one of example, and it is real that this packet is forwarded to identified application
Example.Methods described also includes：Second data structure is maintained by the LB equipment of the second set of LB equipment, the second data structure includes
The entry that LB equipment corresponding to this first set is associated, each the LB equipment in the first set of LB equipment is included in
Frequency in described second data structure indicates the weighted value that LB equipment corresponding with first set is associated.In LB equipment
After LB equipment in second set receives the packet being initially addressed to this anycast address, LB is based on received data
The second set of the header fields of packet generating the second hashed value, and based on the second hashed value being generated, using second
Data structure is identifying the LB equipment of first set.Then, this packet is forwarded to the of LB equipment by the second set of LB
The LB equipment being identified of one set.
According to another aspect of the present disclosure, a kind of system in a communication network Anycast business is carried out with load balancing
Including：The first set of load balancing (LB) equipment.Each LB equipment in the first set of this LB equipment is configured to：Maintain
First data structure, this first data structure is included and by the application example of the LB device service of the first set of LB equipment
The entry that application example in group is associated.Each be served by example is included in the frequency in described first data structure
The weighted value that rate instruction is associated with corresponding be served by example.Receive number in the LB equipment of the first set of LB equipment
After packet, LB equipment generates the first hashed value based on one or more first header fields that received data is grouped,
The packet being addressed to anycast address is received at this system；And using the first data structure, based on being generated
One hashed value is identifying virtual IP (IP) address of one of serviced application example.Then first set
Packet is forwarded to identified application example by LB equipment.Described system also includes the second collection of load balancing (LB) equipment
Close.Each LB equipment in the second set of LB equipment is configured to：Maintain the second data structure, this second data structure includes
The entry that LB equipment corresponding to first set is associated.Each LB equipment in the first set of LB equipment is included in institute
The frequency stated in the second data structure indicates the weighted value that LB equipment corresponding with first set is associated.In LB equipment
After the LB equipment of two set receives packet, one or more second headers that LB equipment is grouped based on received data
Generating the second hashed value, the described packet being addressed to described anycast address is received at described system field；And
Based on the second hashed value being generated, identify the LB equipment of the first set of LB equipment using the second data structure.Then,
This packet is forwarded to the LB equipment being identified of first set by LB equipment.Described system further includes and anycast address
Associated Anycast node, is configured to, when receiving the packet being delivered to anycast address, the packet of reception be turned
Issue the LB equipment of the second set of LB equipment.
Brief description
The above-mentioned and related purpose of the disclosure, feature and advantage are when in conjunction with the following drawings by referring to following concrete
Embodiment will be more fully understood, wherein：
Fig. 1 illustrates the individual layer SiteServer LBS for the data service being addressed to anycast address is carried out with load balancing
Embodiment block diagram.
Fig. 2 illustrates to describe the embodiment of process of process Anycast packet being executed by individual layer SiteServer LBS
Flow chart.
Fig. 3 illustrates the two-layer SiteServer LBS for the data service being addressed to anycast address is carried out with load balancing
Embodiment block diagram.
Fig. 4 illustrates that the block diagram of another embodiment of two-layer SiteServer LBS.
Fig. 5 illustrates to describe the embodiment of process of disposal Anycast packet being executed by two-layer SiteServer LBS
Flow chart.
Fig. 6 illustrates to describe the flow process of the embodiment of process for generating the data structure that load equalizer is adopted
Figure.
Fig. 7 illustrates the diagram of the data structure that the system in Fig. 1 and Fig. 3 is adopted.
The similar reference element similar with title instruction in each accompanying drawing.
Specific embodiment
Online service or application generally include each application or the multiple application examples servicing.Each application or service many
Individual application example may reside within multiple computer servers.Therefore, related to multiple visits to end user application or service
The load of connection can be distributed across the subset of at least corresponding multiple application examples.Additionally, should by given application or the multiple of service
Contribute to shortening the time delay that end user is experienced with across the diverse geographic location distribution of example.Specifically, can be right by having
The hithermost geographical position of one or more of the multiple application examples answered is servicing end user.Although by corresponding
To service each end user near geographical position or client shortens time delay, but the computer in each geographical position
Server and application example therein have limited capacity.When specific location for given application or service need
When seeking the capacity beyond the application example in same position, can spill into next hithermost for the excess demand applied
Position.
In order to solve the limited capacity of computer server and application example performed thereon, in available data in the minds of
Domain name system (DNS) server is traditionally adopted to execute load-balancing function.Hereinafter present for Anycast data industry
Business carries out the embodiment of process, device and the system of load balancing.
In the service based on Anycast or application, globally using Anycast come one or more mutually from the notice of multiple servers
Networking protocol (IP) address.Then, when access identical is applied or serviced, applied using giving or serviced by end user
Anycast IP address.Then, described in embodiment as described herein below, across different corresponding application examples come to this Anycast ground
The request of this application of access or service that the data service that location is associated for example is derived from end user carries out load balancing.This
The data service being associated with anycast address in literary composition is also referred to as Anycast business or Anycast data service.In some embodiments
In, even if internet routing table changes, also while maintaining corresponding connection pair with such as transmission control protocol (TCP)
The Anycast business that status protocol is associated carries out load balancing and service.Additionally, following embodiments can allow for for difference
Designated capabilities or other load-balancing metrics are come in position, and allow on load, capacity or any other load-balancing metric
Change the response of quick load balancing.
Fig. 1 illustrates the individual layer load balancing system for the data service being addressed to anycast address is carried out with load balancing
The block diagram of the embodiment of system 100.System 100 include multiple Anycast redirector node 110a 110c (below individually or system
One ground is otherwise known as Anycast node 110), load balancer device 120a 120c (individually or is uniformly otherwise known as negative below
Carry balanced device 120) and multiple cluster of servers 130a 130c (individually or be uniformly otherwise known as cluster 130 below).
Each cluster in cluster 130 includes some application examples 131.
The packet 10 being addressed to anycast address is received by Anycast node 110 in system 100.For example, by Anycast
Node 110 receiving data packet 10.Anycast node 110 is configured as receiving the packet 10 being addressed to anycast address,
And received data packet is redirected to the equipment of corresponding load equalizer 120.In some instances, Anycast node
Received data packet 10 is redirected to corresponding load equalizer 120 by 110.In other instances, received appoints
Broadcast the pond that received data packet 10 is redirected to load equalizer 120 by node 110, the corresponding group of its service system 100
One or more of collection 130.
In some embodiments, each Anycast node 110 remains corresponding and maps or it can be accessed, and described reflects
Penetrate source internet protocol (IP) address of cache to corresponding cluster 130 or the load equalizer that is associated with such cluster
120.Map the source IP mapping that is otherwise known as.In some instances, each source IP address is mapped to cluster 130 or corresponding load
Balanced device 120, it is near the packet source being associated with identical source IP address.It will be appreciated by those skilled in the art that
The appointment done by keeper for example based on system 100, can be defined differently than source IP address and cluster 130 or load equalizer
Mapping between 120.When receiving the packet 10 being addressed to anycast address, Anycast node 110 is looked in source IP mapping
Look for source internet protocol (IP) address of packet, and packet 10 is redirected to mapped position and reflect with source IP
The position that the source IP address hit is associated.The load equalizer 120 of the Position Indicator System 100 being mapped or load balancing
Device 120 pond.
In some embodiments, Anycast node 110 is come really using some header fields of received data packet 10
Determine received data packet 10 and will be redirected to its load equalizer 120 or load equalizer 120 pond.For example, enter
Anycast node 110 application target ground IP address (such as virtual IP address (VIP) address) and divide with received data that row receives
Organize 10 associated source ports to determine the Anycast service group in the middle of multiple Anycast service groups.In some embodiments,
The Anycast node 110 being received can application target way address, destination port, source IP address, source port, agreement or
Its any combinations is determining Anycast service group.The Anycast node 110 being received can also use data packet payload
In included other information, connection identifier (CID (ID) etc..For example, it is possible to limit Liang Ge Anycast service group, appoint for one
Broadcast and service group's use for backend load endpoint server in a balanced way, and another Anycast service group is using for rear end
The load-balanced server of load balancing.Endpoint server is configured to terminate transmission control protocol (TCP) connection.Show at other
In example, different Anycast service groups can be limited.It is mapped to corresponding in the destination IP address by packet and source port
Broadcast when servicing group, the Anycast node 110 being received enters to the second mapping or configuration information that for example indicate such mapping
Row utilizes.The Anycast node 110 being received further using received data packet 10 source IP address and with carry out
The source IP that the Anycast node 110 receiving is associated maps and to determine the area of system 100, for example one or more clusters 130.One
In a little embodiments, all Anycast nodes 110 share single source IP mapping.In other embodiments, different can be appointed
Broadcast node 110 to be associated with diverse source IP mapping.In some embodiments, by each source IP mapping and respective service
Associated.Then, the Anycast node 110 being received be based on the such as the 3rd mapping will determined by area and determined by times
Broadcast and service group and be mapped to load equalizer 120 or load equalizer 120 pond.Then, the Anycast node being received is by institute
Receive packet 10 be redirected to determined by load equalizer 120 or determined by load equalizer 120 pond.
It will be appreciated by those skilled in the art that being made by Anycast node 110 logarithm using the global map of such as source IP mapping
Redirection according to packet 10 is consistent.In other words, if receiving data at Anycast node 110c rather than at Anycast node 110b
It is grouped, then Anycast node 110c can map for packet 10 to be redirected to the phase that Anycast node 110b can select using source IP
Same load equalizer.
The Anycast node 110 being received is further able to be configured to check for connection table, to determine received data
Whether packet 10 is corresponding to the data flow being serviced by the Anycast node 110 being received recently or session.If the number being received
According to packet corresponding to indicated data flow in connection table or session, then the Anycast node 110 being received is by the number being received
It is forwarded to the destination being associated with corresponding data flow or session according to packet 10.Otherwise, as described above, the Anycast being received
Node 110 determines load equalizer 120 or load equalizer 120 pond, and received data packet 10 is redirected to
Determined by load equalizer 120 or determined by load equalizer 120 pond.
In some embodiments, each load equalizer 120 is the computing device including processor and memory.Storage
Data structure 121 and computer generation code instruction that the anycast address that originally device storage is addressed to packet 10 is associated.
Computer generation code instruction includes software load balanced device for the packet being associated with anycast address being carried out with load all
Weighing apparatus.In some embodiments, software load balanced device is virtual machine.Load equalizer 120 can include and identical Anycast ground
Location associated plurality of software load balanced device and/or with multiple anycast address associated plurality of software load balanced device.Number
It is supported balanced device 120 according to structure 121 to adopt, the packet being associated with anycast address is mapped to and resides in cluster
Corresponding application example 131 in 130.In some instances, each load equalizer 120 is included for by identical load balanced device
The separate data structure of each anycast address of 120 services.Processor is configured to execute the computer generation of storage in memory
Code instruction.It will be appreciated by those skilled in the art that each load equalizer 120 can include multiple processors and/or multiple deposit
Reservoir.Load equalizer 120 includes computer server, the endpoint server terminating TCP connection, is configured to execute this paper institute
Other electronic equipments of the load balancing stated or a combination thereof.
In some instances, the different geographic regions of load equalizer 120 cross-system 100 are being distributed.For example, load balancing
Device 120a, 120b and 120c service corresponding cluster 130a, 130b and 130c respectively.In other instances, load equalizer
120 can service more than one cluster 130.Load equalizer 120 can be with the area of service system 100.Area refers to for example herein
One or more clusters 130 of the system 100 of correlation based on corresponding geographical position or other standards.For example, area can wrap
Include intracardiac reason each other such as in identical data and tighten multiple clusters 130 that contiguity disposes recently.In other instances, Qu Ke
To include by relatively high speed communication link Lai interconnective more remote cluster 130.Additionally, area can by load all
Weighing apparatus pond is servicing.
In the example in the pond that received data packet 10 is redirected to by load equalizer 120 by Anycast node 110,
Using equal cost multipath (ECMP) route, received data can be forwarded the packet to the certain negative in load equalizer 120 pond
Carry balanced device 120.For example, the header fields based on packet 10 for the equipment of receiving data packet 10 are generating integer hash
Value, the five-tuple of such as packet, including agreement, source IP address, destination IP address, source port and destination port.So
Afterwards, the equipment being received based on the hashed value being generated to include load balancer 120 mark table size delivery Lai
Determine destination load equalizer 120.In some embodiments, as described further below, the equipment being received
Using with load equalizer 120 using the identical or essentially similar algorithm of algorithm determine destination load equalizer
120.Then, the equipment that received or point to destination load equalizer by rewriteeing layer two ethernet header being grouped
120, or packet 10 is encapsulated by using generic route encapsulation (GRE) header and outer IP header, by data
Packet 10 is delivered to destination load equalizer 120.Multiple software load equilibriums including the destination IP address distributing packet
The load equalizer 120 of device can adopt identical approach, received data packet 10 is transmitted to multiple software loads equal
One of weighing apparatus.
After receiving packet 10, the load equalizer 120 being received or software load balanced device base thereon
One or more header fields in packet to generate hashed value, for example, include agreement, source IP address, destination IP ground
The five-tuple of the packet of location, source port and destination port.In some embodiments, data structure 121 includes and carries out
The entry that the group of the application example 131 that the load equalizer 120 receiving is serviced is associated.The group pair of application example 131
Application or service that the anycast address being addressed to during Ying Yuyu packet 10 arrival system 100 is associated.Then, connect
The load equalizer 120 received is determined by the load equalizer being received using the hashed value data structure 121 being generated
The destination IP address of the application example 131 in the group of application example of 120 services.Then, the load balancing being received
Device 120 by packet 10 be transmitted to determined by application example 131.
In some embodiments, with include in data structure 121 each application example 131 frequency reflect with identical
The mode design data structure 121 of the weight that application example 131 is associated.The weight being associated with application example 131 is indicated
Load-balancing metric, such as capacity, process time or with determine packet is forwarded to which application example 131 phase
The other standards closing.That is, the weight being associated with each application example 131 can reflect：Application example 131 have how busy or
How idle have.As an alternative, the weight being associated with given application example 131 can reflect, if using identical application example
131, then how soon packet 10 is carried out with process has or has how slowly.The capacity of each application can be in packet per second, company
Connect or the aspect such as synchronization (SYN) packet per second, bandwidth is being defined.Process time can be in round trip delay time (RTT) or basis
Field other tolerance aspects known are limiting.In data structure 121, application example 131 is more frequently included, and more may
Select identical application example 131 for processing the request being associated with packet 10.
The load equalizer 120 being received selects the entry of data structure 121 using the hashed value being generated.Example
As received carries balanced device 120 and can select to have and be equal to generated hashed value to the size of data structure or number
Data structure entries according to the index of the size delivery of the element portions of structure.Each entry instruction of data structure 121 corresponds to
Application example 131.For example, each entry of data structure 121 includes the destination IP address of corresponding application example 131.So
Afterwards, packet 10 is transmitted to have and obtains from selected data structure entries by the load equalizer 120 being received
The application example 131 of destination IP address.
In some embodiments, data structure 121 is single table, and where each row or as an alternative each column include and system
The entry of the application example that 100 correspondence position such as cluster 130 or area are associated.Therefore, the load being received is equal
Weighing apparatus 120 can select row or alternative column as an alternative first, and it is selected to select to be then based on generated hashed value
Row or as an alternative selected row in entry.In some embodiments, data structure 121 includes multiple tables, wherein
Each table corresponds to the position of system 100, such as area or cluster 130.In this case, the load equalizer being received
120 can select table first, and are then based on generated hashed value to select the entry in selected table.
The load equalizer 120 being received can select corresponding with the position of system 100 in a different manner
Table or sublist, such as row or column.For example, described selection can be based on being associated IP subnet with the correspondence position of system 100
Mapping.Which position that system 100 can be usually arrived on by observing the business being derived from each IP subnet limits such reflecting
Penetrate.As an alternative, can based on assigning of making of the keeper of system 100 or the position 130 based on IP subnet and system 100 it
Between distance and RTT limiting mapping.The load equalizer 120 being received is searched and received data packet in the map
10 associated source IP address, and obtain the weight list of position or position.If retrieving adding of position from mapping
Power list, then the load equalizer being received based on corresponding weight and can use the one or more of packet 10
Header fields such as five-tuple, come another hashed value to generate, selects position from list.But, if do not use added
Power list, then it is enough that the load equalizer 120 being received checks whether the hithermost position indicating in the map has
Active volume carrys out processing data packet 10.If it is, selecting this hithermost position, otherwise indicated in inspection such as mapping
Next hithermost position, and by that analogy.It is associated in view of each position and corresponding table or sublist, then from reflecting
When hitting selection position, the load equalizer 120 selection table being received or sublist are for determining purpose for packet 10
Ground application example 131.It will be appreciated by those skilled in the art that replacing one or more tables, data structure 121 can be wrapped as an alternative
Include one or more trees or any other data structure known in the art.
The load equalizer 120 being received can also check connection table before selecting application example 131, to determine
Whether the packet 10 receiving connects the stream being associated or session corresponding to existing.If it find that received data packet
10 are associated with existing connection, then packet 10 is forwarded to the application example being associated with this connection in connection table.No
Then, the load equalizer 120 being received determines application example 131 according to data structure 121, and packet 10 is forwarded to
Determined by application example 131.Additionally, after receiving packet 10, if packet 10 previous packed
Secondary or multiple, then load equalizer 120 can decapsulate this packet 10 further.Therefore, the load balancing being received
Device 120 decapsulate data packets 10, until reaching internal grouping, and and then retrieve for determining answering of processing data packet 10
Any header fields with example 131.
Each cluster 130 includes safeguarding one or more computers of the application example being associated with one or more services
Server such as content transfer servicer and/or application server.In FIG, each of cluster 130a-130c bag
Include some application examples 131, described application example 131 and appointing of being addressed to by packet 10 in arrival system 100
Broadcast address associated come the application to access or service.Application example 131 in given cluster 130 may reside within single calculating
In machine server, or can also be distributed in the middle of multiple computer servers of same cluster 130.Application example 131 passes through
Corresponding destination IP address is come addressed.Application example as used herein includes the end user's to webpage or application
The copy of the server application that request is serviced, described webpage or application such as e-mail applications, game application, social matchmaker
Body application, calendar application or any other application on site.The application example 131 of receiving data packet 10 is processed and is divided with data
The associated request of group 10.
Fig. 2 illustrates to describe the enforcement of the process 200 of process Anycast packet being executed by individual layer SiteServer LBS 100
The flow chart of mode.Process 200 includes procedure below：Receive the packet being addressed to anycast address by Anycast node 110
10 (stages 210)；Received data packet 10 is forwarded to by load equalizer 120 (stage 220) by Anycast node 110；With
And determine whether packet is associated (stage 230) with the stream previously being serviced or session by load equalizer 120.If really
Given data packet is associated with the stream previously being serviced or session, then process 200 includes packet 10 is forwarded to previously
The application example (stage 240) that the stream being serviced or session are associated.Otherwise, process 200 includes：From multiple sub-data structure
Select sub-data structure (stage 250), the one or more headers based on selected sub-data structure and packet 10
Field determining application example 131 (stage 260), and by this packet be forwarded to determined by the application example (stage
270).
When the online service that end user asks or consumption is associated with anycast address, by send from this end user
Corresponding data packet is addressed to identical anycast address.One or more Anycast nodes 110 receive and are addressed to anycast address
Packet (stage 210).For example, it is addressed to anycast address by with packet source hithermost Anycast node 110 reception
Each packet.After receiving the packet being addressed to Anycast node (stage 210), the Anycast section being received
Whether point can check connection table, to determine received data packet with the stream previously being serviced or session for example
The connection set up is associated.If it is determined that packet is associated with existing stream or session, then the Anycast node being received
This packet is transmitted to the next-hop being associated with existing stream or session by 110.Inspection to connection table is optional, because
Can be implemented by another network element in addition to the Anycast node 110 being received or equipment for it, or can
So that it to be skipped completely.
If it is determined that packet and such as synchronous (SYN) packet or the existing stream of packet or session are uncorrelated
Connection wherein flows previously by different Anycast nodes, or the Anycast node 110 being received is not carried out checking,
Then packet is transmitted to load equalizer (LB) 120 (stage 220) by Anycast node.(the stage when forwarding packet
220) the Anycast node 110, being received can based on packet one or more header fields such as source IP ground
Location, destination IP address and/or source port and the sub-data structure being associated with the Anycast node 110 being received, are determined
Load equalizer 120.Additionally, Anycast node 110 can divide to data before packet is transmitted to load equalizer 120
Group is decapsulated and/or using one or more new headers, it is encapsulated.
After receiving packet, load equalizer 120 can check connection table, to determine received data packet
Whether it is associated (stage 230) with the stream previously being serviced or session such as connections set up.If it is determined that data
Packet is corresponding with existing stream or session, then this packet is transmitted to and existing stream or session are serviced by LB 120
Application example (stage 240).Inspection to connection table is optional because its can pass through another in addition to LB 120
Individual network element or equipment are implementing, or can skip it completely.
If it is determined that the existing stream of packet and such as synchronous (SYN) packet or packet or session not phase
Association is wherein flowed previously by different Anycast nodes, or LB 120 is not carried out checking, then this LB is from by LB
Sub-data structure (stage 250) is selected in the data structure 121 of 120 maintenances.For example, if data structure 121 is single table,
Selected sub-data structure can be the row or column of this table.In other examples that data structure 121 includes multiple tables, selected
The sub-data structure selected is the table in multiple tables.The selection of subdata structure can header fields based on packet and
Sub-data structure between the correspondence position of IP subnet and system 100.As an alternative, described selection can report based on packet
The list of the sub-data structure of weight of each sub-data structure in head field and reflection list.Every in data structure 121
Individual sub- data structure represents the superfluous of the application example 131 that is associated with the correspondence position such as cluster 130 or area of system 100
Remaining list.The frequency that corresponding sub-data structure includes application example 131 is depended on and is associated with same application example 131
Weighted value.
Then, LB 120 uses one or more header fields of packet, true according to selected sub-data structure
Determine application example 131 (stage 260).For example, LB 120 generates hash using one or more header fields of packet
Value, and the entry of sub-data structure is then determined using the hashed value being generated.LB 120 can calculate generated dissipate
The size delivery of train value subdata structure, and result is used as the index of selected entry.Those skilled in the art should
Work as understanding, the entry of sub-data structure can be identified for choosing using the header fields of packet in a different manner
Select.Each entry of selected sub-data structure includes the IP address being associated with corresponding application example 131, such as purpose
Ground IP address.Then, LB 120 by packet be forwarded to determined by application example 131 (stage 270), wherein to data
The associated request of packet is serviced.
Fig. 3 illustrates the two-layer SiteServer LBS for the data service being addressed to anycast address is carried out with load balancing
The block diagram of 300 embodiment.System 300 includes：Individually or unified below Anycast redirector node 310a-310c
The Anycast node 310 that is otherwise known as, individually or uniformly quilt again below ground floor load balancer device 320a 320c
Referred to as ground floor load equalizer 320, below second layer load balancer device 325a 325c individually or uniformly again
It is referred to as second layer load equalizer 325, and multiple cluster of servers 330a 330c of such as cluster 330a 330c
Individually or be uniformly otherwise known as cluster 330 below.Each of cluster 330a 330c includes visiting with by anycast address
Some application examples 331 that the service asked is associated.
Anycast node 310 is configured to be forwarded to the received data packet 10 being addressed to corresponding anycast address
Ground floor LB 320 in one or more ground floor LB 320.Anycast node 310 is one or more based on packet 10
Header fields such as source IP address, destination IP address and/or source port and the son being associated with Anycast node 310
Data structure, determines the ground floor LB 320 for forwarding this packet.Additionally, data can divided by Anycast node 310
Group before being transmitted to selected ground floor LB 320 decapsulates and/or using one or more new headers packet to it
Encapsulation.Additionally, similar with regard to the Anycast node 110 described in Fig. 1, Anycast node 310 can be examined after receiving packet
Look into connection table.
In some embodiments, each ground floor LB 320 includes the first data structure 321, for being received
Packet is mapped to corresponding second layer LB 325.In some instances, the first data structure 321 includes second layer LB 325
Redundancy list so that the frequency that the first data structure includes each second layer LB 325 depends on and identical second layer LB
325 or correspondence position be associated weighted value.For example, weight can reflect the active volume of each corresponding position, to often
The RTT of individual correspondence position, another load balancing standard or a combination thereof.Based on packet 10 one of ground floor LB 320
Or multiple header fields, select second layer LB 325 from corresponding first data structure 321.Then, ground floor LB 325 will
Packet 10 is transmitted to selected second layer LB 325.In some instances, ground floor LB 320 uses packet 10
Header fields generating hashed value, and the second layer is selected from the first data structure 321 based on the hashed value being generated
LB 325.In other instances, similarly can hold with the selection (stage 250) with regard to the subdata structure described in Fig. 2
Row selection to second layer LB 325 by ground floor LB 320.Ground floor LB 320 can rely on to the selection of second layer LB 325
In connection table is checked by ground floor LB 320 with (similar to the stage 230 in Fig. 2, stage 240 and stage 250).
Each second layer LB 325 is associated with the position such as area of system 300 or cluster 330, and includes and be
Corresponding second data structure 326 that the same position of system 300 is associated.Second data structure 326 includes and same position phase
The redundancy list of the application example of association.Second data structure 326 include each application example frequency reflect with identical
The weighted value that application example is associated.Such weight can reflect active volume at each application example, to each application
The RTT of example, other load balancing standards or a combination thereof.Selected second layer LB 325 receiving data packet 10, and
One or more header fields based on packet 10 are come according to corresponding second data structure 326 determination application example.Example
Header fields as, ground floor LB 320 uses packet 10 generate hashed value, and based on the hashed value being generated from the
Second layer LB 325 is selected in one data structure 321.In some embodiments, each entry bag of the second data structure 326
Include the IP address such as destination IP address being associated with corresponding application example.Can will be given birth to when selecting IP address
The hashed value becoming is used as the index of the entry in the second data structure.Then, packet 10 is transmitted to by second layer LB 325
Determined by application example.
Each cluster 330 includes safeguarding one or more computers of the application example being associated with one or more services
Server such as content transfer servicer and/or application server.In figure 3, each in cluster 330a 330c includes
Some application examples 331, described application example 331 and the Anycast being addressed in arrival system 300 by packet 10
Address is associated come the application to access or service.Application example 331 in given cluster 330 may reside within single computer
In server, or can also be distributed in the middle of multiple computer servers of same cluster 330.It is right that application example 331 passes through
The destination IP address answered is come addressed.The application example 331 of receiving data packet 10 is processed and is associated with this packet 10
Request.As illustrated in fig. 3, by one or more second layer LB 325, each cluster 330 of system 300 or area can be carried out
Service.For example, when being serviced to cluster 330a by second layer LB 325a, right by two second layer LB 325b and 325b '
Cluster 330b is serviced.
Fig. 4 illustrates the block diagram of another embodiment of two-layer SiteServer LBS 300.For convenience of description, shown in Fig. 4
Block diagram depict only 310, two ground floor LB 320a and 320b of single anycast node, two second layer LB of system 300
325a and 325b and two cluster 330a and 330b.System 300 also include the first controller 312, second controller 322,
Three controllers 327 and GSLB controller 350.
First controller 312 includes network element, computer server or another electronic equipment.First controller 312 leads to
Cross such as source IP mapping, the information of connection table and/or process the received data packet being addressed to corresponding anycast address
When 10, Anycast node 310 is configured by the other information that Anycast node 310 adopts.First controller 312 can be from one or many
The other equipment of individual database or system 300 obtains such information, and provides corresponding renewal to Anycast node 310.
Second controller 322 includes network element, computer server or another electronic equipment.Second controller 322 leads to
Cross and provide the information of weight being such as associated with each position such as cluster 330 or area of system 300, by packet
Route to the routing iinformation of the position of system 300, connection table and/or when processing received data packet 10 by ground floor
The other information that LB 320 adopts is configuring ground floor LB 320a and 320b.Second controller 322 can be from GSLB
The other equipment of controller 350, one or more database or system 300 obtains such information, and to ground floor LB
The 320 corresponding renewals of offer.
3rd controller 327 includes network element, computer server or another electronic equipment.3rd controller 327 leads to
Cross and provide the such information of weight being such as associated with each application example 331 in the correspondence position of system 300, by data
Packet 10 routes to the routing iinformation of application example 331 and/or when processing received data packet 10 by second layer LB
The other informations of 320 employings are configuring second layer LB 325a and 325b.3rd controller 327 can be from one or more data
The other equipment of storehouse or system 300 obtains such information, and provides corresponding renewal to second layer LB 320.
In the diagram, the continuous lines instruction data packet path between the different assemblies of system 300 (put down by the data that is otherwise known as
Face), dotted line indicates the stream (be otherwise known as control plane) of configuration information/instruction, and (it is also in intermittent line indication feedback path
A part for control plane).In some embodiments, packet is transmitted to system 300 by each ground floor LB 320
When position or corresponding second layer LB 325, ground floor LB 325 just reports this forwarding to GSLB controller
350.Additionally, second layer LB 325 can report the forwarding of packet 10 to GSLB controller 350 and/or be
The other equipment of system 300.The information that GSLB controller 350 is reported using ground floor LB 320 is updating and system
The weight that 300 diverse location is associated.The information that second layer LB 325 is reported by GSLB controller 350 or
The equipment of the position being associated from second layer LB 325 is used for updating the weight being associated with different application example 331.
In some embodiments, cluster 330 can be configured to be supplied to the status information of its server or application example 331 entirely
Other equipment in office's load balancing controller 350 and/or system 300.GSLB controller 350 or system 300
In the information that can be reported using cluster 330 of other equipment updating the weight being associated from different application example 331.
In some embodiments, GSLB controller 350 also obtains from router and/or with regard to the network element of link congestion
Obtain data.
Fig. 5 illustrates to describe the enforcement of the process 500 of process Anycast packet being executed by two-layer SiteServer LBS 300
The flow chart of mode.Process 200 includes procedure below：Receive the packet being addressed to anycast address by Anycast node 310
10 (stages 510)；Received data packet 10 is forwarded to by ground floor LB 320 (stage 520) by Anycast node 310；By
One layer of LB 320 determines whether packet is associated (stage 530) with the stream previously being serviced or session；If it is determined that data
Packet 10 is associated with the stream previously being serviced or session, then data flow packet 10 being forwarded to and previously having been serviced or
The application example (stage 540) that session is associated；Otherwise, based on the first data structure being maintained by ground floor LB 320 and number
One or more header fields according to packet 10 to select second layer LB 325 (stage 550)；Packet is forwarded to selected
The second layer LB 325 (stage 560) selecting；Based on the second data structure being maintained by second layer LB 325 and packet 10
One or more header fields, application example 331 (stage 570) is determined by selected second layer LB 325；And by number
According to application example (stage 580) determined by packets forwarding extremely.
The stage 510-540 of process 500 similar to the stage 210-240 with regard to the process 200 described in Fig. 2, except using
Ground floor LB 325 (as shown in Figure 3 and Figure 4) replaces outside load equalizer 120 (as shown in Figure 1).Additionally, stage 530 and rank
Section 540 is optional, because it can execute the inspection to connection table by another equipment in addition to ground floor LB 325
Look into.The ground floor LB 320 of receiving data packet 10 is based on the first data structure 321 being maintained by ground floor LB 320 and number
One or more header fields according to packet 10 to select second layer LB 325 (stage 550).First data structure 321 includes
Second layer LB 325 in system 300 or the redundancy list in correspondence position such as cluster 330 or area.First data structure 321
Include each second layer LB 325 or the frequency of correspondence position depends on the weighted value being associated with identical correspondence position.Weight
Can reflect each corresponding position active volume, to the RTT of each correspondence position, another load balancing standard or its
Combination.In some instances, ground floor LB 320 uses the header fields of packet 10 to generate hashed value, and based on being given birth to
The hashed value becoming to select second layer LB 325 from the first data structure 321.For example, ground floor LB 320 use is generated
The size delivery to the first data structure for the hashed value, is used as the index of entry that will select from the first data structure.Then,
Packet is forwarded to selected second layer LB 325 by ground floor LB 320, or is forwarded to related to selected position
The second layer LB 32 (stage 560) of connection.
Receiving data packet 10 second layer LB 325 based on the second data structure 326 being maintained by second layer LB 325 with
And one or more header fields of packet 10 are determining application example 331 (stage 570).Second data structure 326 is wrapped
Include the redundancy list of application example 331.The frequency that second data structure 326 includes each application example 331 depends on and answers
The weighted value being associated with example 331.Weight can reflect active volume at each corresponding application example 331, right to each
Answer RTT, other load balancing standards or a combination thereof of application example 331.Second layer LB 325 uses the report of packet 10
Head field generates hashed value, and determines application example 331 based on the hashed value being generated according to the second data structure 326.
For example, second layer LB 325 uses the size delivery to the second data structure 326 for the generated hashed value, and being used as will be from second
The index of the entry selecting in data structure 326.Then, second layer LB 325 by packet 10 be forwarded to determined by application
Example 331 (stage 580).
Fig. 6 illustrates to describe the stream of the embodiment of process 600 for generating the redundancy list that load equalizer is adopted
Cheng Tu.For example, it is contemplated that each in the list of entity is associated with corresponding weighted value, select than the number of entities in list
Bigger prime number is as the size of redundancy list to be generated.The processor of implementation procedure 600 is every in given list of entities
Individual entity selection deviant and step value (stage 610).Then, processor selects the entity (stage from given list of entities
620).The pseudorandom of the described mark (such as a part for title, title, identification strings etc.) being selected to based on entity is put
Bring and be done.Processor is by the number of entities having included in the redundancy list of selected entity and corresponding dynamic threshold phase
Relatively (stage 630).For example, dynamic threshold is defined as the weight corresponding with selected entity and is multiplied by iteration number.As
Really find that the number of entries having included is less than dynamic threshold (stage 630), then processor inspection is by redundancy list to be generated
In the position of deviant instruction be whether empty (stage 640).If it find that the position being indicated by deviant is not empty, then locate
Reason device passes through the delivery being incremented by corresponding step value and intercepting the size to redundancy list through incremental value, is somebody's turn to do with updating
Deviant (stage 650).Then, whether processor inspection is empty (stage 640) by the position of the deviant instruction being updated.Weight
Multiple stage 650 and stage 640, till detecting empty position.If in arbitrfary point, the result (stage 640) of process all refers to
Show empty position, then processor adds the entry (stage 660) corresponding with selected entity at this empty position.Once superfluous
The entry (stage 660) of selected entity, or the added bar finding selected entity is with the addition of in remaining list
Purpose number is more than dynamic threshold (stage 630), then whether processor inspection has been processed by given list in current iteration
In all entities (stage 670).If all entities in given list are not processed entirely, processor is from given list
Select new entity for being processed (stage 620).Otherwise, processor is incremented by iteration number (stage 680), and then
Select entity for being processed (stage 620) from given list.Processor was iterated to the stage described in Fig. 6, directly
It is filled to redundancy list.
Process 600 generates redundancy list as dimensional table, such as row or column, tree, subtree or any other data structure.
Entity in given list can be application example 131 or 331, load equalizer 120 or 325 or SiteServer LBS 100
Or 300 position.In the redundancy list being generated, the frequency that each entity repeats depends on the power corresponding with identical entity
Weight values.The size of redundancy list is being chosen as the reality much larger than such as big 100 times of entity total number in given list
Under example, the frequency that redundancy list includes entity is changed into almost proportional to corresponding weight.The redundancy list being generated big
Little bigger with respect to the number of entities in given list, the ratio between the frequency of identical entity and weight is more accurate.
Fig. 7 illustrates the diagram of the data structure that the system in Fig. 1 and Fig. 3 is adopted.Consider such as cluster 130a or 330a
Cluster A three application examples A_1, A_2 and A_3, and three of cluster B of such as cluster 130b or 330b applications are real
Example B_1, B_2 and B_3, each row of the table in Fig. 7 depicts (is such as schemed based on the process 600 that corresponding weight set generates
Shown in 6) sample output, it has the size equal to 17.For example, the first row corresponds to an output, wherein applies with each
The weight that example A_1, A_2 and A_3 are associated is equal to 1.0, and the weight being associated with application example B_1, B_2 and B_3
Equal to 0.0.From any row to next line, the weighted value of application example A_1, A_2 and A_3 is successively decreased 0.1, and will apply real
The weighted value of example B_1, B_2 and B_3 is incremented by 0.1.
Because the weight being associated with application example in the table shown in Fig. 7 is slowly varying from a line to next line,
The change of very little is only observed from a line to next line.In fact, the row of the table by checking Fig. 7 can be seen, because weight
There is slight change from a line to next line, so only there is the change of very little across each row.
Consider a scenario in which, wherein cluster 130a of Fig. 1 includes application example A_1, A_2 and A_3, and these should
All experience spilling with each of example.Such as 20% spilling demand will be redirected to the next one with active volume
Hithermost cluster, for example, include cluster 130b of Fig. 1 of application example B_1, B_2 and B_3.Accordingly, with respect to the group with Fig. 1
The Anycast business that collection 130a is associated, 0.8 weighted value is associated with application example each of A_1, A_2 and A_3, and 0.2
Weighted value be associated with application example each of B_1, B_2 and B_3.So, the situation of the third line of the table in Fig. 7
Represent the sample of the sub-data structure being associated with cluster 130a of Fig. 1.Furthermore, it is assumed that application example B_1, B_2 and B_3 tool
Have enough bandwidth come to service reach cluster 130b Anycast business, when take into account be associated with cluster 130b shown in Fig. 1 times
When broadcasting business, these application examples all can have equal weight 1.0.Therefore, last column of the table in Fig. 7 represents with Fig. 1's
The sample of the sub-data structure that cluster 130b is associated.
To any group of, continuous row is compared, and is able to observe that the entry only having very little from a line to next line becomes
Change.Such observe instruction, the little change (from a line to next line weight value changes ± 0.1) of weighted value has to data path
There is slight impact.Adding or remove the application example being associated with little weighted value also can be to the bar of corresponding line or sub-data structure
Mesh has slight impact.Generate row or the mode (being generated using the process 600 shown in Fig. 6) of sub-data structure is led to phase
Application example 131 or 331 (as shown in figures 1 and 3) is answered to assign the uniformity of new request.In some embodiments, weighted value
On little change and/or the application example that is associated with little weight of interpolation/removal be not result in data service rerouting (or
Person recalculates routing table at network router or other network elements) because the load to data service for such change
Equilibrium has slight impact.
Consider similar scene, for example, be there is the scene of the identical weight being discussed with previous paragraph, wherein apply real
Example is associated with cluster 330a of Fig. 3, and application example B_1, B_2 and B_3 are associated with cluster 330b of Fig. 3, then Fig. 7
In the third line of table represent the sample of the second data structure 326 being associated with cluster 330a of Fig. 3.Additionally, the table in Fig. 7
Last column represent the sample of the second data structure 326 being associated with cluster 330b of Fig. 3.
The embodiment of the theme describing in this manual and operation can be with Fundamental Digital Circuit or to be included in
Computer software on tangible medium, firmware or hardware include the structure disclosed in this specification and its equivalent structures,
Or to be realized with the combination of one or more of which.The embodiment of the subject content describing in this manual can
The one or more computer programs being comprised are implemented as on tangible medium, that is, computer program instructions is one or more
Module, one or more of computer programs encode on one or more computer-readable storage mediums, for by data processing
Device execution or the operation of control data processing meanss.Computer-readable storage medium can be following or be included therein：Meter
Calculation machine readable storage medium storing program for executing, computer-readable memory substrate, random or serial access memory array or equipment or they
One or more combinations.Computer-readable storage medium also can be one or more single assemblies or medium (for example multiple CD,
Disk or other storage devices) or be included therein.Computer-readable storage medium can be tangible and non-transitory.
Operation described in this specification can be implemented as by data processing equipment to one or more computer-readables
The data being stored in storage device or the operation of the data execution receiving from other sources.Process and logic flow also can be by
Dedicated logic circuit such as FPGA (field programmable gate array) or ASIC (special IC)) execution, and device
Also dedicated logic circuit can be implemented as.
Although this specification comprises many specific embodiment details, they be not necessarily to be construed as to any invention or
May require that the restriction of the scope of protection, and retouching of the feature of the particular implementation specific to specific invention should be interpreted
State.The some features describing in this manual under the context of single embodiment also can in single embodiment group
Close and realize.On the contrary, under the context of single embodiment, each feature of description also can in multiple embodiments individually
Or to be realized with any suitable sub-portfolio.In addition although can describe feature as above working with some combinations,
And even initially so claimed, but sometimes can by from claimed combination one or more features from
Leave out in this combination, and combination required for protection can be related to the modification of sub-portfolio or sub-portfolio.
To "or" quote can be interpreted inclusive so that using "or" description any lexical item can indicate institute
Description lexical item in single, more than one and all of any one.Mark " first ", " second ", " the 3rd " etc. are no
Necessarily it is intended to refer to sort, and be generally used only for distinguishing same or analogous project or element.
Therefore it has been described that the particular implementation of this theme.Other embodiment also falls into appended claims
In the range of.In some cases, the action being illustrated in claims can be executed in different order and still reach to
To desired result.Additionally, the process described in accompanying drawing is not necessarily required to shown particular order or consecutive order to reach the phase
The result hoped.In some embodiments, it is possible to use multitask or parallel processing.
Claims (22)
1. a kind of system in a communication network Anycast business is carried out with load balancing, including：
The first set of load balancing LB equipment, each the LB equipment in the described first set of described LB equipment is configured to：
Maintain the first data structure, described first data structure is included and described in the described first set of described LB equipment
The entry that application example in the group of the application example of LB device service is associated, each be served by example is included in
The weighted value that frequency instruction in described first data structure is associated with the capacity of corresponding be served by example；
Upon receipt of packet, it is based on one or more first header fields of received data packet to generate the
One hashed value, described packet is to be addressed to anycast address and received at described system；
Using described first data structure, identify in described be served by example based on the first hashed value being generated
Individual virtual IP IP address；And
Described packet is forwarded to identified application example；
The second set of load balancing LB equipment, each the LB equipment in the described second set of described LB equipment is configured to：
Maintain the second data structure, described second data structure includes associated to the corresponding LB equipment in described first set
Entry, the frequency that each the LB equipment in the described first set of described LB equipment is included in described second data structure refers to
Show the weighted value being associated with the corresponding LB equipment in described first set；
Upon receipt of packet, it is based on one or more second header fields of received data packet to generate the
Two hashed values, described packet is to be addressed to described anycast address and received at described system；
Based on the second hashed value being generated, identify that the LB in the first set of LB equipment sets using described second data structure
Standby；And
Described packet is forwarded to the LB equipment being identified in described first set；And it is related to described anycast address
The Anycast node of connection, described Anycast node is configured to：
Upon receipt of the packet being addressed to the anycast address being associated with Anycast node, just received data is grouped
It is forwarded to the LB equipment in the described second set of described LB equipment.
2. system according to claim 1, wherein, the described LB equipment in the described second set of described LB equipment is entered
One step is configured to：The business load of each the LB equipment in the described first set being forwarded to described LB equipment is reported to complete
Office's LB element.
3. system according to claim 2, wherein, described overall situation LB element is configured to：It is based at least partially on and connect
The report of the forwarding service load received, generates the weight being associated with the LB equipment in the described first set of described LB equipment,
The report of described forwarding service load is the institute to described LB equipment for the LB equipment from the described second set of described LB equipment
State the LB equipment in first set.
4. system according to claim 1, wherein, with the corresponding LB equipment in described first set be associated described power
Weight values indicate the capacity of the group by the processing equipment of the described corresponding LB device service in described first set.
5. system according to claim 1, wherein, described application example and application server, content server, Yi Jixu
At least one of plan machine is associated.
6. system according to claim 1, wherein, each the LB equipment in the described second set of described LB equipment is entered
One step is configured to：
Receive the weighted value of one or more of the described first set of described LB equipment LB equipment；And
The received weighted value of the one or more of LB equipment in the described first set based on described LB equipment, generates institute
State the second data structure.
7. system according to claim 6, wherein, generate described second data structure when, described LB equipment described
Each LB equipment in second set is further configured to：
For the empty data structure location of each the LB equipment choice some in the described first set of described LB equipment, it is based on
The described weighted value corresponding with the described LB equipment in the described first set of described LB equipment to determine the institute of described number
The data structure location selecting；And
The IP address of the described LB equipment in the described first set of described LB equipment is inserted into each selected sky number
According in locations of structures.
8. system according to claim 7, wherein, each the LB equipment in the described second set of described LB equipment is entered
One step is configured to：Based on the deviant being associated with each the LB equipment in the described first set of described LB equipment, for described
The empty data structure location of the number described in described LB equipment choice of the described first set of LB equipment.
9. system according to claim 1, wherein, each the LB equipment in the described first set of described LB equipment is entered
One step is configured to：
Receive by the described group of the described application example of the described LB device service in the described first set of described LB equipment
In each application example weighted value；And
The application example in described group based on the described LB device service in the described first set by described LB equipment
Received weighted value, generates described first data structure.
10. system according to claim 9, wherein, generate described first data structure when, described LB equipment described
Each LB equipment in first set is further configured to：
It is by each application example in the described group of the described LB device service in the described first set of described LB equipment
Select the empty data structure location of some, described number is determined based on the described weighted value corresponding with described application example
The selected data structure location of purpose；And
The virtual ip address of described application example is inserted in each selected sky data structure location.
11. systems according to claim 10, wherein, each LB equipment quilt in the described first set of described LB equipment
It is further configured to：Based on the described first set by described LB equipment in described LB device service described group in
The deviant that application example is associated, selects the empty data structure location of described number for application example each described.
12. one kind are used for loads of data traffic method in a balanced way, including：
First data structure, described first data structure are maintained by each the LB equipment in the first set of load balancing LB equipment
Including with the described first set by described LB equipment in described LB device service application example group in application real
The associated entry of example, the frequency that each be served by example is included in described first data structure indicate with corresponding
The weighted value that the capacity of be served by example is associated；
Upon receipt of packet, it is based on one or more first header fields of received data packet to generate the
One hashed value, described packet is to be addressed to anycast address and received at LB system；
Using described first data structure, identify in described be served by example based on the first hashed value being generated
Individual virtual IP IP address；And
Described packet is forwarded to identified application example；
Second data structure is maintained by the LB equipment in the second set of LB equipment, described second data structure includes and described the
The entry that corresponding LB equipment in one set is associated, each the LB equipment in the described first set of described LB equipment is included
The weighted value being associated with the corresponding LB equipment in described first set in the frequency instruction in described second data structure；
Upon receipt of packet, it is based on one or more second header fields of received data packet to generate the
Two hashed values, described packet is to be addressed to described anycast address and received at described LB system；
Based on the second hashed value being generated, identify that the LB in the first set of LB equipment sets using described second data structure
Standby；And
Described packet is forwarded to the LB equipment being identified in the described first set of described LB equipment.
13. methods according to claim 12, further include：Described in the described second set of described LB equipment
LB equipment reports the business load of each the LB equipment in the described first set being forwarded to described LB equipment to overall LB
Element.
14. methods according to claim 13, further include：It is based at least partially on by described overall situation LB element and connect
The report of the forwarding service load received, generates the weight being associated with the LB equipment in the described first set of described LB equipment,
The report of described forwarding service load is the institute to described LB equipment for the LB equipment from the described second set of described LB equipment
State the LB equipment in first set.
15. methods according to claim 12, wherein, with the corresponding LB equipment in the described first set of described LB equipment
Associated weight instruction is real by the described application of the described corresponding LB device service in the described first set of described LB equipment
The capacity of the group of example.
16. methods according to claim 12, wherein, described application example and application server, content server and
At least one of virtual machine is associated.
17. methods according to claim 12, further include：
Received in the described first set of described LB equipment by the described LB equipment in the described second set of described LB equipment
The weighted value of one or more LB equipment；And
The received weighted value of the one or more of LB equipment in the described first set based on described LB equipment, generates institute
State the second data structure.
18. methods according to claim 17, wherein, generate described second table and include：
For the empty data structure location of each the LB equipment choice some in the described first set of described LB equipment, it is based on
The described weighted value corresponding with the described LB equipment in the described first set of described LB equipment to determine the institute of described number
The data structure location selecting；And
The IP address of the described LB equipment in the described first set of described LB equipment is inserted into each selected sky number
According in locations of structures.
19. methods according to claim 18, wherein, be described LB equipment described first set in each LB equipment
The empty data structure location selecting some includes：Based on the described first set of described LB equipment in described LB equipment
Associated deviant, selects the empty data structure location of described number.
20. methods according to claim 12, further include：
Received by the described LB equipment in the described first set of described LB equipment by the described LB equipment in described first set
The weighted value of each application example in the group of described application example of service；And
Based on the weighted value being received, generate described first data structure.
21. methods according to claim 20, wherein, generate described first data structure and include：
It is by each application example in the described group of the described LB device service in the described first set of described LB equipment
Select the empty data structure location of some, described number is determined based on the described weighted value corresponding with described application example
The selected data structure location of purpose；And
The virtual ip address of described application example is inserted in each selected sky data structure location.
22. methods according to claim 21, wherein, select the empty data structure position of some for each application example
Put including：Based on the deviant being associated with described application example, to select the empty data structure location of described number.
Priority Applications (1)
Application Number | Priority Date | Filing Date | Title |
---|---|---|---|
CN201910651382.7A CN110365781B (en) | 2014-05-13 | 2015-05-11 | Method and system for load balancing of anycast data traffic |
Applications Claiming Priority (5)
Application Number | Priority Date | Filing Date | Title |
---|---|---|---|
US201461992623P | 2014-05-13 | 2014-05-13 | |
US61/992,623 | 2014-05-13 | ||
US14/495,683 | 2014-09-24 | ||
US14/495,683 US9560124B2 (en) | 2014-05-13 | 2014-09-24 | Method and system for load balancing anycast data traffic |
PCT/US2015/030235 WO2015175442A1 (en) | 2014-05-13 | 2015-05-11 | Method and system for load balancing anycast data traffic |
Related Child Applications (1)
Application Number | Title | Priority Date | Filing Date |
---|---|---|---|
CN201910651382.7A Division CN110365781B (en) | 2014-05-13 | 2015-05-11 | Method and system for load balancing of anycast data traffic |
Publications (2)
Publication Number | Publication Date |
---|---|
CN106416197A true CN106416197A (en) | 2017-02-15 |
CN106416197B CN106416197B (en) | 2019-07-30 |
Family
ID=53276271
Family Applications (2)
Application Number | Title | Priority Date | Filing Date |
---|---|---|---|
CN201580025002.9A Active CN106416197B (en) | 2014-05-13 | 2015-05-11 | For carrying out the method and system of load balancing to anycast's data service |
CN201910651382.7A Active CN110365781B (en) | 2014-05-13 | 2015-05-11 | Method and system for load balancing of anycast data traffic |
Family Applications After (1)
Application Number | Title | Priority Date | Filing Date |
---|---|---|---|
CN201910651382.7A Active CN110365781B (en) | 2014-05-13 | 2015-05-11 | Method and system for load balancing of anycast data traffic |
Country Status (7)
Country | Link |
---|---|
US (2) | US9560124B2 (en) |
EP (2) | EP3143753B1 (en) |
JP (2) | JP6355759B2 (en) |
KR (2) | KR102146476B1 (en) |
CN (2) | CN106416197B (en) |
DK (2) | DK3143753T3 (en) |
WO (1) | WO2015175442A1 (en) |
Cited By (3)
Publication number | Priority date | Publication date | Assignee | Title |
---|---|---|---|---|
CN107864101A (en) * | 2017-12-26 | 2018-03-30 | 杭州迪普科技股份有限公司 | Load-balancing method and device |
CN108768878A (en) * | 2018-06-06 | 2018-11-06 | 北京奇艺世纪科技有限公司 | A kind of SiteServer LBS, method, apparatus and load-balancing device |
US20220116448A1 (en) * | 2017-07-03 | 2022-04-14 | Pure Storage, Inc. | Load Balancing Reset Packets |
Families Citing this family (17)
Publication number | Priority date | Publication date | Assignee | Title |
---|---|---|---|---|
US20170006082A1 (en) * | 2014-06-03 | 2017-01-05 | Nimit Shishodia | Software Defined Networking (SDN) Orchestration by Abstraction |
US9923959B2 (en) * | 2014-06-05 | 2018-03-20 | Microsoft Technology Licensing, Llc | Load balancing with layered edge servers |
JP2016081119A (en) * | 2014-10-10 | 2016-05-16 | 富士通株式会社 | Information processing system, control method thereof, and control program of control apparatus |
US10313271B2 (en) | 2016-03-16 | 2019-06-04 | At&T Intellectual Property I, L.P. | Providing and using a distributed forwarding service |
US10574741B2 (en) | 2016-04-18 | 2020-02-25 | Nokia Technologies Oy | Multi-level load balancing |
US10122647B2 (en) * | 2016-06-20 | 2018-11-06 | Microsoft Technology Licensing, Llc | Low-redistribution load balancing |
CN108259334A (en) | 2017-01-25 | 2018-07-06 | 新华三技术有限公司 | A kind of equivalent route item establishing method and device |
US10536517B2 (en) * | 2017-03-16 | 2020-01-14 | A10 Networks, Inc. | Distributed global server load balancing controllers sharing service delay time |
US10462233B2 (en) * | 2018-01-23 | 2019-10-29 | Charter Communications Operating, Llc | Protocol for anycast based discovery of local resources |
CN108769271A (en) * | 2018-08-20 | 2018-11-06 | 北京百度网讯科技有限公司 | Method, apparatus, storage medium and the terminal device of load balancing |
US10645008B1 (en) * | 2018-12-06 | 2020-05-05 | Verizon Digital Media Services Inc. | Predictive Anycast traffic shaping |
US11005929B1 (en) | 2019-01-30 | 2021-05-11 | Cisco Technology, Inc. | Dynamic data center load balancing using border gateway protocol |
US10887380B2 (en) * | 2019-04-01 | 2021-01-05 | Google Llc | Multi-cluster ingress |
WO2022031819A1 (en) * | 2020-08-05 | 2022-02-10 | Avesha, Inc. | Performing load balancing self adjustment within an application environment |
US20220350675A1 (en) | 2021-05-03 | 2022-11-03 | Avesha, Inc. | Distributed computing system with multi tenancy based on application slices |
CN113655994B (en) * | 2021-10-21 | 2022-02-18 | 北京壁仞科技开发有限公司 | Current change slope control method, control device and medium for multi-core processor |
US11936560B1 (en) * | 2023-05-09 | 2024-03-19 | The Adt Security Corporation | Systems and methods for data flow between mobile applications and customer premises equipment, using a consistent server hash |
Citations (6)
Publication number | Priority date | Publication date | Assignee | Title |
---|---|---|---|---|
US20060212597A1 (en) * | 2005-02-18 | 2006-09-21 | Fujitsu Limited | Multi-stage load distributing apparatus and method, and program |
US7355977B1 (en) * | 2002-08-16 | 2008-04-08 | F5 Networks, Inc. | Method and system for a weighted allocation table |
CN101404616A (en) * | 2008-11-04 | 2009-04-08 | 北京大学深圳研究生院 | Load balance grouping and switching structure and its construction method |
CA2759957A1 (en) * | 2009-05-28 | 2010-12-02 | Microsoft Corporation | Load balancing across layer-2 domains |
US20110145390A1 (en) * | 2009-12-11 | 2011-06-16 | Verizon Patent And Licensing, Inc. | Load balancing |
CN102404229A (en) * | 2011-12-14 | 2012-04-04 | 华为技术有限公司 | System, device and method for load balancing |
Family Cites Families (12)
Publication number | Priority date | Publication date | Assignee | Title |
---|---|---|---|---|
JP3369445B2 (en) * | 1997-09-22 | 2003-01-20 | 富士通株式会社 | Network service server load adjusting device, method and recording medium |
JP3898498B2 (en) * | 2001-12-06 | 2007-03-28 | 富士通株式会社 | Server load balancing system |
US20050195834A1 (en) * | 2003-03-31 | 2005-09-08 | Shunsuke Kikuchi | Load distribution system |
JPWO2004088940A1 (en) * | 2003-03-31 | 2006-07-06 | 富士通株式会社 | Load balancing system |
US7270869B2 (en) | 2003-07-25 | 2007-09-18 | Fujifilm Corporation | Image-recording material, process for producing the same and process for forming image |
JP2005092862A (en) * | 2003-08-11 | 2005-04-07 | Hitachi Ltd | Load distribution method and client-server system |
US20060064478A1 (en) * | 2004-05-03 | 2006-03-23 | Level 3 Communications, Inc. | Geo-locating load balancing |
KR100645041B1 (en) | 2004-07-12 | 2006-11-10 | 삼성전자주식회사 | Semiconductor devices having a metal-insulator-metal capacitor and methods of forming the same |
US8145908B1 (en) * | 2004-10-29 | 2012-03-27 | Akamai Technologies, Inc. | Web content defacement protection system |
US20090172192A1 (en) * | 2007-12-28 | 2009-07-02 | Christian Michael F | Mapless Global Traffic Load Balancing Via Anycast |
JP5648926B2 (en) * | 2010-02-01 | 2015-01-07 | 日本電気株式会社 | Network system, controller, and network control method |
US8755283B2 (en) * | 2010-12-17 | 2014-06-17 | Microsoft Corporation | Synchronizing state among load balancer components |
-
2014
- 2014-09-24 US US14/495,683 patent/US9560124B2/en active Active
-
2015
- 2015-05-11 CN CN201580025002.9A patent/CN106416197B/en active Active
- 2015-05-11 CN CN201910651382.7A patent/CN110365781B/en active Active
- 2015-05-11 DK DK15726434.2T patent/DK3143753T3/en active
- 2015-05-11 JP JP2016565152A patent/JP6355759B2/en active Active
- 2015-05-11 KR KR1020177018044A patent/KR102146476B1/en active IP Right Grant
- 2015-05-11 EP EP15726434.2A patent/EP3143753B1/en active Active
- 2015-05-11 DK DK18152515.5T patent/DK3328038T3/en active
- 2015-05-11 KR KR1020167033455A patent/KR101754408B1/en active IP Right Grant
- 2015-05-11 WO PCT/US2015/030235 patent/WO2015175442A1/en active Application Filing
- 2015-05-11 EP EP18152515.5A patent/EP3328038B1/en active Active
-
2016
- 2016-12-21 US US15/386,560 patent/US9998529B2/en active Active
-
2018
- 2018-06-12 JP JP2018111793A patent/JP6578416B2/en active Active
Patent Citations (6)
Publication number | Priority date | Publication date | Assignee | Title |
---|---|---|---|---|
US7355977B1 (en) * | 2002-08-16 | 2008-04-08 | F5 Networks, Inc. | Method and system for a weighted allocation table |
US20060212597A1 (en) * | 2005-02-18 | 2006-09-21 | Fujitsu Limited | Multi-stage load distributing apparatus and method, and program |
CN101404616A (en) * | 2008-11-04 | 2009-04-08 | 北京大学深圳研究生院 | Load balance grouping and switching structure and its construction method |
CA2759957A1 (en) * | 2009-05-28 | 2010-12-02 | Microsoft Corporation | Load balancing across layer-2 domains |
US20110145390A1 (en) * | 2009-12-11 | 2011-06-16 | Verizon Patent And Licensing, Inc. | Load balancing |
CN102404229A (en) * | 2011-12-14 | 2012-04-04 | 华为技术有限公司 | System, device and method for load balancing |
Cited By (4)
Publication number | Priority date | Publication date | Assignee | Title |
---|---|---|---|---|
US20220116448A1 (en) * | 2017-07-03 | 2022-04-14 | Pure Storage, Inc. | Load Balancing Reset Packets |
US11689610B2 (en) * | 2017-07-03 | 2023-06-27 | Pure Storage, Inc. | Load balancing reset packets |
CN107864101A (en) * | 2017-12-26 | 2018-03-30 | 杭州迪普科技股份有限公司 | Load-balancing method and device |
CN108768878A (en) * | 2018-06-06 | 2018-11-06 | 北京奇艺世纪科技有限公司 | A kind of SiteServer LBS, method, apparatus and load-balancing device |
Also Published As
Publication number | Publication date |
---|---|
EP3143753A1 (en) | 2017-03-22 |
JP6578416B2 (en) | 2019-09-18 |
DK3143753T3 (en) | 2018-12-03 |
JP2018164285A (en) | 2018-10-18 |
JP6355759B2 (en) | 2018-07-11 |
CN106416197B (en) | 2019-07-30 |
US9998529B2 (en) | 2018-06-12 |
CN110365781B (en) | 2020-11-13 |
US20170099346A1 (en) | 2017-04-06 |
DK3328038T3 (en) | 2020-06-29 |
US9560124B2 (en) | 2017-01-31 |
KR101754408B1 (en) | 2017-07-19 |
EP3143753B1 (en) | 2018-08-29 |
EP3328038B1 (en) | 2020-04-15 |
CN110365781A (en) | 2019-10-22 |
EP3328038A1 (en) | 2018-05-30 |
WO2015175442A1 (en) | 2015-11-19 |
JP2017516399A (en) | 2017-06-15 |
KR20170081717A (en) | 2017-07-12 |
KR102146476B1 (en) | 2020-08-20 |
KR20160140995A (en) | 2016-12-07 |
US20150334179A1 (en) | 2015-11-19 |
Similar Documents
Publication | Publication Date | Title |
---|---|---|
CN106416197B (en) | For carrying out the method and system of load balancing to anycast's data service | |
US9762494B1 (en) | Flow distribution table for packet flow load balancing | |
CN103155500B (en) | For the method and system of the stateless load balance of network service flow | |
EP3100438B1 (en) | An anycast based, wide area distributed mapping and load balancing system | |
CN102075445B (en) | Load balancing method and device | |
US10715479B2 (en) | Connection redistribution in load-balanced systems | |
CN103401799A (en) | Method and device for realizing load balance | |
EP3087709A1 (en) | Methods and apparatus for load balancing in a network | |
JP2010003273A (en) | Sip message distribution method and sip message distribution device | |
US9832072B1 (en) | Self-configuring computer network router | |
US7711780B1 (en) | Method for distributed end-to-end dynamic horizontal scalability | |
CN112087382B (en) | Service routing method and device | |
CN109040199A (en) | A kind of method, system and storage medium for distributing resource data | |
AU2016267247B2 (en) | Systems and methods for server failover and load balancing | |
US11843540B2 (en) | System and method for deterministic hash addressing | |
CN117099356A (en) | Instance-affine service scheduling | |
WO2017087017A1 (en) | Flow table bypass |
Legal Events
Date | Code | Title | Description |
---|---|---|---|
C06 | Publication | ||
PB01 | Publication | ||
C10 | Entry into substantive examination | ||
SE01 | Entry into force of request for substantive examination | ||
REG | Reference to a national code |
Ref country code: HKRef legal event code: DERef document number: 1232696Country of ref document: HK |
|
CB02 | Change of applicant information | ||
CB02 | Change of applicant information |
Address after: American CaliforniaApplicant after: Google limited liability companyAddress before: American CaliforniaApplicant before: Google Inc. |
|
GR01 | Patent grant | ||
GR01 | Patent grant |